<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 13.1.1"/>
    <title>gerrytools.data API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../gerrytools.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;gerrytools</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>


            <h2>Submodules</h2>
            <ul>
                    <li><a href="data/remap.html">remap</a></li>
                    <li><a href="data/AssignmentCompressor.html">AssignmentCompressor</a></li>
            </ul>

            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#submissions">submissions</a>
            </li>
            <li>
                    <a class="function" href="#tabularized">tabularized</a>
            </li>
            <li>
                    <a class="function" href="#remap">remap</a>
            </li>
            <li>
                    <a class="function" href="#ids">ids</a>
            </li>
            <li>
                    <a class="function" href="#one">one</a>
            </li>
            <li>
                    <a class="function" href="#csvs">csvs</a>
            </li>
            <li>
                    <a class="class" href="#AssignmentCompressor">AssignmentCompressor</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#AssignmentCompressor.__init__">AssignmentCompressor</a>
                        </li>
                        <li>
                                <a class="function" href="#AssignmentCompressor.match">match</a>
                        </li>
                        <li>
                                <a class="function" href="#AssignmentCompressor.compress_all">compress_all</a>
                        </li>
                        <li>
                                <a class="function" href="#AssignmentCompressor.compress">compress</a>
                        </li>
                        <li>
                                <a class="function" href="#AssignmentCompressor.decompress">decompress</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Submission">Submission</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#Submission.link">link</a>
                        </li>
                        <li>
                                <a class="variable" href="#Submission.plan">plan</a>
                        </li>
                        <li>
                                <a class="variable" href="#Submission.id">id</a>
                        </li>
                        <li>
                                <a class="variable" href="#Submission.units">units</a>
                        </li>
                        <li>
                                <a class="variable" href="#Submission.unitsType">unitsType</a>
                        </li>
                        <li>
                                <a class="variable" href="#Submission.tileset">tileset</a>
                        </li>
                        <li>
                                <a class="variable" href="#Submission.type">type</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#cvap">cvap</a>
            </li>
            <li>
                    <a class="function" href="#acs5">acs5</a>
            </li>
            <li>
                    <a class="function" href="#census20">census20</a>
            </li>
            <li>
                    <a class="function" href="#variables">variables</a>
            </li>
            <li>
                    <a class="function" href="#estimatecvap2010">estimatecvap2010</a>
            </li>
            <li>
                    <a class="function" href="#estimatecvap2020">estimatecvap2020</a>
            </li>
            <li>
                    <a class="function" href="#fetchgeometries">fetchgeometries</a>
            </li>
            <li>
                    <a class="function" href="#census10">census10</a>
            </li>
            <li>
                    <a class="function" href="#geometries20">geometries20</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../gerrytools.html">gerrytools</a><wbr>.data    </h1>

                        <div class="docstring"><p>Facilities for processing data and districting plans in a standardized fashion.</p>
</div>

                        <input id="mod-data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-data-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="sd">Facilities for processing data and districting plans in a standardized fashion.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="kn">from</span> <span class="nn">.acs</span> <span class="kn">import</span> <span class="n">acs5</span><span class="p">,</span> <span class="n">cvap</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="kn">from</span> <span class="nn">.AssignmentCompressor</span> <span class="kn">import</span> <span class="n">AssignmentCompressor</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a><span class="kn">from</span> <span class="nn">.census</span> <span class="kn">import</span> <span class="n">census10</span><span class="p">,</span> <span class="n">census20</span><span class="p">,</span> <span class="n">variables</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="kn">from</span> <span class="nn">.estimatecvap</span> <span class="kn">import</span> <span class="n">estimatecvap2010</span><span class="p">,</span> <span class="n">estimatecvap2020</span><span class="p">,</span> <span class="n">fetchgeometries</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="kn">from</span> <span class="nn">.fetch</span> <span class="kn">import</span> <span class="n">Submission</span><span class="p">,</span> <span class="n">submissions</span><span class="p">,</span> <span class="n">tabularized</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="kn">from</span> <span class="nn">.geometries</span> <span class="kn">import</span> <span class="n">geometries20</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="kn">from</span> <span class="nn">.remap</span> <span class="kn">import</span> <span class="n">remap</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="kn">from</span> <span class="nn">.URLs</span> <span class="kn">import</span> <span class="n">csvs</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">one</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a>    <span class="s2">&quot;submissions&quot;</span><span class="p">,</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a>    <span class="s2">&quot;tabularized&quot;</span><span class="p">,</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a>    <span class="s2">&quot;remap&quot;</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>    <span class="s2">&quot;ids&quot;</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a>    <span class="s2">&quot;one&quot;</span><span class="p">,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>    <span class="s2">&quot;csvs&quot;</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a>    <span class="s2">&quot;AssignmentCompressor&quot;</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>    <span class="s2">&quot;Submission&quot;</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a>    <span class="s2">&quot;cvap&quot;</span><span class="p">,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a>    <span class="s2">&quot;acs5&quot;</span><span class="p">,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a>    <span class="s2">&quot;census20&quot;</span><span class="p">,</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a>    <span class="s2">&quot;variables&quot;</span><span class="p">,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a>    <span class="s2">&quot;estimatecvap2010&quot;</span><span class="p">,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a>    <span class="s2">&quot;estimatecvap2020&quot;</span><span class="p">,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a>    <span class="s2">&quot;fetchgeometries&quot;</span><span class="p">,</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a>    <span class="s2">&quot;census10&quot;</span><span class="p">,</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">30</span></a>    <span class="s2">&quot;geometries20&quot;</span><span class="p">,</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">31</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="submissions">
                            <input id="submissions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">submissions</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">state</span>, </span><span class="param"><span class="n">sample</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n"><a href="#Submission">gerrytools.data.Submission</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="submissions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#submissions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="submissions-124"><a href="#submissions-124"><span class="linenos">124</span></a><span class="k">def</span> <span class="nf">submissions</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Submission</span><span class="p">]:</span>
</span><span id="submissions-125"><a href="#submissions-125"><span class="linenos">125</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="submissions-126"><a href="#submissions-126"><span class="linenos">126</span></a><span class="sd">    Retrieves raw districtr objects; this includes both plan- and COI-based</span>
</span><span id="submissions-127"><a href="#submissions-127"><span class="linenos">127</span></a><span class="sd">    submissions.</span>
</span><span id="submissions-128"><a href="#submissions-128"><span class="linenos">128</span></a>
</span><span id="submissions-129"><a href="#submissions-129"><span class="linenos">129</span></a><span class="sd">    Args:</span>
</span><span id="submissions-130"><a href="#submissions-130"><span class="linenos">130</span></a><span class="sd">        state (State): `us.State` object (e.g. `us.states.WI`).</span>
</span><span id="submissions-131"><a href="#submissions-131"><span class="linenos">131</span></a><span class="sd">        sample (int, optional): The number of sample plans to retrieve.</span>
</span><span id="submissions-132"><a href="#submissions-132"><span class="linenos">132</span></a>
</span><span id="submissions-133"><a href="#submissions-133"><span class="linenos">133</span></a><span class="sd">    Returns:</span>
</span><span id="submissions-134"><a href="#submissions-134"><span class="linenos">134</span></a><span class="sd">        A list of `Submissions`, either to be interpreted raw or tabularized.</span>
</span><span id="submissions-135"><a href="#submissions-135"><span class="linenos">135</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="submissions-136"><a href="#submissions-136"><span class="linenos">136</span></a>    <span class="c1"># Get the appropriate URL and send the request. Made some basic ASCII</span>
</span><span id="submissions-137"><a href="#submissions-137"><span class="linenos">137</span></a>    <span class="c1"># art with the second three variable names... it&#39;s like the request</span>
</span><span id="submissions-138"><a href="#submissions-138"><span class="linenos">138</span></a>    <span class="c1"># is loading letter by letter.</span>
</span><span id="submissions-139"><a href="#submissions-139"><span class="linenos">139</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="n">ids</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="submissions-140"><a href="#submissions-140"><span class="linenos">140</span></a>    <span class="n">__w</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span><span id="submissions-141"><a href="#submissions-141"><span class="linenos">141</span></a>    <span class="n">_aw</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">__w</span><span class="p">)[</span><span class="s2">&quot;ids&quot;</span><span class="p">]</span>
</span><span id="submissions-142"><a href="#submissions-142"><span class="linenos">142</span></a>    <span class="n">raw</span> <span class="o">=</span> <span class="n">_aw</span><span class="p">[:</span><span class="n">sample</span><span class="p">]</span> <span class="k">if</span> <span class="n">sample</span> <span class="k">else</span> <span class="n">_aw</span>
</span><span id="submissions-143"><a href="#submissions-143"><span class="linenos">143</span></a>
</span><span id="submissions-144"><a href="#submissions-144"><span class="linenos">144</span></a>    <span class="c1"># Create `Submission` objects for each of the retrieved objects.</span>
</span><span id="submissions-145"><a href="#submissions-145"><span class="linenos">145</span></a>    <span class="c1"># Getting the individual plans is the bottleneck here, and</span>
</span><span id="submissions-146"><a href="#submissions-146"><span class="linenos">146</span></a>    <span class="c1"># unfortunately we can&#39;t retrieve them in bulk (... or can we?).</span>
</span><span id="submissions-147"><a href="#submissions-147"><span class="linenos">147</span></a>    <span class="n">submissions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="submissions-148"><a href="#submissions-148"><span class="linenos">148</span></a>    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">raw</span><span class="p">:</span>
</span><span id="submissions-149"><a href="#submissions-149"><span class="linenos">149</span></a>        <span class="c1"># Retrieve the required data points.</span>
</span><span id="submissions-150"><a href="#submissions-150"><span class="linenos">150</span></a>        <span class="n">identifier</span> <span class="o">=</span> <span class="n">parse_id</span><span class="p">(</span><span class="n">entity</span><span class="p">[</span><span class="s2">&quot;link&quot;</span><span class="p">],</span> <span class="n">df</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="submissions-151"><a href="#submissions-151"><span class="linenos">151</span></a>        <span class="n">districtr</span> <span class="o">=</span> <span class="n">individual</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
</span><span id="submissions-152"><a href="#submissions-152"><span class="linenos">152</span></a>
</span><span id="submissions-153"><a href="#submissions-153"><span class="linenos">153</span></a>        <span class="c1"># Force all plan keys and values to strings.</span>
</span><span id="submissions-154"><a href="#submissions-154"><span class="linenos">154</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="submissions-155"><a href="#submissions-155"><span class="linenos">155</span></a>            <span class="n">plan</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="submissions-156"><a href="#submissions-156"><span class="linenos">156</span></a>                <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">):</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="submissions-157"><a href="#submissions-157"><span class="linenos">157</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">districtr</span><span class="p">[</span><span class="s2">&quot;plan&quot;</span><span class="p">][</span><span class="s2">&quot;assignment&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="submissions-158"><a href="#submissions-158"><span class="linenos">158</span></a>            <span class="p">}</span>
</span><span id="submissions-159"><a href="#submissions-159"><span class="linenos">159</span></a>            <span class="n">units</span> <span class="o">=</span> <span class="n">districtr</span><span class="p">[</span><span class="s2">&quot;plan&quot;</span><span class="p">][</span><span class="s2">&quot;units&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="submissions-160"><a href="#submissions-160"><span class="linenos">160</span></a>            <span class="n">unitsType</span> <span class="o">=</span> <span class="n">districtr</span><span class="p">[</span><span class="s2">&quot;plan&quot;</span><span class="p">][</span><span class="s2">&quot;units&quot;</span><span class="p">][</span><span class="s2">&quot;unitType&quot;</span><span class="p">]</span>
</span><span id="submissions-161"><a href="#submissions-161"><span class="linenos">161</span></a>            <span class="n">tileset</span> <span class="o">=</span> <span class="n">districtr</span><span class="p">[</span><span class="s2">&quot;plan&quot;</span><span class="p">][</span><span class="s2">&quot;units&quot;</span><span class="p">][</span><span class="s2">&quot;tilesets&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;sourceLayer&quot;</span><span class="p">]</span>
</span><span id="submissions-162"><a href="#submissions-162"><span class="linenos">162</span></a>
</span><span id="submissions-163"><a href="#submissions-163"><span class="linenos">163</span></a>            <span class="c1"># Create a new Submission.</span>
</span><span id="submissions-164"><a href="#submissions-164"><span class="linenos">164</span></a>            <span class="n">submissions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="submissions-165"><a href="#submissions-165"><span class="linenos">165</span></a>                <span class="n">Submission</span><span class="p">(</span>
</span><span id="submissions-166"><a href="#submissions-166"><span class="linenos">166</span></a>                    <span class="n">link</span><span class="o">=</span><span class="n">entity</span><span class="p">[</span><span class="s2">&quot;link&quot;</span><span class="p">],</span>
</span><span id="submissions-167"><a href="#submissions-167"><span class="linenos">167</span></a>                    <span class="nb">id</span><span class="o">=</span><span class="n">identifier</span><span class="p">,</span>
</span><span id="submissions-168"><a href="#submissions-168"><span class="linenos">168</span></a>                    <span class="n">plan</span><span class="o">=</span><span class="n">plan</span><span class="p">,</span>
</span><span id="submissions-169"><a href="#submissions-169"><span class="linenos">169</span></a>                    <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
</span><span id="submissions-170"><a href="#submissions-170"><span class="linenos">170</span></a>                    <span class="n">unitsType</span><span class="o">=</span><span class="n">unitsType</span><span class="p">,</span>
</span><span id="submissions-171"><a href="#submissions-171"><span class="linenos">171</span></a>                    <span class="n">tileset</span><span class="o">=</span><span class="n">tileset</span><span class="p">,</span>
</span><span id="submissions-172"><a href="#submissions-172"><span class="linenos">172</span></a>                    <span class="nb">type</span><span class="o">=</span><span class="n">entity</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
</span><span id="submissions-173"><a href="#submissions-173"><span class="linenos">173</span></a>                <span class="p">)</span>
</span><span id="submissions-174"><a href="#submissions-174"><span class="linenos">174</span></a>            <span class="p">)</span>
</span><span id="submissions-175"><a href="#submissions-175"><span class="linenos">175</span></a>        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
</span><span id="submissions-176"><a href="#submissions-176"><span class="linenos">176</span></a>            <span class="k">pass</span>
</span><span id="submissions-177"><a href="#submissions-177"><span class="linenos">177</span></a>
</span><span id="submissions-178"><a href="#submissions-178"><span class="linenos">178</span></a>    <span class="k">return</span> <span class="n">submissions</span>
</span></pre></div>


            <div class="docstring"><p>Retrieves raw districtr objects; this includes both plan- and COI-based
submissions.</p>

<p>Args:
    state (State): <code>us.State</code> object (e.g. <code>us.states.WI</code>).
    sample (int, optional): The number of sample plans to retrieve.</p>

<p>Returns:
    A list of <code>Submissions</code>, either to be interpreted raw or tabularized.</p>
</div>


                </section>
                <section id="tabularized">
                            <input id="tabularized-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tabularized</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">state</span>,</span><span class="param">	<span class="n">submissions</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="tabularized-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#tabularized"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="tabularized-36"><a href="#tabularized-36"><span class="linenos"> 36</span></a><span class="k">def</span> <span class="nf">tabularized</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">submissions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="tabularized-37"><a href="#tabularized-37"><span class="linenos"> 37</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="tabularized-38"><a href="#tabularized-38"><span class="linenos"> 38</span></a><span class="sd">    Returns districtr submission information in a tabular format.</span>
</span><span id="tabularized-39"><a href="#tabularized-39"><span class="linenos"> 39</span></a>
</span><span id="tabularized-40"><a href="#tabularized-40"><span class="linenos"> 40</span></a><span class="sd">    Args:</span>
</span><span id="tabularized-41"><a href="#tabularized-41"><span class="linenos"> 41</span></a><span class="sd">        state (State): `us.State` object (e.g. `us.states.WI`).</span>
</span><span id="tabularized-42"><a href="#tabularized-42"><span class="linenos"> 42</span></a><span class="sd">        submissions (list): List of `Submission` objects returned from a</span>
</span><span id="tabularized-43"><a href="#tabularized-43"><span class="linenos"> 43</span></a><span class="sd">            call to `submissions`.</span>
</span><span id="tabularized-44"><a href="#tabularized-44"><span class="linenos"> 44</span></a>
</span><span id="tabularized-45"><a href="#tabularized-45"><span class="linenos"> 45</span></a><span class="sd">    Returns:</span>
</span><span id="tabularized-46"><a href="#tabularized-46"><span class="linenos"> 46</span></a><span class="sd">        Three dataframes corresponding to plan-based submissions, COI-based</span>
</span><span id="tabularized-47"><a href="#tabularized-47"><span class="linenos"> 47</span></a><span class="sd">        submissions, and written submissions to the provided state.</span>
</span><span id="tabularized-48"><a href="#tabularized-48"><span class="linenos"> 48</span></a>
</span><span id="tabularized-49"><a href="#tabularized-49"><span class="linenos"> 49</span></a><span class="sd">    Example:</span>
</span><span id="tabularized-50"><a href="#tabularized-50"><span class="linenos"> 50</span></a><span class="sd">        Prototypical example usage.</span>
</span><span id="tabularized-51"><a href="#tabularized-51"><span class="linenos"> 51</span></a>
</span><span id="tabularized-52"><a href="#tabularized-52"><span class="linenos"> 52</span></a><span class="sd">            import us</span>
</span><span id="tabularized-53"><a href="#tabularized-53"><span class="linenos"> 53</span></a><span class="sd">            from gerrytools.retrieve import submissions, tabularized</span>
</span><span id="tabularized-54"><a href="#tabularized-54"><span class="linenos"> 54</span></a>
</span><span id="tabularized-55"><a href="#tabularized-55"><span class="linenos"> 55</span></a><span class="sd">            # Set the state.</span>
</span><span id="tabularized-56"><a href="#tabularized-56"><span class="linenos"> 56</span></a><span class="sd">            state = us.states.WI</span>
</span><span id="tabularized-57"><a href="#tabularized-57"><span class="linenos"> 57</span></a>
</span><span id="tabularized-58"><a href="#tabularized-58"><span class="linenos"> 58</span></a><span class="sd">            # Retrieve the raw districtr submissions, then tabularize them.</span>
</span><span id="tabularized-59"><a href="#tabularized-59"><span class="linenos"> 59</span></a><span class="sd">            subs = submissions(state)</span>
</span><span id="tabularized-60"><a href="#tabularized-60"><span class="linenos"> 60</span></a><span class="sd">            plans, cois, written = tabularized(state, subs)</span>
</span><span id="tabularized-61"><a href="#tabularized-61"><span class="linenos"> 61</span></a>
</span><span id="tabularized-62"><a href="#tabularized-62"><span class="linenos"> 62</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="tabularized-63"><a href="#tabularized-63"><span class="linenos"> 63</span></a>    <span class="c1"># Sort submissions. (Not sure why this is necessary? Holdover from previous</span>
</span><span id="tabularized-64"><a href="#tabularized-64"><span class="linenos"> 64</span></a>    <span class="c1"># fetching code.)</span>
</span><span id="tabularized-65"><a href="#tabularized-65"><span class="linenos"> 65</span></a>    <span class="n">submissions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">submissions</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
</span><span id="tabularized-66"><a href="#tabularized-66"><span class="linenos"> 66</span></a>
</span><span id="tabularized-67"><a href="#tabularized-67"><span class="linenos"> 67</span></a>    <span class="c1"># Categorize into three categories: plan submissions, COI submissions, and</span>
</span><span id="tabularized-68"><a href="#tabularized-68"><span class="linenos"> 68</span></a>    <span class="c1"># written submissions (which are ignored as they don&#39;t appear in the list</span>
</span><span id="tabularized-69"><a href="#tabularized-69"><span class="linenos"> 69</span></a>    <span class="c1"># of submissions).</span>
</span><span id="tabularized-70"><a href="#tabularized-70"><span class="linenos"> 70</span></a>    <span class="n">_plans</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">submissions</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;plan&quot;</span><span class="p">]</span>
</span><span id="tabularized-71"><a href="#tabularized-71"><span class="linenos"> 71</span></a>    <span class="n">_cois</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">submissions</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;coi&quot;</span><span class="p">]</span>
</span><span id="tabularized-72"><a href="#tabularized-72"><span class="linenos"> 72</span></a>
</span><span id="tabularized-73"><a href="#tabularized-73"><span class="linenos"> 73</span></a>    <span class="c1"># Create preliminary dataframes so we can do safe `merge`s rather than rely</span>
</span><span id="tabularized-74"><a href="#tabularized-74"><span class="linenos"> 74</span></a>    <span class="c1"># explicitly on sorting; this also allows us to specify a sample size if</span>
</span><span id="tabularized-75"><a href="#tabularized-75"><span class="linenos"> 75</span></a>    <span class="c1"># we&#39;re only looking to sample a specific number of plans.</span>
</span><span id="tabularized-76"><a href="#tabularized-76"><span class="linenos"> 76</span></a>    <span class="n">subset_plans</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">_plans</span><span class="p">)</span>
</span><span id="tabularized-77"><a href="#tabularized-77"><span class="linenos"> 77</span></a>    <span class="n">subset_cois</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">_cois</span><span class="p">)</span>
</span><span id="tabularized-78"><a href="#tabularized-78"><span class="linenos"> 78</span></a>
</span><span id="tabularized-79"><a href="#tabularized-79"><span class="linenos"> 79</span></a>    <span class="c1"># Get appropriate URLs and create dataframes.</span>
</span><span id="tabularized-80"><a href="#tabularized-80"><span class="linenos"> 80</span></a>    <span class="n">plans_url</span> <span class="o">=</span> <span class="n">csvs</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="tabularized-81"><a href="#tabularized-81"><span class="linenos"> 81</span></a>    <span class="n">cois_url</span> <span class="o">=</span> <span class="n">csvs</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="s2">&quot;coi&quot;</span><span class="p">)</span>
</span><span id="tabularized-82"><a href="#tabularized-82"><span class="linenos"> 82</span></a>    <span class="n">written_url</span> <span class="o">=</span> <span class="n">csvs</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="s2">&quot;written&quot;</span><span class="p">)</span>
</span><span id="tabularized-83"><a href="#tabularized-83"><span class="linenos"> 83</span></a>
</span><span id="tabularized-84"><a href="#tabularized-84"><span class="linenos"> 84</span></a>    <span class="n">plans</span> <span class="o">=</span> <span class="n">as_dataframe</span><span class="p">(</span><span class="n">plans_url</span><span class="p">)</span>
</span><span id="tabularized-85"><a href="#tabularized-85"><span class="linenos"> 85</span></a>    <span class="n">cois</span> <span class="o">=</span> <span class="n">as_dataframe</span><span class="p">(</span><span class="n">cois_url</span><span class="p">)</span>
</span><span id="tabularized-86"><a href="#tabularized-86"><span class="linenos"> 86</span></a>    <span class="n">writtens</span> <span class="o">=</span> <span class="n">as_dataframe</span><span class="p">(</span><span class="n">written_url</span><span class="p">)</span>
</span><span id="tabularized-87"><a href="#tabularized-87"><span class="linenos"> 87</span></a>
</span><span id="tabularized-88"><a href="#tabularized-88"><span class="linenos"> 88</span></a>    <span class="c1"># Adjust column contents for the plan and COI dataframes.</span>
</span><span id="tabularized-89"><a href="#tabularized-89"><span class="linenos"> 89</span></a>    <span class="k">for</span> <span class="n">universe</span> <span class="ow">in</span> <span class="p">[</span><span class="n">plans</span><span class="p">,</span> <span class="n">cois</span><span class="p">]:</span>
</span><span id="tabularized-90"><a href="#tabularized-90"><span class="linenos"> 90</span></a>        <span class="c1"># Adjust the `link` column type and create an `id` column from it.</span>
</span><span id="tabularized-91"><a href="#tabularized-91"><span class="linenos"> 91</span></a>        <span class="n">universe</span><span class="p">[</span><span class="s2">&quot;link&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">universe</span><span class="p">[</span><span class="s2">&quot;link&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span><span id="tabularized-92"><a href="#tabularized-92"><span class="linenos"> 92</span></a>        <span class="n">universe</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse_id</span><span class="p">(</span><span class="n">universe</span><span class="p">[</span><span class="s2">&quot;link&quot;</span><span class="p">])</span>
</span><span id="tabularized-93"><a href="#tabularized-93"><span class="linenos"> 93</span></a>
</span><span id="tabularized-94"><a href="#tabularized-94"><span class="linenos"> 94</span></a>    <span class="c1"># Adjust column contents for all dataframes.</span>
</span><span id="tabularized-95"><a href="#tabularized-95"><span class="linenos"> 95</span></a>    <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="p">[</span><span class="n">plans</span><span class="p">,</span> <span class="n">cois</span><span class="p">,</span> <span class="n">writtens</span><span class="p">]:</span>
</span><span id="tabularized-96"><a href="#tabularized-96"><span class="linenos"> 96</span></a>        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">])</span>
</span><span id="tabularized-97"><a href="#tabularized-97"><span class="linenos"> 97</span></a>
</span><span id="tabularized-98"><a href="#tabularized-98"><span class="linenos"> 98</span></a>    <span class="c1"># Add the retrieved plan data to the dataframes *if the subset dataframes</span>
</span><span id="tabularized-99"><a href="#tabularized-99"><span class="linenos"> 99</span></a>    <span class="c1"># contain items*.</span>
</span><span id="tabularized-100"><a href="#tabularized-100"><span class="linenos">100</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">subset_plans</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="tabularized-101"><a href="#tabularized-101"><span class="linenos">101</span></a>        <span class="n">plans</span> <span class="o">=</span> <span class="n">plans</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">subset_plans</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
</span><span id="tabularized-102"><a href="#tabularized-102"><span class="linenos">102</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="tabularized-103"><a href="#tabularized-103"><span class="linenos">103</span></a>        <span class="n">plans</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="tabularized-104"><a href="#tabularized-104"><span class="linenos">104</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">subset_cois</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="tabularized-105"><a href="#tabularized-105"><span class="linenos">105</span></a>        <span class="n">cois</span> <span class="o">=</span> <span class="n">cois</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">subset_cois</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
</span><span id="tabularized-106"><a href="#tabularized-106"><span class="linenos">106</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="tabularized-107"><a href="#tabularized-107"><span class="linenos">107</span></a>        <span class="n">cois</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="tabularized-108"><a href="#tabularized-108"><span class="linenos">108</span></a>
</span><span id="tabularized-109"><a href="#tabularized-109"><span class="linenos">109</span></a>    <span class="c1"># Drop bad columns and rename. Not sure why we have to `inplace`</span>
</span><span id="tabularized-110"><a href="#tabularized-110"><span class="linenos">110</span></a>    <span class="c1"># things here, but... fine.</span>
</span><span id="tabularized-111"><a href="#tabularized-111"><span class="linenos">111</span></a>    <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="p">[</span><span class="n">plans</span><span class="p">,</span> <span class="n">cois</span><span class="p">]:</span>
</span><span id="tabularized-112"><a href="#tabularized-112"><span class="linenos">112</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="tabularized-113"><a href="#tabularized-113"><span class="linenos">113</span></a>            <span class="c1"># Remove columns we don&#39;t necessarily care about.</span>
</span><span id="tabularized-114"><a href="#tabularized-114"><span class="linenos">114</span></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;type_x&quot;</span><span class="p">,</span> <span class="s2">&quot;link_x&quot;</span><span class="p">,</span> <span class="s2">&quot;coalition&quot;</span><span class="p">]:</span>
</span><span id="tabularized-115"><a href="#tabularized-115"><span class="linenos">115</span></a>                <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span><span id="tabularized-116"><a href="#tabularized-116"><span class="linenos">116</span></a>                    <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="tabularized-117"><a href="#tabularized-117"><span class="linenos">117</span></a>
</span><span id="tabularized-118"><a href="#tabularized-118"><span class="linenos">118</span></a>            <span class="c1"># Rename the columns we do care about.</span>
</span><span id="tabularized-119"><a href="#tabularized-119"><span class="linenos">119</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;type_y&quot;</span><span class="p">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;link_y&quot;</span><span class="p">:</span> <span class="s2">&quot;link&quot;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="tabularized-120"><a href="#tabularized-120"><span class="linenos">120</span></a>
</span><span id="tabularized-121"><a href="#tabularized-121"><span class="linenos">121</span></a>    <span class="k">return</span> <span class="n">plans</span><span class="p">,</span> <span class="n">cois</span><span class="p">,</span> <span class="n">writtens</span>
</span></pre></div>


            <div class="docstring"><p>Returns districtr submission information in a tabular format.</p>

<p>Args:
    state (State): <code>us.State</code> object (e.g. <code>us.states.WI</code>).
    submissions (list): List of <code><a href="#Submission">Submission</a></code> objects returned from a
        call to <code><a href="#submissions">submissions</a></code>.</p>

<p>Returns:
    Three dataframes corresponding to plan-based submissions, COI-based
    submissions, and written submissions to the provided state.</p>

<p>Example:
    Prototypical example usage.</p>

<pre><code>    import us
    from gerrytools.retrieve import submissions, tabularized

    # Set the state.
    state = us.states.WI

    # Retrieve the raw districtr submissions, then tabularize them.
    subs = submissions(state)
    plans, cois, written = tabularized(state, subs)
</code></pre>
</div>


                </section>
                <section id="remap">
                            <input id="remap-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remap</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">plans</span>, </span><span class="param"><span class="n">unitmaps</span>, </span><span class="param"><span class="n">popmap</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Callable</span>:</span></span>

                <label class="view-source-button" for="remap-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#remap"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="remap-6"><a href="#remap-6"><span class="linenos"> 6</span></a><span class="k">def</span> <span class="nf">remap</span><span class="p">(</span><span class="n">plans</span><span class="p">,</span> <span class="n">unitmaps</span><span class="p">,</span> <span class="n">popmap</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="remap-7"><a href="#remap-7"><span class="linenos"> 7</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="remap-8"><a href="#remap-8"><span class="linenos"> 8</span></a><span class="sd">    Re-maps assignments to the specified set of units.</span>
</span><span id="remap-9"><a href="#remap-9"><span class="linenos"> 9</span></a>
</span><span id="remap-10"><a href="#remap-10"><span class="linenos">10</span></a><span class="sd">    Args:</span>
</span><span id="remap-11"><a href="#remap-11"><span class="linenos">11</span></a><span class="sd">        plans (DataFrame): The Pandas DataFrame produced by ``tabularized()``.</span>
</span><span id="remap-12"><a href="#remap-12"><span class="linenos">12</span></a><span class="sd">        unitmaps (dict): A dictionary whose keys are unit types appearing</span>
</span><span id="remap-13"><a href="#remap-13"><span class="linenos">13</span></a><span class="sd">            in the `unitsType` column, and whose values are dictionaries</span>
</span><span id="remap-14"><a href="#remap-14"><span class="linenos">14</span></a><span class="sd">            mapping unique identifiers of one set of geometries to unique</span>
</span><span id="remap-15"><a href="#remap-15"><span class="linenos">15</span></a><span class="sd">            identifiers (or lists of unique identifiers) of another set of</span>
</span><span id="remap-16"><a href="#remap-16"><span class="linenos">16</span></a><span class="sd">            geometries; these correspond to mappings generated by `unitmap()`</span>
</span><span id="remap-17"><a href="#remap-17"><span class="linenos">17</span></a><span class="sd">            and the inverse mapping generated by `invert()`.</span>
</span><span id="remap-18"><a href="#remap-18"><span class="linenos">18</span></a><span class="sd">        popmap (dict, optional): A mapping from unit unique identifiers to</span>
</span><span id="remap-19"><a href="#remap-19"><span class="linenos">19</span></a><span class="sd">            population values. Only applies when we are mapping from smaller</span>
</span><span id="remap-20"><a href="#remap-20"><span class="linenos">20</span></a><span class="sd">            units to larger ones.</span>
</span><span id="remap-21"><a href="#remap-21"><span class="linenos">21</span></a>
</span><span id="remap-22"><a href="#remap-22"><span class="linenos">22</span></a><span class="sd">    Returns:</span>
</span><span id="remap-23"><a href="#remap-23"><span class="linenos">23</span></a><span class="sd">        A function</span>
</span><span id="remap-24"><a href="#remap-24"><span class="linenos">24</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="remap-25"><a href="#remap-25"><span class="linenos">25</span></a>
</span><span id="remap-26"><a href="#remap-26"><span class="linenos">26</span></a>    <span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
</span><span id="remap-27"><a href="#remap-27"><span class="linenos">27</span></a>        <span class="c1"># Get the assignment for the row.</span>
</span><span id="remap-28"><a href="#remap-28"><span class="linenos">28</span></a>        <span class="n">assignment</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;plan&quot;</span><span class="p">])</span>
</span><span id="remap-29"><a href="#remap-29"><span class="linenos">29</span></a>
</span><span id="remap-30"><a href="#remap-30"><span class="linenos">30</span></a>        <span class="c1"># Attempt to get the type of units specified by the row; if we</span>
</span><span id="remap-31"><a href="#remap-31"><span class="linenos">31</span></a>        <span class="c1"># can&#39;t  i.e.the user didn&#39;t specify a unit mapping corresponding</span>
</span><span id="remap-32"><a href="#remap-32"><span class="linenos">32</span></a>        <span class="c1"># to that unit typein `unitmaps` we leave the assignment alone and warn the user.</span>
</span><span id="remap-33"><a href="#remap-33"><span class="linenos">33</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="remap-34"><a href="#remap-34"><span class="linenos">34</span></a>            <span class="n">unitsType</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span>
</span><span id="remap-35"><a href="#remap-35"><span class="linenos">35</span></a>            <span class="n">unitmap</span> <span class="o">=</span> <span class="n">unitmaps</span><span class="p">[</span><span class="n">unitsType</span><span class="p">]</span>
</span><span id="remap-36"><a href="#remap-36"><span class="linenos">36</span></a>        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
</span><span id="remap-37"><a href="#remap-37"><span class="linenos">37</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No unit mapping provided for </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">; skipping.&quot;</span><span class="p">)</span>
</span><span id="remap-38"><a href="#remap-38"><span class="linenos">38</span></a>            <span class="k">return</span> <span class="n">assignment</span>
</span><span id="remap-39"><a href="#remap-39"><span class="linenos">39</span></a>
</span><span id="remap-40"><a href="#remap-40"><span class="linenos">40</span></a>        <span class="c1"># What kind of mapping do we have? If `mapping` is from a single key</span>
</span><span id="remap-41"><a href="#remap-41"><span class="linenos">41</span></a>        <span class="c1"># to a single value, then we&#39;re mapping units one-to-one (e.g. block</span>
</span><span id="remap-42"><a href="#remap-42"><span class="linenos">42</span></a>        <span class="c1"># IDs to VTD IDs); otherwise, we&#39;re mapping units one-to-many (e.g.</span>
</span><span id="remap-43"><a href="#remap-43"><span class="linenos">43</span></a>        <span class="c1"># VTD IDs to blocks). If `mapping` is of the former type, then</span>
</span><span id="remap-44"><a href="#remap-44"><span class="linenos">44</span></a>        <span class="c1"># it&#39;s possible that some larger units may comprise smaller units</span>
</span><span id="remap-45"><a href="#remap-45"><span class="linenos">45</span></a>        <span class="c1"># in multiple districts. If this is the case, then we assign larger</span>
</span><span id="remap-46"><a href="#remap-46"><span class="linenos">46</span></a>        <span class="c1"># units to the district in which most of the larger unit&#39;s population</span>
</span><span id="remap-47"><a href="#remap-47"><span class="linenos">47</span></a>        <span class="c1"># resides; otherwise, we simply assign all smaller units to whichever</span>
</span><span id="remap-48"><a href="#remap-48"><span class="linenos">48</span></a>        <span class="c1"># district the larger unit&#39;s in.</span>
</span><span id="remap-49"><a href="#remap-49"><span class="linenos">49</span></a>        <span class="n">firstvalue</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">unitmap</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span><span id="remap-50"><a href="#remap-50"><span class="linenos">50</span></a>        <span class="n">unitmapdirection</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>
</span><span id="remap-51"><a href="#remap-51"><span class="linenos">51</span></a>
</span><span id="remap-52"><a href="#remap-52"><span class="linenos">52</span></a>        <span class="c1"># Mark which kind of mapping we have.</span>
</span><span id="remap-53"><a href="#remap-53"><span class="linenos">53</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">firstvalue</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="remap-54"><a href="#remap-54"><span class="linenos">54</span></a>            <span class="n">unitmapdirection</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>
</span><span id="remap-55"><a href="#remap-55"><span class="linenos">55</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="remap-56"><a href="#remap-56"><span class="linenos">56</span></a>            <span class="n">unitmapdirection</span> <span class="o">=</span> <span class="s2">&quot;up&quot;</span>
</span><span id="remap-57"><a href="#remap-57"><span class="linenos">57</span></a>
</span><span id="remap-58"><a href="#remap-58"><span class="linenos">58</span></a>        <span class="c1"># Now, based on the mapping type, return the appropriate mapping.</span>
</span><span id="remap-59"><a href="#remap-59"><span class="linenos">59</span></a>        <span class="k">if</span> <span class="n">unitmapdirection</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
</span><span id="remap-60"><a href="#remap-60"><span class="linenos">60</span></a>            <span class="k">return</span> <span class="n">_down</span><span class="p">(</span><span class="n">unitmap</span><span class="p">,</span> <span class="n">assignment</span><span class="p">)</span>
</span><span id="remap-61"><a href="#remap-61"><span class="linenos">61</span></a>        <span class="k">return</span> <span class="n">_up</span><span class="p">(</span><span class="n">unitmap</span><span class="p">,</span> <span class="n">popmap</span><span class="p">,</span> <span class="n">assignment</span><span class="p">)</span>
</span><span id="remap-62"><a href="#remap-62"><span class="linenos">62</span></a>
</span><span id="remap-63"><a href="#remap-63"><span class="linenos">63</span></a>    <span class="n">plans</span><span class="p">[</span><span class="s2">&quot;plan&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plans</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="remap-64"><a href="#remap-64"><span class="linenos">64</span></a>    <span class="k">return</span> <span class="n">plans</span>
</span></pre></div>


            <div class="docstring"><p>Re-maps assignments to the specified set of units.</p>

<p>Args:
    plans (DataFrame): The Pandas DataFrame produced by <code><a href="#tabularized">tabularized()</a></code>.
    unitmaps (dict): A dictionary whose keys are unit types appearing
        in the <code>unitsType</code> column, and whose values are dictionaries
        mapping unique identifiers of one set of geometries to unique
        identifiers (or lists of unique identifiers) of another set of
        geometries; these correspond to mappings generated by <code>unitmap()</code>
        and the inverse mapping generated by <code>invert()</code>.
    popmap (dict, optional): A mapping from unit unique identifiers to
        population values. Only applies when we are mapping from smaller
        units to larger ones.</p>

<p>Returns:
    A function</p>
</div>


                </section>
                <section id="ids">
                            <input id="ids-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ids</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">state</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ids-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ids"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ids-5"><a href="#ids-5"><span class="linenos"> 5</span></a><span class="k">def</span> <span class="nf">ids</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
</span><span id="ids-6"><a href="#ids-6"><span class="linenos"> 6</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ids-7"><a href="#ids-7"><span class="linenos"> 7</span></a><span class="sd">    URL for accessing districtr identifiers.</span>
</span><span id="ids-8"><a href="#ids-8"><span class="linenos"> 8</span></a>
</span><span id="ids-9"><a href="#ids-9"><span class="linenos"> 9</span></a><span class="sd">    Args:</span>
</span><span id="ids-10"><a href="#ids-10"><span class="linenos">10</span></a><span class="sd">        state: Name of the state (e.g. `&quot;wisconsin&quot;`) for which we&#39;re retrieving</span>
</span><span id="ids-11"><a href="#ids-11"><span class="linenos">11</span></a><span class="sd">            districtr identifiers.</span>
</span><span id="ids-12"><a href="#ids-12"><span class="linenos">12</span></a>
</span><span id="ids-13"><a href="#ids-13"><span class="linenos">13</span></a><span class="sd">    Returns:</span>
</span><span id="ids-14"><a href="#ids-14"><span class="linenos">14</span></a><span class="sd">        String with the appropriate URL.</span>
</span><span id="ids-15"><a href="#ids-15"><span class="linenos">15</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ids-16"><a href="#ids-16"><span class="linenos">16</span></a>    <span class="c1"># If we&#39;re in michigan, then we use the &#39;beta&#39; pipeline instead of the &#39;prod&#39;</span>
</span><span id="ids-17"><a href="#ids-17"><span class="linenos">17</span></a>    <span class="c1"># one.</span>
</span><span id="ids-18"><a href="#ids-18"><span class="linenos">18</span></a>    <span class="n">pipeline</span> <span class="o">=</span> <span class="s2">&quot;beta&quot;</span> <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">us</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">MI</span> <span class="k">else</span> <span class="s2">&quot;prod&quot;</span>
</span><span id="ids-19"><a href="#ids-19"><span class="linenos">19</span></a>    <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">us</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">MI</span><span class="p">:</span>
</span><span id="ids-20"><a href="#ids-20"><span class="linenos">20</span></a>        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;https://o1siz7rw0c.execute-api.us-east-2.amazonaws.com&quot;</span>
</span><span id="ids-21"><a href="#ids-21"><span class="linenos">21</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="ids-22"><a href="#ids-22"><span class="linenos">22</span></a>        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;https://k61e3cz2ni.execute-api.us-east-2.amazonaws.com&quot;</span>
</span><span id="ids-23"><a href="#ids-23"><span class="linenos">23</span></a>
</span><span id="ids-24"><a href="#ids-24"><span class="linenos">24</span></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">pipeline</span><span class="si">}</span><span class="s2">/submissions/districtr-ids/</span><span class="si">{</span><span class="n">state</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>URL for accessing districtr identifiers.</p>

<p>Args:
    state: Name of the state (e.g. <code>"wisconsin"</code>) for which we're retrieving
        districtr identifiers.</p>

<p>Returns:
    String with the appropriate URL.</p>
</div>


                </section>
                <section id="one">
                            <input id="one-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">one</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">identifier</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="one-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#one"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="one-49"><a href="#one-49"><span class="linenos">49</span></a><span class="k">def</span> <span class="nf">one</span><span class="p">(</span><span class="n">identifier</span><span class="p">):</span>
</span><span id="one-50"><a href="#one-50"><span class="linenos">50</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="one-51"><a href="#one-51"><span class="linenos">51</span></a><span class="sd">    URL for accessing an individual districtr plan.</span>
</span><span id="one-52"><a href="#one-52"><span class="linenos">52</span></a>
</span><span id="one-53"><a href="#one-53"><span class="linenos">53</span></a><span class="sd">    Args:</span>
</span><span id="one-54"><a href="#one-54"><span class="linenos">54</span></a><span class="sd">        identifier: districtr identifier.</span>
</span><span id="one-55"><a href="#one-55"><span class="linenos">55</span></a>
</span><span id="one-56"><a href="#one-56"><span class="linenos">56</span></a><span class="sd">    Returns:</span>
</span><span id="one-57"><a href="#one-57"><span class="linenos">57</span></a><span class="sd">        String with the appropriate URL.</span>
</span><span id="one-58"><a href="#one-58"><span class="linenos">58</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="one-59"><a href="#one-59"><span class="linenos">59</span></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;https://districtr.org/.netlify/functions/planRead?id=</span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>URL for accessing an individual districtr plan.</p>

<p>Args:
    identifier: districtr identifier.</p>

<p>Returns:
    String with the appropriate URL.</p>
</div>


                </section>
                <section id="csvs">
                            <input id="csvs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">csvs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">state</span>, </span><span class="param"><span class="n">ptype</span><span class="o">=</span><span class="s1">&#39;plan&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="csvs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#csvs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="csvs-27"><a href="#csvs-27"><span class="linenos">27</span></a><span class="k">def</span> <span class="nf">csvs</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="s2">&quot;plan&quot;</span><span class="p">):</span>
</span><span id="csvs-28"><a href="#csvs-28"><span class="linenos">28</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="csvs-29"><a href="#csvs-29"><span class="linenos">29</span></a><span class="sd">    URL for accessing districtr plan metadata.</span>
</span><span id="csvs-30"><a href="#csvs-30"><span class="linenos">30</span></a>
</span><span id="csvs-31"><a href="#csvs-31"><span class="linenos">31</span></a><span class="sd">    Args:</span>
</span><span id="csvs-32"><a href="#csvs-32"><span class="linenos">32</span></a><span class="sd">        state: `us.States` object (e.g. `us.states.WI`)</span>
</span><span id="csvs-33"><a href="#csvs-33"><span class="linenos">33</span></a><span class="sd">        ptype: Type of plan we&#39;re retrieving; defaults to `&quot;plan&quot;`.</span>
</span><span id="csvs-34"><a href="#csvs-34"><span class="linenos">34</span></a>
</span><span id="csvs-35"><a href="#csvs-35"><span class="linenos">35</span></a><span class="sd">    Returns:</span>
</span><span id="csvs-36"><a href="#csvs-36"><span class="linenos">36</span></a><span class="sd">        String with the appropriate URL.</span>
</span><span id="csvs-37"><a href="#csvs-37"><span class="linenos">37</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="csvs-38"><a href="#csvs-38"><span class="linenos">38</span></a>    <span class="n">pipeline</span> <span class="o">=</span> <span class="s2">&quot;beta&quot;</span> <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">us</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">MI</span> <span class="k">else</span> <span class="s2">&quot;prod&quot;</span>
</span><span id="csvs-39"><a href="#csvs-39"><span class="linenos">39</span></a>    <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">us</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">MI</span><span class="p">:</span>
</span><span id="csvs-40"><a href="#csvs-40"><span class="linenos">40</span></a>        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;https://o1siz7rw0c.execute-api.us-east-2.amazonaws.com&quot;</span>
</span><span id="csvs-41"><a href="#csvs-41"><span class="linenos">41</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="csvs-42"><a href="#csvs-42"><span class="linenos">42</span></a>        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;https://k61e3cz2ni.execute-api.us-east-2.amazonaws.com&quot;</span>
</span><span id="csvs-43"><a href="#csvs-43"><span class="linenos">43</span></a>
</span><span id="csvs-44"><a href="#csvs-44"><span class="linenos">44</span></a>    <span class="n">suffix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;?type=</span><span class="si">{</span><span class="n">ptype</span><span class="si">}</span><span class="s2">&amp;length=10000&quot;</span>
</span><span id="csvs-45"><a href="#csvs-45"><span class="linenos">45</span></a>
</span><span id="csvs-46"><a href="#csvs-46"><span class="linenos">46</span></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">pipeline</span><span class="si">}</span><span class="s2">/submissions/csv/</span><span class="si">{</span><span class="n">state</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>URL for accessing districtr plan metadata.</p>

<p>Args:
    state: <code>us.States</code> object (e.g. <code>us.states.WI</code>)
    ptype: Type of plan we're retrieving; defaults to <code>"plan"</code>.</p>

<p>Returns:
    String with the appropriate URL.</p>
</div>


                </section>
                <section id="AssignmentCompressor">
                            <input id="AssignmentCompressor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AssignmentCompressor</span>:

                <label class="view-source-button" for="AssignmentCompressor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AssignmentCompressor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AssignmentCompressor-8"><a href="#AssignmentCompressor-8"><span class="linenos">  8</span></a><span class="k">class</span> <span class="nc">AssignmentCompressor</span><span class="p">:</span>
</span><span id="AssignmentCompressor-9"><a href="#AssignmentCompressor-9"><span class="linenos">  9</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-10"><a href="#AssignmentCompressor-10"><span class="linenos"> 10</span></a><span class="sd">    A class for compressing and decompressing lots of assignments very, very</span>
</span><span id="AssignmentCompressor-11"><a href="#AssignmentCompressor-11"><span class="linenos"> 11</span></a><span class="sd">    quickly. Intended for use with ``jsonlines``-like libraries (where</span>
</span><span id="AssignmentCompressor-12"><a href="#AssignmentCompressor-12"><span class="linenos"> 12</span></a><span class="sd">    assignments are read in line-by-line) or for network requests (where</span>
</span><span id="AssignmentCompressor-13"><a href="#AssignmentCompressor-13"><span class="linenos"> 13</span></a><span class="sd">    assignments are retrieved one-by-one). When decompressing, yields ``dict``s</span>
</span><span id="AssignmentCompressor-14"><a href="#AssignmentCompressor-14"><span class="linenos"> 14</span></a><span class="sd">    where keys are in sorted order.</span>
</span><span id="AssignmentCompressor-15"><a href="#AssignmentCompressor-15"><span class="linenos"> 15</span></a>
</span><span id="AssignmentCompressor-16"><a href="#AssignmentCompressor-16"><span class="linenos"> 16</span></a><span class="sd">    The compression schema considers the set of unique identifiers, imposes an</span>
</span><span id="AssignmentCompressor-17"><a href="#AssignmentCompressor-17"><span class="linenos"> 17</span></a><span class="sd">    ordering (lexicographic order) on the identifiers, and matches the</span>
</span><span id="AssignmentCompressor-18"><a href="#AssignmentCompressor-18"><span class="linenos"> 18</span></a><span class="sd">    assignment to that ordering. We assign all unassigned units to ``&quot;-1&quot;``</span>
</span><span id="AssignmentCompressor-19"><a href="#AssignmentCompressor-19"><span class="linenos"> 19</span></a><span class="sd">    and, once the default cache size is hit (or assignments are no longer being</span>
</span><span id="AssignmentCompressor-20"><a href="#AssignmentCompressor-20"><span class="linenos"> 20</span></a><span class="sd">    read in), compress all assignments in the cache. Assignments are read in</span>
</span><span id="AssignmentCompressor-21"><a href="#AssignmentCompressor-21"><span class="linenos"> 21</span></a><span class="sd">    and out in the same order, and the keys for each assignment are in the</span>
</span><span id="AssignmentCompressor-22"><a href="#AssignmentCompressor-22"><span class="linenos"> 22</span></a><span class="sd">    same order.</span>
</span><span id="AssignmentCompressor-23"><a href="#AssignmentCompressor-23"><span class="linenos"> 23</span></a>
</span><span id="AssignmentCompressor-24"><a href="#AssignmentCompressor-24"><span class="linenos"> 24</span></a><span class="sd">    Example:</span>
</span><span id="AssignmentCompressor-25"><a href="#AssignmentCompressor-25"><span class="linenos"> 25</span></a><span class="sd">        To compress assignments, we need a set of unique identifiers such that</span>
</span><span id="AssignmentCompressor-26"><a href="#AssignmentCompressor-26"><span class="linenos"> 26</span></a><span class="sd">        each identifier maps one geometric unit to one district.</span>
</span><span id="AssignmentCompressor-27"><a href="#AssignmentCompressor-27"><span class="linenos"> 27</span></a>
</span><span id="AssignmentCompressor-28"><a href="#AssignmentCompressor-28"><span class="linenos"> 28</span></a><span class="sd">            ...</span>
</span><span id="AssignmentCompressor-29"><a href="#AssignmentCompressor-29"><span class="linenos"> 29</span></a>
</span><span id="AssignmentCompressor-30"><a href="#AssignmentCompressor-30"><span class="linenos"> 30</span></a><span class="sd">            geoids = blocks[&quot;GEOID20&quot;].astype(str)</span>
</span><span id="AssignmentCompressor-31"><a href="#AssignmentCompressor-31"><span class="linenos"> 31</span></a><span class="sd">            ac = AssignmentCompressor(</span>
</span><span id="AssignmentCompressor-32"><a href="#AssignmentCompressor-32"><span class="linenos"> 32</span></a><span class="sd">                 geoids, location=&quot;compressed-assignments.ac&quot;)</span>
</span><span id="AssignmentCompressor-33"><a href="#AssignmentCompressor-33"><span class="linenos"> 33</span></a>
</span><span id="AssignmentCompressor-34"><a href="#AssignmentCompressor-34"><span class="linenos"> 34</span></a><span class="sd">            with ac as compressor:</span>
</span><span id="AssignmentCompressor-35"><a href="#AssignmentCompressor-35"><span class="linenos"> 35</span></a><span class="sd">                for assignment in assignments:</span>
</span><span id="AssignmentCompressor-36"><a href="#AssignmentCompressor-36"><span class="linenos"> 36</span></a><span class="sd">                    # Here, ensure that all assignments have string keys and</span>
</span><span id="AssignmentCompressor-37"><a href="#AssignmentCompressor-37"><span class="linenos"> 37</span></a><span class="sd">                    # string values; also ensure that an assignment&#39;s keys are</span>
</span><span id="AssignmentCompressor-38"><a href="#AssignmentCompressor-38"><span class="linenos"> 38</span></a><span class="sd">                    # a subset of geoids (or whatever IDs you&#39;re passing).</span>
</span><span id="AssignmentCompressor-39"><a href="#AssignmentCompressor-39"><span class="linenos"> 39</span></a><span class="sd">                    compressor.compress(assignment)</span>
</span><span id="AssignmentCompressor-40"><a href="#AssignmentCompressor-40"><span class="linenos"> 40</span></a>
</span><span id="AssignmentCompressor-41"><a href="#AssignmentCompressor-41"><span class="linenos"> 41</span></a><span class="sd">            ...</span>
</span><span id="AssignmentCompressor-42"><a href="#AssignmentCompressor-42"><span class="linenos"> 42</span></a>
</span><span id="AssignmentCompressor-43"><a href="#AssignmentCompressor-43"><span class="linenos"> 43</span></a><span class="sd">        To decompress assignments, we again must have a set of unique geometric</span>
</span><span id="AssignmentCompressor-44"><a href="#AssignmentCompressor-44"><span class="linenos"> 44</span></a><span class="sd">        identifiers which match the assignments. We can then iterate over the</span>
</span><span id="AssignmentCompressor-45"><a href="#AssignmentCompressor-45"><span class="linenos"> 45</span></a><span class="sd">        decompressed assignments as they&#39;re read out of the file.</span>
</span><span id="AssignmentCompressor-46"><a href="#AssignmentCompressor-46"><span class="linenos"> 46</span></a>
</span><span id="AssignmentCompressor-47"><a href="#AssignmentCompressor-47"><span class="linenos"> 47</span></a><span class="sd">            ...</span>
</span><span id="AssignmentCompressor-48"><a href="#AssignmentCompressor-48"><span class="linenos"> 48</span></a>
</span><span id="AssignmentCompressor-49"><a href="#AssignmentCompressor-49"><span class="linenos"> 49</span></a><span class="sd">            geoids = blocks[&quot;GEOID20&quot;].astype(str)</span>
</span><span id="AssignmentCompressor-50"><a href="#AssignmentCompressor-50"><span class="linenos"> 50</span></a><span class="sd">            ac = AssignmentCompressor(geoids, location=&quot;compressed-assignments.ac&quot;)</span>
</span><span id="AssignmentCompressor-51"><a href="#AssignmentCompressor-51"><span class="linenos"> 51</span></a>
</span><span id="AssignmentCompressor-52"><a href="#AssignmentCompressor-52"><span class="linenos"> 52</span></a><span class="sd">            for assignment in ac.decompress():</span>
</span><span id="AssignmentCompressor-53"><a href="#AssignmentCompressor-53"><span class="linenos"> 53</span></a><span class="sd">                &lt;do whatever!&gt;</span>
</span><span id="AssignmentCompressor-54"><a href="#AssignmentCompressor-54"><span class="linenos"> 54</span></a>
</span><span id="AssignmentCompressor-55"><a href="#AssignmentCompressor-55"><span class="linenos"> 55</span></a><span class="sd">            ...</span>
</span><span id="AssignmentCompressor-56"><a href="#AssignmentCompressor-56"><span class="linenos"> 56</span></a>
</span><span id="AssignmentCompressor-57"><a href="#AssignmentCompressor-57"><span class="linenos"> 57</span></a><span class="sd">    Attributes:</span>
</span><span id="AssignmentCompressor-58"><a href="#AssignmentCompressor-58"><span class="linenos"> 58</span></a><span class="sd">        DISTRICT_DELIMITER (bytes): A bytestring which separates district</span>
</span><span id="AssignmentCompressor-59"><a href="#AssignmentCompressor-59"><span class="linenos"> 59</span></a><span class="sd">            identifiers in an assignment.</span>
</span><span id="AssignmentCompressor-60"><a href="#AssignmentCompressor-60"><span class="linenos"> 60</span></a><span class="sd">        ASSIGNMENT_DELIMITER (bytes): A bytestring which separates assignments from</span>
</span><span id="AssignmentCompressor-61"><a href="#AssignmentCompressor-61"><span class="linenos"> 61</span></a><span class="sd">            each other.</span>
</span><span id="AssignmentCompressor-62"><a href="#AssignmentCompressor-62"><span class="linenos"> 62</span></a><span class="sd">        CHUNK_DELIMITER (bytes): A bytestring which separates assignment chunks</span>
</span><span id="AssignmentCompressor-63"><a href="#AssignmentCompressor-63"><span class="linenos"> 63</span></a><span class="sd">            from each other.</span>
</span><span id="AssignmentCompressor-64"><a href="#AssignmentCompressor-64"><span class="linenos"> 64</span></a><span class="sd">        CHUNK_SIZE (int): Default number of bytes read in from the IO stream at each</span>
</span><span id="AssignmentCompressor-65"><a href="#AssignmentCompressor-65"><span class="linenos"> 65</span></a><span class="sd">            step.</span>
</span><span id="AssignmentCompressor-66"><a href="#AssignmentCompressor-66"><span class="linenos"> 66</span></a><span class="sd">        ENCODING (str): Default string encoding style.</span>
</span><span id="AssignmentCompressor-67"><a href="#AssignmentCompressor-67"><span class="linenos"> 67</span></a><span class="sd">        identifiers: A sortable, iterable collection of unique items corresponding</span>
</span><span id="AssignmentCompressor-68"><a href="#AssignmentCompressor-68"><span class="linenos"> 68</span></a><span class="sd">            to geographic identifiers.</span>
</span><span id="AssignmentCompressor-69"><a href="#AssignmentCompressor-69"><span class="linenos"> 69</span></a><span class="sd">        compressed: A pandas `Index` containing the identifiers; this is used</span>
</span><span id="AssignmentCompressor-70"><a href="#AssignmentCompressor-70"><span class="linenos"> 70</span></a><span class="sd">            to quickly perform vectorized identifier matchings, rather than using</span>
</span><span id="AssignmentCompressor-71"><a href="#AssignmentCompressor-71"><span class="linenos"> 71</span></a><span class="sd">            traditional iterative methods.</span>
</span><span id="AssignmentCompressor-72"><a href="#AssignmentCompressor-72"><span class="linenos"> 72</span></a><span class="sd">        cache: Collection of assignments to be compressed. Assignments are loaded</span>
</span><span id="AssignmentCompressor-73"><a href="#AssignmentCompressor-73"><span class="linenos"> 73</span></a><span class="sd">            into the cache every time the ``.compress()`` method is called, and</span>
</span><span id="AssignmentCompressor-74"><a href="#AssignmentCompressor-74"><span class="linenos"> 74</span></a><span class="sd">            is cleared whenever the length of the cache exceeds the window width.</span>
</span><span id="AssignmentCompressor-75"><a href="#AssignmentCompressor-75"><span class="linenos"> 75</span></a><span class="sd">        window: Maximum cache length before the cache is compressed, written to</span>
</span><span id="AssignmentCompressor-76"><a href="#AssignmentCompressor-76"><span class="linenos"> 76</span></a><span class="sd">            file, and emptied.</span>
</span><span id="AssignmentCompressor-77"><a href="#AssignmentCompressor-77"><span class="linenos"> 77</span></a><span class="sd">        default: The default assignment which is updated each time an assignment</span>
</span><span id="AssignmentCompressor-78"><a href="#AssignmentCompressor-78"><span class="linenos"> 78</span></a><span class="sd">            is passed to the compressor.</span>
</span><span id="AssignmentCompressor-79"><a href="#AssignmentCompressor-79"><span class="linenos"> 79</span></a><span class="sd">        location: The place to which compressed data is written or read.</span>
</span><span id="AssignmentCompressor-80"><a href="#AssignmentCompressor-80"><span class="linenos"> 80</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-81"><a href="#AssignmentCompressor-81"><span class="linenos"> 81</span></a>
</span><span id="AssignmentCompressor-82"><a href="#AssignmentCompressor-82"><span class="linenos"> 82</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifiers</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;compressed.ac&quot;</span><span class="p">):</span>
</span><span id="AssignmentCompressor-83"><a href="#AssignmentCompressor-83"><span class="linenos"> 83</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-84"><a href="#AssignmentCompressor-84"><span class="linenos"> 84</span></a><span class="sd">        Creates `AssignmentCompressor` instance.</span>
</span><span id="AssignmentCompressor-85"><a href="#AssignmentCompressor-85"><span class="linenos"> 85</span></a>
</span><span id="AssignmentCompressor-86"><a href="#AssignmentCompressor-86"><span class="linenos"> 86</span></a><span class="sd">        Args:</span>
</span><span id="AssignmentCompressor-87"><a href="#AssignmentCompressor-87"><span class="linenos"> 87</span></a><span class="sd">            identifiers (list): An iterable collection of string identifiers; any</span>
</span><span id="AssignmentCompressor-88"><a href="#AssignmentCompressor-88"><span class="linenos"> 88</span></a><span class="sd">                assignment&#39;s keys must be a subset of `identifiers`.</span>
</span><span id="AssignmentCompressor-89"><a href="#AssignmentCompressor-89"><span class="linenos"> 89</span></a><span class="sd">            window (int, optional): A positive integer representing the cache</span>
</span><span id="AssignmentCompressor-90"><a href="#AssignmentCompressor-90"><span class="linenos"> 90</span></a><span class="sd">                window size. Defaults to cache.</span>
</span><span id="AssignmentCompressor-91"><a href="#AssignmentCompressor-91"><span class="linenos"> 91</span></a><span class="sd">            location (str, optional): The path to the compressed resource (read</span>
</span><span id="AssignmentCompressor-92"><a href="#AssignmentCompressor-92"><span class="linenos"> 92</span></a><span class="sd">                or write). Defaults to `compressed.ac`.</span>
</span><span id="AssignmentCompressor-93"><a href="#AssignmentCompressor-93"><span class="linenos"> 93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-94"><a href="#AssignmentCompressor-94"><span class="linenos"> 94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span> <span class="o">=</span> <span class="n">SortedList</span><span class="p">(</span><span class="n">identifiers</span><span class="p">)</span>
</span><span id="AssignmentCompressor-95"><a href="#AssignmentCompressor-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;-1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="p">)))</span>
</span><span id="AssignmentCompressor-96"><a href="#AssignmentCompressor-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AssignmentCompressor-97"><a href="#AssignmentCompressor-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">location</span>
</span><span id="AssignmentCompressor-98"><a href="#AssignmentCompressor-98"><span class="linenos"> 98</span></a>
</span><span id="AssignmentCompressor-99"><a href="#AssignmentCompressor-99"><span class="linenos"> 99</span></a>        <span class="c1"># Error to users if the window is nonexistent.</span>
</span><span id="AssignmentCompressor-100"><a href="#AssignmentCompressor-100"><span class="linenos">100</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">window</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="AssignmentCompressor-101"><a href="#AssignmentCompressor-101"><span class="linenos">101</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cache window width must be a positive integer.&quot;</span><span class="p">)</span>
</span><span id="AssignmentCompressor-102"><a href="#AssignmentCompressor-102"><span class="linenos">102</span></a>
</span><span id="AssignmentCompressor-103"><a href="#AssignmentCompressor-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">window</span>
</span><span id="AssignmentCompressor-104"><a href="#AssignmentCompressor-104"><span class="linenos">104</span></a>
</span><span id="AssignmentCompressor-105"><a href="#AssignmentCompressor-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DISTRICT_DELIMITER</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;,&quot;</span>
</span><span id="AssignmentCompressor-106"><a href="#AssignmentCompressor-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ASSIGNMENT_DELIMITER</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&lt;&lt;&lt;*&gt;&gt;&gt;&quot;</span>
</span><span id="AssignmentCompressor-107"><a href="#AssignmentCompressor-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CHUNK_DELIMITER</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;(((*)))&quot;</span>
</span><span id="AssignmentCompressor-108"><a href="#AssignmentCompressor-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CHUNK_SIZE</span> <span class="o">=</span> <span class="mi">16384</span>
</span><span id="AssignmentCompressor-109"><a href="#AssignmentCompressor-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ENCODING</span> <span class="o">=</span> <span class="s2">&quot;raw_unicode_escape&quot;</span>
</span><span id="AssignmentCompressor-110"><a href="#AssignmentCompressor-110"><span class="linenos">110</span></a>
</span><span id="AssignmentCompressor-111"><a href="#AssignmentCompressor-111"><span class="linenos">111</span></a>    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assignment</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SortedDict</span><span class="p">:</span>
</span><span id="AssignmentCompressor-112"><a href="#AssignmentCompressor-112"><span class="linenos">112</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-113"><a href="#AssignmentCompressor-113"><span class="linenos">113</span></a><span class="sd">        Matches an assignment to an index (the set of geometric identifiers)</span>
</span><span id="AssignmentCompressor-114"><a href="#AssignmentCompressor-114"><span class="linenos">114</span></a><span class="sd">        and returns a `SortedDict`.</span>
</span><span id="AssignmentCompressor-115"><a href="#AssignmentCompressor-115"><span class="linenos">115</span></a>
</span><span id="AssignmentCompressor-116"><a href="#AssignmentCompressor-116"><span class="linenos">116</span></a><span class="sd">        Args:</span>
</span><span id="AssignmentCompressor-117"><a href="#AssignmentCompressor-117"><span class="linenos">117</span></a><span class="sd">            assignment (dict): Dictionary which matches geometric identifiers to</span>
</span><span id="AssignmentCompressor-118"><a href="#AssignmentCompressor-118"><span class="linenos">118</span></a><span class="sd">                districts. All keys and values in this dictionary must be strings.</span>
</span><span id="AssignmentCompressor-119"><a href="#AssignmentCompressor-119"><span class="linenos">119</span></a>
</span><span id="AssignmentCompressor-120"><a href="#AssignmentCompressor-120"><span class="linenos">120</span></a><span class="sd">        Returns:</span>
</span><span id="AssignmentCompressor-121"><a href="#AssignmentCompressor-121"><span class="linenos">121</span></a><span class="sd">            A `SortedDict` with identifiers matched ti district assignments.s</span>
</span><span id="AssignmentCompressor-122"><a href="#AssignmentCompressor-122"><span class="linenos">122</span></a>
</span><span id="AssignmentCompressor-123"><a href="#AssignmentCompressor-123"><span class="linenos">123</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-124"><a href="#AssignmentCompressor-124"><span class="linenos">124</span></a>        <span class="c1"># Create a dictionary which maps identifiers to `-1`, and update our</span>
</span><span id="AssignmentCompressor-125"><a href="#AssignmentCompressor-125"><span class="linenos">125</span></a>        <span class="c1"># dictionary with assignment values.</span>
</span><span id="AssignmentCompressor-126"><a href="#AssignmentCompressor-126"><span class="linenos">126</span></a>        <span class="n">indexer</span> <span class="o">=</span> <span class="n">SortedDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
</span><span id="AssignmentCompressor-127"><a href="#AssignmentCompressor-127"><span class="linenos">127</span></a>        <span class="n">indexer</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">assignment</span><span class="p">)</span>
</span><span id="AssignmentCompressor-128"><a href="#AssignmentCompressor-128"><span class="linenos">128</span></a>
</span><span id="AssignmentCompressor-129"><a href="#AssignmentCompressor-129"><span class="linenos">129</span></a>        <span class="k">return</span> <span class="n">indexer</span>
</span><span id="AssignmentCompressor-130"><a href="#AssignmentCompressor-130"><span class="linenos">130</span></a>
</span><span id="AssignmentCompressor-131"><a href="#AssignmentCompressor-131"><span class="linenos">131</span></a>    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AssignmentCompressor-132"><a href="#AssignmentCompressor-132"><span class="linenos">132</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-133"><a href="#AssignmentCompressor-133"><span class="linenos">133</span></a><span class="sd">        A simple context-management method. Allows the user to use `with`</span>
</span><span id="AssignmentCompressor-134"><a href="#AssignmentCompressor-134"><span class="linenos">134</span></a><span class="sd">        statements when compressing stuff so we don&#39;t have to worry about the</span>
</span><span id="AssignmentCompressor-135"><a href="#AssignmentCompressor-135"><span class="linenos">135</span></a><span class="sd">        user specifying the last item they&#39;ll be compressing.</span>
</span><span id="AssignmentCompressor-136"><a href="#AssignmentCompressor-136"><span class="linenos">136</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-137"><a href="#AssignmentCompressor-137"><span class="linenos">137</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="AssignmentCompressor-138"><a href="#AssignmentCompressor-138"><span class="linenos">138</span></a>
</span><span id="AssignmentCompressor-139"><a href="#AssignmentCompressor-139"><span class="linenos">139</span></a>    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
</span><span id="AssignmentCompressor-140"><a href="#AssignmentCompressor-140"><span class="linenos">140</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-141"><a href="#AssignmentCompressor-141"><span class="linenos">141</span></a><span class="sd">        Teardown. Once we&#39;ve exited the `with` statement (i.e. the user&#39;s all done</span>
</span><span id="AssignmentCompressor-142"><a href="#AssignmentCompressor-142"><span class="linenos">142</span></a><span class="sd">        feeding items to the compressor) we can force the remaining items to be</span>
</span><span id="AssignmentCompressor-143"><a href="#AssignmentCompressor-143"><span class="linenos">143</span></a><span class="sd">        compressed and written to file.</span>
</span><span id="AssignmentCompressor-144"><a href="#AssignmentCompressor-144"><span class="linenos">144</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-145"><a href="#AssignmentCompressor-145"><span class="linenos">145</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
</span><span id="AssignmentCompressor-146"><a href="#AssignmentCompressor-146"><span class="linenos">146</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_compress</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="AssignmentCompressor-147"><a href="#AssignmentCompressor-147"><span class="linenos">147</span></a>
</span><span id="AssignmentCompressor-148"><a href="#AssignmentCompressor-148"><span class="linenos">148</span></a>    <span class="k">def</span> <span class="nf">compress_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assignments</span><span class="p">):</span>
</span><span id="AssignmentCompressor-149"><a href="#AssignmentCompressor-149"><span class="linenos">149</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-150"><a href="#AssignmentCompressor-150"><span class="linenos">150</span></a><span class="sd">        Compresses all assignments in `assignments`.</span>
</span><span id="AssignmentCompressor-151"><a href="#AssignmentCompressor-151"><span class="linenos">151</span></a>
</span><span id="AssignmentCompressor-152"><a href="#AssignmentCompressor-152"><span class="linenos">152</span></a><span class="sd">        Args:</span>
</span><span id="AssignmentCompressor-153"><a href="#AssignmentCompressor-153"><span class="linenos">153</span></a><span class="sd">            assignments (list): List of dictionaries which match geometric identifiers</span>
</span><span id="AssignmentCompressor-154"><a href="#AssignmentCompressor-154"><span class="linenos">154</span></a><span class="sd">                to districts. All keys and values in these dictionaries must be</span>
</span><span id="AssignmentCompressor-155"><a href="#AssignmentCompressor-155"><span class="linenos">155</span></a><span class="sd">                strings.</span>
</span><span id="AssignmentCompressor-156"><a href="#AssignmentCompressor-156"><span class="linenos">156</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-157"><a href="#AssignmentCompressor-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assignments</span><span class="p">)</span>
</span><span id="AssignmentCompressor-158"><a href="#AssignmentCompressor-158"><span class="linenos">158</span></a>
</span><span id="AssignmentCompressor-159"><a href="#AssignmentCompressor-159"><span class="linenos">159</span></a>        <span class="k">with</span> <span class="bp">self</span> <span class="k">as</span> <span class="n">ac</span><span class="p">:</span>
</span><span id="AssignmentCompressor-160"><a href="#AssignmentCompressor-160"><span class="linenos">160</span></a>            <span class="k">for</span> <span class="n">assignment</span> <span class="ow">in</span> <span class="n">assignments</span><span class="p">:</span>
</span><span id="AssignmentCompressor-161"><a href="#AssignmentCompressor-161"><span class="linenos">161</span></a>                <span class="n">ac</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">assignment</span><span class="p">)</span>
</span><span id="AssignmentCompressor-162"><a href="#AssignmentCompressor-162"><span class="linenos">162</span></a>
</span><span id="AssignmentCompressor-163"><a href="#AssignmentCompressor-163"><span class="linenos">163</span></a>    <span class="k">def</span> <span class="nf">compress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assignment</span><span class="p">):</span>
</span><span id="AssignmentCompressor-164"><a href="#AssignmentCompressor-164"><span class="linenos">164</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-165"><a href="#AssignmentCompressor-165"><span class="linenos">165</span></a><span class="sd">        Compresses the assignment `assignment` using `zlib`.</span>
</span><span id="AssignmentCompressor-166"><a href="#AssignmentCompressor-166"><span class="linenos">166</span></a>
</span><span id="AssignmentCompressor-167"><a href="#AssignmentCompressor-167"><span class="linenos">167</span></a><span class="sd">        Args:</span>
</span><span id="AssignmentCompressor-168"><a href="#AssignmentCompressor-168"><span class="linenos">168</span></a><span class="sd">            assignment (dict): Dictionary which matches geometric identifiers to districts.</span>
</span><span id="AssignmentCompressor-169"><a href="#AssignmentCompressor-169"><span class="linenos">169</span></a><span class="sd">                All keys and values in this dictionary must be strings.</span>
</span><span id="AssignmentCompressor-170"><a href="#AssignmentCompressor-170"><span class="linenos">170</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-171"><a href="#AssignmentCompressor-171"><span class="linenos">171</span></a>        <span class="c1"># If the user provides an empty assignment or the assignment&#39;s keys aren&#39;t</span>
</span><span id="AssignmentCompressor-172"><a href="#AssignmentCompressor-172"><span class="linenos">172</span></a>        <span class="c1"># a subset of `identifiers`, warn the user and skip the assignment.</span>
</span><span id="AssignmentCompressor-173"><a href="#AssignmentCompressor-173"><span class="linenos">173</span></a>        <span class="n">skip</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AssignmentCompressor-174"><a href="#AssignmentCompressor-174"><span class="linenos">174</span></a>
</span><span id="AssignmentCompressor-175"><a href="#AssignmentCompressor-175"><span class="linenos">175</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">assignment</span><span class="p">:</span>
</span><span id="AssignmentCompressor-176"><a href="#AssignmentCompressor-176"><span class="linenos">176</span></a>            <span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AssignmentCompressor-177"><a href="#AssignmentCompressor-177"><span class="linenos">177</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;`assignment` is empty; skipping.&quot;</span><span class="p">)</span>
</span><span id="AssignmentCompressor-178"><a href="#AssignmentCompressor-178"><span class="linenos">178</span></a>
</span><span id="AssignmentCompressor-179"><a href="#AssignmentCompressor-179"><span class="linenos">179</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">assignment</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="p">):</span>
</span><span id="AssignmentCompressor-180"><a href="#AssignmentCompressor-180"><span class="linenos">180</span></a>            <span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AssignmentCompressor-181"><a href="#AssignmentCompressor-181"><span class="linenos">181</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="AssignmentCompressor-182"><a href="#AssignmentCompressor-182"><span class="linenos">182</span></a>                <span class="s2">&quot;`assignment`&#39;s keys are not a subset of `identifiers`; skipping. &quot;</span>
</span><span id="AssignmentCompressor-183"><a href="#AssignmentCompressor-183"><span class="linenos">183</span></a>                <span class="o">+</span> <span class="s2">&quot;Please ensure that all keys and values in `assignment` are strings.&quot;</span><span class="p">,</span>
</span><span id="AssignmentCompressor-184"><a href="#AssignmentCompressor-184"><span class="linenos">184</span></a>            <span class="p">)</span>
</span><span id="AssignmentCompressor-185"><a href="#AssignmentCompressor-185"><span class="linenos">185</span></a>
</span><span id="AssignmentCompressor-186"><a href="#AssignmentCompressor-186"><span class="linenos">186</span></a>        <span class="c1"># Join the things on the district separator, encode the whole thing, and</span>
</span><span id="AssignmentCompressor-187"><a href="#AssignmentCompressor-187"><span class="linenos">187</span></a>        <span class="c1"># encode according to the default encoding.</span>
</span><span id="AssignmentCompressor-188"><a href="#AssignmentCompressor-188"><span class="linenos">188</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">skip</span><span class="p">:</span>
</span><span id="AssignmentCompressor-189"><a href="#AssignmentCompressor-189"><span class="linenos">189</span></a>            <span class="n">indexed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">assignment</span><span class="p">)</span>
</span><span id="AssignmentCompressor-190"><a href="#AssignmentCompressor-190"><span class="linenos">190</span></a>            <span class="n">sep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DISTRICT_DELIMITER</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span><span id="AssignmentCompressor-191"><a href="#AssignmentCompressor-191"><span class="linenos">191</span></a>            <span class="n">encoded</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">indexed</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ENCODING</span><span class="p">))</span>
</span><span id="AssignmentCompressor-192"><a href="#AssignmentCompressor-192"><span class="linenos">192</span></a>
</span><span id="AssignmentCompressor-193"><a href="#AssignmentCompressor-193"><span class="linenos">193</span></a>            <span class="c1"># Compress.</span>
</span><span id="AssignmentCompressor-194"><a href="#AssignmentCompressor-194"><span class="linenos">194</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">+=</span> <span class="p">[</span><span class="n">encoded</span><span class="p">]</span>
</span><span id="AssignmentCompressor-195"><a href="#AssignmentCompressor-195"><span class="linenos">195</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_compress</span><span class="p">()</span>
</span><span id="AssignmentCompressor-196"><a href="#AssignmentCompressor-196"><span class="linenos">196</span></a>
</span><span id="AssignmentCompressor-197"><a href="#AssignmentCompressor-197"><span class="linenos">197</span></a>    <span class="k">def</span> <span class="nf">_compress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="AssignmentCompressor-198"><a href="#AssignmentCompressor-198"><span class="linenos">198</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-199"><a href="#AssignmentCompressor-199"><span class="linenos">199</span></a><span class="sd">        Private method which actually does the compression.</span>
</span><span id="AssignmentCompressor-200"><a href="#AssignmentCompressor-200"><span class="linenos">200</span></a>
</span><span id="AssignmentCompressor-201"><a href="#AssignmentCompressor-201"><span class="linenos">201</span></a><span class="sd">        Args:</span>
</span><span id="AssignmentCompressor-202"><a href="#AssignmentCompressor-202"><span class="linenos">202</span></a><span class="sd">            force: If truthy, then the length of the cache is ignored, the data</span>
</span><span id="AssignmentCompressor-203"><a href="#AssignmentCompressor-203"><span class="linenos">203</span></a><span class="sd">                in the cache are compressed, and the compressed data is written</span>
</span><span id="AssignmentCompressor-204"><a href="#AssignmentCompressor-204"><span class="linenos">204</span></a><span class="sd">                to file. ``force`` is truthy when teardown logic is entered</span>
</span><span id="AssignmentCompressor-205"><a href="#AssignmentCompressor-205"><span class="linenos">205</span></a><span class="sd">                (i.e. after ``__exit()__`` is called).</span>
</span><span id="AssignmentCompressor-206"><a href="#AssignmentCompressor-206"><span class="linenos">206</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-207"><a href="#AssignmentCompressor-207"><span class="linenos">207</span></a>        <span class="c1"># Check to see if the cache is full. If so, compress the data, write to</span>
</span><span id="AssignmentCompressor-208"><a href="#AssignmentCompressor-208"><span class="linenos">208</span></a>        <span class="c1"># file, and reset the cache.</span>
</span><span id="AssignmentCompressor-209"><a href="#AssignmentCompressor-209"><span class="linenos">209</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="AssignmentCompressor-210"><a href="#AssignmentCompressor-210"><span class="linenos">210</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="s2">&quot;ab&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
</span><span id="AssignmentCompressor-211"><a href="#AssignmentCompressor-211"><span class="linenos">211</span></a>                <span class="c1"># Write compressed data to file.</span>
</span><span id="AssignmentCompressor-212"><a href="#AssignmentCompressor-212"><span class="linenos">212</span></a>                <span class="n">compressed</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span>
</span><span id="AssignmentCompressor-213"><a href="#AssignmentCompressor-213"><span class="linenos">213</span></a>                    <span class="nb">bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ASSIGNMENT_DELIMITER</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">))</span>
</span><span id="AssignmentCompressor-214"><a href="#AssignmentCompressor-214"><span class="linenos">214</span></a>                <span class="p">)</span>
</span><span id="AssignmentCompressor-215"><a href="#AssignmentCompressor-215"><span class="linenos">215</span></a>                <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">compressed</span><span class="p">)</span>
</span><span id="AssignmentCompressor-216"><a href="#AssignmentCompressor-216"><span class="linenos">216</span></a>
</span><span id="AssignmentCompressor-217"><a href="#AssignmentCompressor-217"><span class="linenos">217</span></a>                <span class="c1"># We only forcibly write the chunk separator to file if we&#39;ve</span>
</span><span id="AssignmentCompressor-218"><a href="#AssignmentCompressor-218"><span class="linenos">218</span></a>                <span class="c1"># entered teardown logic and the cache *is not empty*. If the</span>
</span><span id="AssignmentCompressor-219"><a href="#AssignmentCompressor-219"><span class="linenos">219</span></a>                <span class="c1"># cache is empty when we&#39;re entering teardown logic, that means</span>
</span><span id="AssignmentCompressor-220"><a href="#AssignmentCompressor-220"><span class="linenos">220</span></a>                <span class="c1"># (number of assignments compressed) == (window width), in which</span>
</span><span id="AssignmentCompressor-221"><a href="#AssignmentCompressor-221"><span class="linenos">221</span></a>                <span class="c1"># case we&#39;ve reached the end of compression and should not write</span>
</span><span id="AssignmentCompressor-222"><a href="#AssignmentCompressor-222"><span class="linenos">222</span></a>                <span class="c1"># a separator; doing so will produce an empty bytestring (which,</span>
</span><span id="AssignmentCompressor-223"><a href="#AssignmentCompressor-223"><span class="linenos">223</span></a>                <span class="c1"># in turn, produces a dictionary with one key, corresponding to</span>
</span><span id="AssignmentCompressor-224"><a href="#AssignmentCompressor-224"><span class="linenos">224</span></a>                <span class="c1"># a null assignment).</span>
</span><span id="AssignmentCompressor-225"><a href="#AssignmentCompressor-225"><span class="linenos">225</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
</span><span id="AssignmentCompressor-226"><a href="#AssignmentCompressor-226"><span class="linenos">226</span></a>                    <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CHUNK_DELIMITER</span><span class="p">)</span>
</span><span id="AssignmentCompressor-227"><a href="#AssignmentCompressor-227"><span class="linenos">227</span></a>
</span><span id="AssignmentCompressor-228"><a href="#AssignmentCompressor-228"><span class="linenos">228</span></a>            <span class="c1"># Reset the cache.</span>
</span><span id="AssignmentCompressor-229"><a href="#AssignmentCompressor-229"><span class="linenos">229</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AssignmentCompressor-230"><a href="#AssignmentCompressor-230"><span class="linenos">230</span></a>
</span><span id="AssignmentCompressor-231"><a href="#AssignmentCompressor-231"><span class="linenos">231</span></a>    <span class="k">def</span> <span class="nf">decompress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AssignmentCompressor-232"><a href="#AssignmentCompressor-232"><span class="linenos">232</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-233"><a href="#AssignmentCompressor-233"><span class="linenos">233</span></a><span class="sd">        Decompresses the data at ``location``. A generator which ``yield``s</span>
</span><span id="AssignmentCompressor-234"><a href="#AssignmentCompressor-234"><span class="linenos">234</span></a><span class="sd">        assignments.</span>
</span><span id="AssignmentCompressor-235"><a href="#AssignmentCompressor-235"><span class="linenos">235</span></a>
</span><span id="AssignmentCompressor-236"><a href="#AssignmentCompressor-236"><span class="linenos">236</span></a><span class="sd">        Yields:</span>
</span><span id="AssignmentCompressor-237"><a href="#AssignmentCompressor-237"><span class="linenos">237</span></a><span class="sd">            Decompressed assignment dictionaries.</span>
</span><span id="AssignmentCompressor-238"><a href="#AssignmentCompressor-238"><span class="linenos">238</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-239"><a href="#AssignmentCompressor-239"><span class="linenos">239</span></a>        <span class="c1"># Open the compressed file. Then we read it in chunks, loading until</span>
</span><span id="AssignmentCompressor-240"><a href="#AssignmentCompressor-240"><span class="linenos">240</span></a>        <span class="c1"># we hit our separator or until the end of the file.</span>
</span><span id="AssignmentCompressor-241"><a href="#AssignmentCompressor-241"><span class="linenos">241</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">_compressed_fin</span><span class="p">:</span>
</span><span id="AssignmentCompressor-242"><a href="#AssignmentCompressor-242"><span class="linenos">242</span></a>            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk</span><span class="p">(</span><span class="n">_compressed_fin</span><span class="p">):</span>
</span><span id="AssignmentCompressor-243"><a href="#AssignmentCompressor-243"><span class="linenos">243</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="p">:</span>
</span><span id="AssignmentCompressor-244"><a href="#AssignmentCompressor-244"><span class="linenos">244</span></a>                    <span class="k">break</span>
</span><span id="AssignmentCompressor-245"><a href="#AssignmentCompressor-245"><span class="linenos">245</span></a>                <span class="k">for</span> <span class="n">assignment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decompress</span><span class="p">(</span><span class="n">chunk</span><span class="p">):</span>
</span><span id="AssignmentCompressor-246"><a href="#AssignmentCompressor-246"><span class="linenos">246</span></a>                    <span class="k">yield</span> <span class="n">assignment</span>
</span><span id="AssignmentCompressor-247"><a href="#AssignmentCompressor-247"><span class="linenos">247</span></a>
</span><span id="AssignmentCompressor-248"><a href="#AssignmentCompressor-248"><span class="linenos">248</span></a>    <span class="k">def</span> <span class="nf">_chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
</span><span id="AssignmentCompressor-249"><a href="#AssignmentCompressor-249"><span class="linenos">249</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-250"><a href="#AssignmentCompressor-250"><span class="linenos">250</span></a><span class="sd">        Private method for reading chunks from file without holding the entire</span>
</span><span id="AssignmentCompressor-251"><a href="#AssignmentCompressor-251"><span class="linenos">251</span></a><span class="sd">        file in memory. A generator for decompressed assignments.</span>
</span><span id="AssignmentCompressor-252"><a href="#AssignmentCompressor-252"><span class="linenos">252</span></a>
</span><span id="AssignmentCompressor-253"><a href="#AssignmentCompressor-253"><span class="linenos">253</span></a><span class="sd">        Args:</span>
</span><span id="AssignmentCompressor-254"><a href="#AssignmentCompressor-254"><span class="linenos">254</span></a><span class="sd">            stream: A ``BytesIO`` instance from which data is read.</span>
</span><span id="AssignmentCompressor-255"><a href="#AssignmentCompressor-255"><span class="linenos">255</span></a>
</span><span id="AssignmentCompressor-256"><a href="#AssignmentCompressor-256"><span class="linenos">256</span></a><span class="sd">        Yields:</span>
</span><span id="AssignmentCompressor-257"><a href="#AssignmentCompressor-257"><span class="linenos">257</span></a><span class="sd">            Buffered, compressed bytes to be fed into the decompressor.</span>
</span><span id="AssignmentCompressor-258"><a href="#AssignmentCompressor-258"><span class="linenos">258</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-259"><a href="#AssignmentCompressor-259"><span class="linenos">259</span></a>        <span class="c1"># Create a buffer.</span>
</span><span id="AssignmentCompressor-260"><a href="#AssignmentCompressor-260"><span class="linenos">260</span></a>        <span class="n">_buffer</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AssignmentCompressor-261"><a href="#AssignmentCompressor-261"><span class="linenos">261</span></a>
</span><span id="AssignmentCompressor-262"><a href="#AssignmentCompressor-262"><span class="linenos">262</span></a>        <span class="c1"># Read until we hit the end of the file `yield`ing each chunk as we go.</span>
</span><span id="AssignmentCompressor-263"><a href="#AssignmentCompressor-263"><span class="linenos">263</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="AssignmentCompressor-264"><a href="#AssignmentCompressor-264"><span class="linenos">264</span></a>            <span class="c1"># Read in a chunk of data.</span>
</span><span id="AssignmentCompressor-265"><a href="#AssignmentCompressor-265"><span class="linenos">265</span></a>            <span class="n">chunk</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CHUNK_SIZE</span><span class="p">)</span>
</span><span id="AssignmentCompressor-266"><a href="#AssignmentCompressor-266"><span class="linenos">266</span></a>            <span class="n">_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="AssignmentCompressor-267"><a href="#AssignmentCompressor-267"><span class="linenos">267</span></a>
</span><span id="AssignmentCompressor-268"><a href="#AssignmentCompressor-268"><span class="linenos">268</span></a>            <span class="c1"># Check if the chunk has our delimiter in it. If it contains our</span>
</span><span id="AssignmentCompressor-269"><a href="#AssignmentCompressor-269"><span class="linenos">269</span></a>            <span class="c1"># delimiter, then the buffer *up to the delimiter* contains compressed</span>
</span><span id="AssignmentCompressor-270"><a href="#AssignmentCompressor-270"><span class="linenos">270</span></a>            <span class="c1"># assignments; this should be `yield`ed and decompressed. We only</span>
</span><span id="AssignmentCompressor-271"><a href="#AssignmentCompressor-271"><span class="linenos">271</span></a>            <span class="c1"># want to get the part before the delimiter for decompression, but</span>
</span><span id="AssignmentCompressor-272"><a href="#AssignmentCompressor-272"><span class="linenos">272</span></a>            <span class="c1"># retain the rest.</span>
</span><span id="AssignmentCompressor-273"><a href="#AssignmentCompressor-273"><span class="linenos">273</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CHUNK_DELIMITER</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
</span><span id="AssignmentCompressor-274"><a href="#AssignmentCompressor-274"><span class="linenos">274</span></a>                <span class="n">_buffered_bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_buffer</span><span class="p">)</span>
</span><span id="AssignmentCompressor-275"><a href="#AssignmentCompressor-275"><span class="linenos">275</span></a>                <span class="n">part</span><span class="p">,</span> <span class="n">_buffer_first</span> <span class="o">=</span> <span class="n">_buffered_bytes</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CHUNK_DELIMITER</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="AssignmentCompressor-276"><a href="#AssignmentCompressor-276"><span class="linenos">276</span></a>                <span class="n">_buffer</span> <span class="o">=</span> <span class="p">[</span><span class="n">_buffer_first</span><span class="p">]</span>
</span><span id="AssignmentCompressor-277"><a href="#AssignmentCompressor-277"><span class="linenos">277</span></a>                <span class="k">yield</span> <span class="n">part</span>
</span><span id="AssignmentCompressor-278"><a href="#AssignmentCompressor-278"><span class="linenos">278</span></a>
</span><span id="AssignmentCompressor-279"><a href="#AssignmentCompressor-279"><span class="linenos">279</span></a>            <span class="c1"># If the chunk&#39;s empty, `yield` the remaining buffer and return.</span>
</span><span id="AssignmentCompressor-280"><a href="#AssignmentCompressor-280"><span class="linenos">280</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="p">:</span>
</span><span id="AssignmentCompressor-281"><a href="#AssignmentCompressor-281"><span class="linenos">281</span></a>                <span class="k">yield</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_buffer</span><span class="p">)</span>
</span><span id="AssignmentCompressor-282"><a href="#AssignmentCompressor-282"><span class="linenos">282</span></a>                <span class="k">break</span>
</span><span id="AssignmentCompressor-283"><a href="#AssignmentCompressor-283"><span class="linenos">283</span></a>
</span><span id="AssignmentCompressor-284"><a href="#AssignmentCompressor-284"><span class="linenos">284</span></a>    <span class="k">def</span> <span class="nf">_decompress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="AssignmentCompressor-285"><a href="#AssignmentCompressor-285"><span class="linenos">285</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-286"><a href="#AssignmentCompressor-286"><span class="linenos">286</span></a><span class="sd">        Private method which decompresses assignments.</span>
</span><span id="AssignmentCompressor-287"><a href="#AssignmentCompressor-287"><span class="linenos">287</span></a>
</span><span id="AssignmentCompressor-288"><a href="#AssignmentCompressor-288"><span class="linenos">288</span></a><span class="sd">        Args:</span>
</span><span id="AssignmentCompressor-289"><a href="#AssignmentCompressor-289"><span class="linenos">289</span></a><span class="sd">            chunk: Compressed, byte-encoded data representing ``window``</span>
</span><span id="AssignmentCompressor-290"><a href="#AssignmentCompressor-290"><span class="linenos">290</span></a><span class="sd">                assignments.</span>
</span><span id="AssignmentCompressor-291"><a href="#AssignmentCompressor-291"><span class="linenos">291</span></a>
</span><span id="AssignmentCompressor-292"><a href="#AssignmentCompressor-292"><span class="linenos">292</span></a><span class="sd">        Returns:</span>
</span><span id="AssignmentCompressor-293"><a href="#AssignmentCompressor-293"><span class="linenos">293</span></a><span class="sd">            List of decompressed assignment objects.</span>
</span><span id="AssignmentCompressor-294"><a href="#AssignmentCompressor-294"><span class="linenos">294</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor-295"><a href="#AssignmentCompressor-295"><span class="linenos">295</span></a>        <span class="c1"># Decompress the chunk and split it on our delimiter.</span>
</span><span id="AssignmentCompressor-296"><a href="#AssignmentCompressor-296"><span class="linenos">296</span></a>        <span class="n">decompressed</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="AssignmentCompressor-297"><a href="#AssignmentCompressor-297"><span class="linenos">297</span></a>        <span class="n">decompressed_parts</span> <span class="o">=</span> <span class="n">decompressed</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ASSIGNMENT_DELIMITER</span><span class="p">)</span>
</span><span id="AssignmentCompressor-298"><a href="#AssignmentCompressor-298"><span class="linenos">298</span></a>
</span><span id="AssignmentCompressor-299"><a href="#AssignmentCompressor-299"><span class="linenos">299</span></a>        <span class="c1"># For each of the parts, decode the bytes, make them into lists, and</span>
</span><span id="AssignmentCompressor-300"><a href="#AssignmentCompressor-300"><span class="linenos">300</span></a>        <span class="c1"># match them to GEOIDs.</span>
</span><span id="AssignmentCompressor-301"><a href="#AssignmentCompressor-301"><span class="linenos">301</span></a>        <span class="n">decoded_parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">part</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">decompressed_parts</span><span class="p">]</span>
</span><span id="AssignmentCompressor-302"><a href="#AssignmentCompressor-302"><span class="linenos">302</span></a>        <span class="n">split_parts</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="AssignmentCompressor-303"><a href="#AssignmentCompressor-303"><span class="linenos">303</span></a>            <span class="n">part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DISTRICT_DELIMITER</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">decoded_parts</span>
</span><span id="AssignmentCompressor-304"><a href="#AssignmentCompressor-304"><span class="linenos">304</span></a>        <span class="p">]</span>
</span><span id="AssignmentCompressor-305"><a href="#AssignmentCompressor-305"><span class="linenos">305</span></a>        <span class="n">indexed_parts</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="p">,</span> <span class="n">part</span><span class="p">))</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">split_parts</span><span class="p">]</span>
</span><span id="AssignmentCompressor-306"><a href="#AssignmentCompressor-306"><span class="linenos">306</span></a>
</span><span id="AssignmentCompressor-307"><a href="#AssignmentCompressor-307"><span class="linenos">307</span></a>        <span class="k">return</span> <span class="n">indexed_parts</span>
</span></pre></div>


            <div class="docstring"><p>A class for compressing and decompressing lots of assignments very, very
quickly. Intended for use with <code>jsonlines</code>-like libraries (where
assignments are read in line-by-line) or for network requests (where
assignments are retrieved one-by-one). When decompressing, yields <code>dict</code>s
where keys are in sorted order.</p>

<p>The compression schema considers the set of unique identifiers, imposes an
ordering (lexicographic order) on the identifiers, and matches the
assignment to that ordering. We assign all unassigned units to <code>"-1"</code>
and, once the default cache size is hit (or assignments are no longer being
read in), compress all assignments in the cache. Assignments are read in
and out in the same order, and the keys for each assignment are in the
same order.</p>

<p>Example:
    To compress assignments, we need a set of unique identifiers such that
    each identifier maps one geometric unit to one district.</p>

<pre><code>    ...

    geoids = blocks["GEOID20"].astype(str)
    ac = AssignmentCompressor(
         geoids, location="compressed-assignments.ac")

    with ac as compressor:
        for assignment in assignments:
            # Here, ensure that all assignments have string keys and
            # string values; also ensure that an assignment's keys are
            # a subset of geoids (or whatever IDs you're passing).
            compressor.compress(assignment)

    ...

To decompress assignments, we again must have a set of unique geometric
identifiers which match the assignments. We can then iterate over the
decompressed assignments as they're read out of the file.

    ...

    geoids = blocks["GEOID20"].astype(str)
    ac = AssignmentCompressor(geoids, location="compressed-assignments.ac")

    for assignment in ac.decompress():
        &lt;do whatever!&gt;

    ...
</code></pre>

<p>Attributes:
    DISTRICT_DELIMITER (bytes): A bytestring which separates district
        identifiers in an assignment.
    ASSIGNMENT_DELIMITER (bytes): A bytestring which separates assignments from
        each other.
    CHUNK_DELIMITER (bytes): A bytestring which separates assignment chunks
        from each other.
    CHUNK_SIZE (int): Default number of bytes read in from the IO stream at each
        step.
    ENCODING (str): Default string encoding style.
    identifiers: A sortable, iterable collection of unique items corresponding
        to geographic identifiers.
    compressed: A pandas <code>Index</code> containing the identifiers; this is used
        to quickly perform vectorized identifier matchings, rather than using
        traditional iterative methods.
    cache: Collection of assignments to be compressed. Assignments are loaded
        into the cache every time the <code>.compress()</code> method is called, and
        is cleared whenever the length of the cache exceeds the window width.
    window: Maximum cache length before the cache is compressed, written to
        file, and emptied.
    default: The default assignment which is updated each time an assignment
        is passed to the compressor.
    location: The place to which compressed data is written or read.</p>
</div>


                            <div id="AssignmentCompressor.__init__" class="classattr">
                                        <input id="AssignmentCompressor.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">AssignmentCompressor</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">identifiers</span>, </span><span class="param"><span class="n">window</span><span class="o">=</span><span class="mi">10</span>, </span><span class="param"><span class="n">location</span><span class="o">=</span><span class="s1">&#39;compressed.ac&#39;</span></span>)</span>

                <label class="view-source-button" for="AssignmentCompressor.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AssignmentCompressor.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AssignmentCompressor.__init__-82"><a href="#AssignmentCompressor.__init__-82"><span class="linenos"> 82</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifiers</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;compressed.ac&quot;</span><span class="p">):</span>
</span><span id="AssignmentCompressor.__init__-83"><a href="#AssignmentCompressor.__init__-83"><span class="linenos"> 83</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor.__init__-84"><a href="#AssignmentCompressor.__init__-84"><span class="linenos"> 84</span></a><span class="sd">        Creates `AssignmentCompressor` instance.</span>
</span><span id="AssignmentCompressor.__init__-85"><a href="#AssignmentCompressor.__init__-85"><span class="linenos"> 85</span></a>
</span><span id="AssignmentCompressor.__init__-86"><a href="#AssignmentCompressor.__init__-86"><span class="linenos"> 86</span></a><span class="sd">        Args:</span>
</span><span id="AssignmentCompressor.__init__-87"><a href="#AssignmentCompressor.__init__-87"><span class="linenos"> 87</span></a><span class="sd">            identifiers (list): An iterable collection of string identifiers; any</span>
</span><span id="AssignmentCompressor.__init__-88"><a href="#AssignmentCompressor.__init__-88"><span class="linenos"> 88</span></a><span class="sd">                assignment&#39;s keys must be a subset of `identifiers`.</span>
</span><span id="AssignmentCompressor.__init__-89"><a href="#AssignmentCompressor.__init__-89"><span class="linenos"> 89</span></a><span class="sd">            window (int, optional): A positive integer representing the cache</span>
</span><span id="AssignmentCompressor.__init__-90"><a href="#AssignmentCompressor.__init__-90"><span class="linenos"> 90</span></a><span class="sd">                window size. Defaults to cache.</span>
</span><span id="AssignmentCompressor.__init__-91"><a href="#AssignmentCompressor.__init__-91"><span class="linenos"> 91</span></a><span class="sd">            location (str, optional): The path to the compressed resource (read</span>
</span><span id="AssignmentCompressor.__init__-92"><a href="#AssignmentCompressor.__init__-92"><span class="linenos"> 92</span></a><span class="sd">                or write). Defaults to `compressed.ac`.</span>
</span><span id="AssignmentCompressor.__init__-93"><a href="#AssignmentCompressor.__init__-93"><span class="linenos"> 93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor.__init__-94"><a href="#AssignmentCompressor.__init__-94"><span class="linenos"> 94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span> <span class="o">=</span> <span class="n">SortedList</span><span class="p">(</span><span class="n">identifiers</span><span class="p">)</span>
</span><span id="AssignmentCompressor.__init__-95"><a href="#AssignmentCompressor.__init__-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;-1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="p">)))</span>
</span><span id="AssignmentCompressor.__init__-96"><a href="#AssignmentCompressor.__init__-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AssignmentCompressor.__init__-97"><a href="#AssignmentCompressor.__init__-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">location</span>
</span><span id="AssignmentCompressor.__init__-98"><a href="#AssignmentCompressor.__init__-98"><span class="linenos"> 98</span></a>
</span><span id="AssignmentCompressor.__init__-99"><a href="#AssignmentCompressor.__init__-99"><span class="linenos"> 99</span></a>        <span class="c1"># Error to users if the window is nonexistent.</span>
</span><span id="AssignmentCompressor.__init__-100"><a href="#AssignmentCompressor.__init__-100"><span class="linenos">100</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">window</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="AssignmentCompressor.__init__-101"><a href="#AssignmentCompressor.__init__-101"><span class="linenos">101</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cache window width must be a positive integer.&quot;</span><span class="p">)</span>
</span><span id="AssignmentCompressor.__init__-102"><a href="#AssignmentCompressor.__init__-102"><span class="linenos">102</span></a>
</span><span id="AssignmentCompressor.__init__-103"><a href="#AssignmentCompressor.__init__-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">window</span>
</span><span id="AssignmentCompressor.__init__-104"><a href="#AssignmentCompressor.__init__-104"><span class="linenos">104</span></a>
</span><span id="AssignmentCompressor.__init__-105"><a href="#AssignmentCompressor.__init__-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DISTRICT_DELIMITER</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;,&quot;</span>
</span><span id="AssignmentCompressor.__init__-106"><a href="#AssignmentCompressor.__init__-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ASSIGNMENT_DELIMITER</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&lt;&lt;&lt;*&gt;&gt;&gt;&quot;</span>
</span><span id="AssignmentCompressor.__init__-107"><a href="#AssignmentCompressor.__init__-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CHUNK_DELIMITER</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;(((*)))&quot;</span>
</span><span id="AssignmentCompressor.__init__-108"><a href="#AssignmentCompressor.__init__-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CHUNK_SIZE</span> <span class="o">=</span> <span class="mi">16384</span>
</span><span id="AssignmentCompressor.__init__-109"><a href="#AssignmentCompressor.__init__-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ENCODING</span> <span class="o">=</span> <span class="s2">&quot;raw_unicode_escape&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Creates <code><a href="#AssignmentCompressor">AssignmentCompressor</a></code> instance.</p>

<p>Args:
    identifiers (list): An iterable collection of string identifiers; any
        assignment's keys must be a subset of <code>identifiers</code>.
    window (int, optional): A positive integer representing the cache
        window size. Defaults to cache.
    location (str, optional): The path to the compressed resource (read
        or write). Defaults to <code>compressed.ac</code>.</p>
</div>


                            </div>
                            <div id="AssignmentCompressor.match" class="classattr">
                                        <input id="AssignmentCompressor.match-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">match</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">assignment</span></span><span class="return-annotation">) -> <span class="n">sortedcontainers</span><span class="o">.</span><span class="n">sorteddict</span><span class="o">.</span><span class="n">SortedDict</span>:</span></span>

                <label class="view-source-button" for="AssignmentCompressor.match-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AssignmentCompressor.match"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AssignmentCompressor.match-111"><a href="#AssignmentCompressor.match-111"><span class="linenos">111</span></a>    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assignment</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SortedDict</span><span class="p">:</span>
</span><span id="AssignmentCompressor.match-112"><a href="#AssignmentCompressor.match-112"><span class="linenos">112</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor.match-113"><a href="#AssignmentCompressor.match-113"><span class="linenos">113</span></a><span class="sd">        Matches an assignment to an index (the set of geometric identifiers)</span>
</span><span id="AssignmentCompressor.match-114"><a href="#AssignmentCompressor.match-114"><span class="linenos">114</span></a><span class="sd">        and returns a `SortedDict`.</span>
</span><span id="AssignmentCompressor.match-115"><a href="#AssignmentCompressor.match-115"><span class="linenos">115</span></a>
</span><span id="AssignmentCompressor.match-116"><a href="#AssignmentCompressor.match-116"><span class="linenos">116</span></a><span class="sd">        Args:</span>
</span><span id="AssignmentCompressor.match-117"><a href="#AssignmentCompressor.match-117"><span class="linenos">117</span></a><span class="sd">            assignment (dict): Dictionary which matches geometric identifiers to</span>
</span><span id="AssignmentCompressor.match-118"><a href="#AssignmentCompressor.match-118"><span class="linenos">118</span></a><span class="sd">                districts. All keys and values in this dictionary must be strings.</span>
</span><span id="AssignmentCompressor.match-119"><a href="#AssignmentCompressor.match-119"><span class="linenos">119</span></a>
</span><span id="AssignmentCompressor.match-120"><a href="#AssignmentCompressor.match-120"><span class="linenos">120</span></a><span class="sd">        Returns:</span>
</span><span id="AssignmentCompressor.match-121"><a href="#AssignmentCompressor.match-121"><span class="linenos">121</span></a><span class="sd">            A `SortedDict` with identifiers matched ti district assignments.s</span>
</span><span id="AssignmentCompressor.match-122"><a href="#AssignmentCompressor.match-122"><span class="linenos">122</span></a>
</span><span id="AssignmentCompressor.match-123"><a href="#AssignmentCompressor.match-123"><span class="linenos">123</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor.match-124"><a href="#AssignmentCompressor.match-124"><span class="linenos">124</span></a>        <span class="c1"># Create a dictionary which maps identifiers to `-1`, and update our</span>
</span><span id="AssignmentCompressor.match-125"><a href="#AssignmentCompressor.match-125"><span class="linenos">125</span></a>        <span class="c1"># dictionary with assignment values.</span>
</span><span id="AssignmentCompressor.match-126"><a href="#AssignmentCompressor.match-126"><span class="linenos">126</span></a>        <span class="n">indexer</span> <span class="o">=</span> <span class="n">SortedDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
</span><span id="AssignmentCompressor.match-127"><a href="#AssignmentCompressor.match-127"><span class="linenos">127</span></a>        <span class="n">indexer</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">assignment</span><span class="p">)</span>
</span><span id="AssignmentCompressor.match-128"><a href="#AssignmentCompressor.match-128"><span class="linenos">128</span></a>
</span><span id="AssignmentCompressor.match-129"><a href="#AssignmentCompressor.match-129"><span class="linenos">129</span></a>        <span class="k">return</span> <span class="n">indexer</span>
</span></pre></div>


            <div class="docstring"><p>Matches an assignment to an index (the set of geometric identifiers)
and returns a <code>SortedDict</code>.</p>

<p>Args:
    assignment (dict): Dictionary which matches geometric identifiers to
        districts. All keys and values in this dictionary must be strings.</p>

<p>Returns:
    A <code>SortedDict</code> with identifiers matched ti district assignments.s</p>
</div>


                            </div>
                            <div id="AssignmentCompressor.compress_all" class="classattr">
                                        <input id="AssignmentCompressor.compress_all-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compress_all</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">assignments</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AssignmentCompressor.compress_all-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AssignmentCompressor.compress_all"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AssignmentCompressor.compress_all-148"><a href="#AssignmentCompressor.compress_all-148"><span class="linenos">148</span></a>    <span class="k">def</span> <span class="nf">compress_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assignments</span><span class="p">):</span>
</span><span id="AssignmentCompressor.compress_all-149"><a href="#AssignmentCompressor.compress_all-149"><span class="linenos">149</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor.compress_all-150"><a href="#AssignmentCompressor.compress_all-150"><span class="linenos">150</span></a><span class="sd">        Compresses all assignments in `assignments`.</span>
</span><span id="AssignmentCompressor.compress_all-151"><a href="#AssignmentCompressor.compress_all-151"><span class="linenos">151</span></a>
</span><span id="AssignmentCompressor.compress_all-152"><a href="#AssignmentCompressor.compress_all-152"><span class="linenos">152</span></a><span class="sd">        Args:</span>
</span><span id="AssignmentCompressor.compress_all-153"><a href="#AssignmentCompressor.compress_all-153"><span class="linenos">153</span></a><span class="sd">            assignments (list): List of dictionaries which match geometric identifiers</span>
</span><span id="AssignmentCompressor.compress_all-154"><a href="#AssignmentCompressor.compress_all-154"><span class="linenos">154</span></a><span class="sd">                to districts. All keys and values in these dictionaries must be</span>
</span><span id="AssignmentCompressor.compress_all-155"><a href="#AssignmentCompressor.compress_all-155"><span class="linenos">155</span></a><span class="sd">                strings.</span>
</span><span id="AssignmentCompressor.compress_all-156"><a href="#AssignmentCompressor.compress_all-156"><span class="linenos">156</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor.compress_all-157"><a href="#AssignmentCompressor.compress_all-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assignments</span><span class="p">)</span>
</span><span id="AssignmentCompressor.compress_all-158"><a href="#AssignmentCompressor.compress_all-158"><span class="linenos">158</span></a>
</span><span id="AssignmentCompressor.compress_all-159"><a href="#AssignmentCompressor.compress_all-159"><span class="linenos">159</span></a>        <span class="k">with</span> <span class="bp">self</span> <span class="k">as</span> <span class="n">ac</span><span class="p">:</span>
</span><span id="AssignmentCompressor.compress_all-160"><a href="#AssignmentCompressor.compress_all-160"><span class="linenos">160</span></a>            <span class="k">for</span> <span class="n">assignment</span> <span class="ow">in</span> <span class="n">assignments</span><span class="p">:</span>
</span><span id="AssignmentCompressor.compress_all-161"><a href="#AssignmentCompressor.compress_all-161"><span class="linenos">161</span></a>                <span class="n">ac</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">assignment</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compresses all assignments in <code>assignments</code>.</p>

<p>Args:
    assignments (list): List of dictionaries which match geometric identifiers
        to districts. All keys and values in these dictionaries must be
        strings.</p>
</div>


                            </div>
                            <div id="AssignmentCompressor.compress" class="classattr">
                                        <input id="AssignmentCompressor.compress-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compress</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">assignment</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AssignmentCompressor.compress-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AssignmentCompressor.compress"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AssignmentCompressor.compress-163"><a href="#AssignmentCompressor.compress-163"><span class="linenos">163</span></a>    <span class="k">def</span> <span class="nf">compress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assignment</span><span class="p">):</span>
</span><span id="AssignmentCompressor.compress-164"><a href="#AssignmentCompressor.compress-164"><span class="linenos">164</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor.compress-165"><a href="#AssignmentCompressor.compress-165"><span class="linenos">165</span></a><span class="sd">        Compresses the assignment `assignment` using `zlib`.</span>
</span><span id="AssignmentCompressor.compress-166"><a href="#AssignmentCompressor.compress-166"><span class="linenos">166</span></a>
</span><span id="AssignmentCompressor.compress-167"><a href="#AssignmentCompressor.compress-167"><span class="linenos">167</span></a><span class="sd">        Args:</span>
</span><span id="AssignmentCompressor.compress-168"><a href="#AssignmentCompressor.compress-168"><span class="linenos">168</span></a><span class="sd">            assignment (dict): Dictionary which matches geometric identifiers to districts.</span>
</span><span id="AssignmentCompressor.compress-169"><a href="#AssignmentCompressor.compress-169"><span class="linenos">169</span></a><span class="sd">                All keys and values in this dictionary must be strings.</span>
</span><span id="AssignmentCompressor.compress-170"><a href="#AssignmentCompressor.compress-170"><span class="linenos">170</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor.compress-171"><a href="#AssignmentCompressor.compress-171"><span class="linenos">171</span></a>        <span class="c1"># If the user provides an empty assignment or the assignment&#39;s keys aren&#39;t</span>
</span><span id="AssignmentCompressor.compress-172"><a href="#AssignmentCompressor.compress-172"><span class="linenos">172</span></a>        <span class="c1"># a subset of `identifiers`, warn the user and skip the assignment.</span>
</span><span id="AssignmentCompressor.compress-173"><a href="#AssignmentCompressor.compress-173"><span class="linenos">173</span></a>        <span class="n">skip</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="AssignmentCompressor.compress-174"><a href="#AssignmentCompressor.compress-174"><span class="linenos">174</span></a>
</span><span id="AssignmentCompressor.compress-175"><a href="#AssignmentCompressor.compress-175"><span class="linenos">175</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">assignment</span><span class="p">:</span>
</span><span id="AssignmentCompressor.compress-176"><a href="#AssignmentCompressor.compress-176"><span class="linenos">176</span></a>            <span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AssignmentCompressor.compress-177"><a href="#AssignmentCompressor.compress-177"><span class="linenos">177</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;`assignment` is empty; skipping.&quot;</span><span class="p">)</span>
</span><span id="AssignmentCompressor.compress-178"><a href="#AssignmentCompressor.compress-178"><span class="linenos">178</span></a>
</span><span id="AssignmentCompressor.compress-179"><a href="#AssignmentCompressor.compress-179"><span class="linenos">179</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">assignment</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifiers</span><span class="p">):</span>
</span><span id="AssignmentCompressor.compress-180"><a href="#AssignmentCompressor.compress-180"><span class="linenos">180</span></a>            <span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AssignmentCompressor.compress-181"><a href="#AssignmentCompressor.compress-181"><span class="linenos">181</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="AssignmentCompressor.compress-182"><a href="#AssignmentCompressor.compress-182"><span class="linenos">182</span></a>                <span class="s2">&quot;`assignment`&#39;s keys are not a subset of `identifiers`; skipping. &quot;</span>
</span><span id="AssignmentCompressor.compress-183"><a href="#AssignmentCompressor.compress-183"><span class="linenos">183</span></a>                <span class="o">+</span> <span class="s2">&quot;Please ensure that all keys and values in `assignment` are strings.&quot;</span><span class="p">,</span>
</span><span id="AssignmentCompressor.compress-184"><a href="#AssignmentCompressor.compress-184"><span class="linenos">184</span></a>            <span class="p">)</span>
</span><span id="AssignmentCompressor.compress-185"><a href="#AssignmentCompressor.compress-185"><span class="linenos">185</span></a>
</span><span id="AssignmentCompressor.compress-186"><a href="#AssignmentCompressor.compress-186"><span class="linenos">186</span></a>        <span class="c1"># Join the things on the district separator, encode the whole thing, and</span>
</span><span id="AssignmentCompressor.compress-187"><a href="#AssignmentCompressor.compress-187"><span class="linenos">187</span></a>        <span class="c1"># encode according to the default encoding.</span>
</span><span id="AssignmentCompressor.compress-188"><a href="#AssignmentCompressor.compress-188"><span class="linenos">188</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">skip</span><span class="p">:</span>
</span><span id="AssignmentCompressor.compress-189"><a href="#AssignmentCompressor.compress-189"><span class="linenos">189</span></a>            <span class="n">indexed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">assignment</span><span class="p">)</span>
</span><span id="AssignmentCompressor.compress-190"><a href="#AssignmentCompressor.compress-190"><span class="linenos">190</span></a>            <span class="n">sep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DISTRICT_DELIMITER</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span><span id="AssignmentCompressor.compress-191"><a href="#AssignmentCompressor.compress-191"><span class="linenos">191</span></a>            <span class="n">encoded</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">indexed</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ENCODING</span><span class="p">))</span>
</span><span id="AssignmentCompressor.compress-192"><a href="#AssignmentCompressor.compress-192"><span class="linenos">192</span></a>
</span><span id="AssignmentCompressor.compress-193"><a href="#AssignmentCompressor.compress-193"><span class="linenos">193</span></a>            <span class="c1"># Compress.</span>
</span><span id="AssignmentCompressor.compress-194"><a href="#AssignmentCompressor.compress-194"><span class="linenos">194</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">+=</span> <span class="p">[</span><span class="n">encoded</span><span class="p">]</span>
</span><span id="AssignmentCompressor.compress-195"><a href="#AssignmentCompressor.compress-195"><span class="linenos">195</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_compress</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Compresses the assignment <code>assignment</code> using <code>zlib</code>.</p>

<p>Args:
    assignment (dict): Dictionary which matches geometric identifiers to districts.
        All keys and values in this dictionary must be strings.</p>
</div>


                            </div>
                            <div id="AssignmentCompressor.decompress" class="classattr">
                                        <input id="AssignmentCompressor.decompress-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">decompress</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AssignmentCompressor.decompress-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AssignmentCompressor.decompress"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AssignmentCompressor.decompress-231"><a href="#AssignmentCompressor.decompress-231"><span class="linenos">231</span></a>    <span class="k">def</span> <span class="nf">decompress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AssignmentCompressor.decompress-232"><a href="#AssignmentCompressor.decompress-232"><span class="linenos">232</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor.decompress-233"><a href="#AssignmentCompressor.decompress-233"><span class="linenos">233</span></a><span class="sd">        Decompresses the data at ``location``. A generator which ``yield``s</span>
</span><span id="AssignmentCompressor.decompress-234"><a href="#AssignmentCompressor.decompress-234"><span class="linenos">234</span></a><span class="sd">        assignments.</span>
</span><span id="AssignmentCompressor.decompress-235"><a href="#AssignmentCompressor.decompress-235"><span class="linenos">235</span></a>
</span><span id="AssignmentCompressor.decompress-236"><a href="#AssignmentCompressor.decompress-236"><span class="linenos">236</span></a><span class="sd">        Yields:</span>
</span><span id="AssignmentCompressor.decompress-237"><a href="#AssignmentCompressor.decompress-237"><span class="linenos">237</span></a><span class="sd">            Decompressed assignment dictionaries.</span>
</span><span id="AssignmentCompressor.decompress-238"><a href="#AssignmentCompressor.decompress-238"><span class="linenos">238</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AssignmentCompressor.decompress-239"><a href="#AssignmentCompressor.decompress-239"><span class="linenos">239</span></a>        <span class="c1"># Open the compressed file. Then we read it in chunks, loading until</span>
</span><span id="AssignmentCompressor.decompress-240"><a href="#AssignmentCompressor.decompress-240"><span class="linenos">240</span></a>        <span class="c1"># we hit our separator or until the end of the file.</span>
</span><span id="AssignmentCompressor.decompress-241"><a href="#AssignmentCompressor.decompress-241"><span class="linenos">241</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">_compressed_fin</span><span class="p">:</span>
</span><span id="AssignmentCompressor.decompress-242"><a href="#AssignmentCompressor.decompress-242"><span class="linenos">242</span></a>            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk</span><span class="p">(</span><span class="n">_compressed_fin</span><span class="p">):</span>
</span><span id="AssignmentCompressor.decompress-243"><a href="#AssignmentCompressor.decompress-243"><span class="linenos">243</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="p">:</span>
</span><span id="AssignmentCompressor.decompress-244"><a href="#AssignmentCompressor.decompress-244"><span class="linenos">244</span></a>                    <span class="k">break</span>
</span><span id="AssignmentCompressor.decompress-245"><a href="#AssignmentCompressor.decompress-245"><span class="linenos">245</span></a>                <span class="k">for</span> <span class="n">assignment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decompress</span><span class="p">(</span><span class="n">chunk</span><span class="p">):</span>
</span><span id="AssignmentCompressor.decompress-246"><a href="#AssignmentCompressor.decompress-246"><span class="linenos">246</span></a>                    <span class="k">yield</span> <span class="n">assignment</span>
</span></pre></div>


            <div class="docstring"><p>Decompresses the data at <code>location</code>. A generator which <code>yield</code>s
assignments.</p>

<p>Yields:
    Decompressed assignment dictionaries.</p>
</div>


                            </div>
                </section>
                <section id="Submission">
                            <input id="Submission-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Submission</span><wbr>(<span class="base">pydantic.main.BaseModel</span>):

                <label class="view-source-button" for="Submission-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Submission"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Submission-14"><a href="#Submission-14"><span class="linenos">14</span></a><span class="k">class</span> <span class="nc">Submission</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span id="Submission-15"><a href="#Submission-15"><span class="linenos">15</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Submission-16"><a href="#Submission-16"><span class="linenos">16</span></a><span class="sd">    Provides a base model for data retrieved from districtr. Allows us to use</span>
</span><span id="Submission-17"><a href="#Submission-17"><span class="linenos">17</span></a><span class="sd">    dot notation when accessing properties rather than dict notation.</span>
</span><span id="Submission-18"><a href="#Submission-18"><span class="linenos">18</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Submission-19"><a href="#Submission-19"><span class="linenos">19</span></a>
</span><span id="Submission-20"><a href="#Submission-20"><span class="linenos">20</span></a>    <span class="n">link</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Submission-21"><a href="#Submission-21"><span class="linenos">21</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A districtr URL.&quot;&quot;&quot;</span>
</span><span id="Submission-22"><a href="#Submission-22"><span class="linenos">22</span></a>    <span class="n">plan</span><span class="p">:</span> <span class="nb">dict</span>
</span><span id="Submission-23"><a href="#Submission-23"><span class="linenos">23</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;districtr plan object.&quot;&quot;&quot;</span>
</span><span id="Submission-24"><a href="#Submission-24"><span class="linenos">24</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Submission-25"><a href="#Submission-25"><span class="linenos">25</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;districtr identifier.&quot;&quot;&quot;</span>
</span><span id="Submission-26"><a href="#Submission-26"><span class="linenos">26</span></a>    <span class="n">units</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Submission-27"><a href="#Submission-27"><span class="linenos">27</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Unit identifier (e.g. `GEOID`).&quot;&quot;&quot;</span>
</span><span id="Submission-28"><a href="#Submission-28"><span class="linenos">28</span></a>    <span class="n">unitsType</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Submission-29"><a href="#Submission-29"><span class="linenos">29</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Unit type (e.g. `blocks20`, `blockgroup`, etc.)&quot;&quot;&quot;</span>
</span><span id="Submission-30"><a href="#Submission-30"><span class="linenos">30</span></a>    <span class="n">tileset</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Submission-31"><a href="#Submission-31"><span class="linenos">31</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Mapbox tileset URL.&quot;&quot;&quot;</span>
</span><span id="Submission-32"><a href="#Submission-32"><span class="linenos">32</span></a>    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Submission-33"><a href="#Submission-33"><span class="linenos">33</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Not sure.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Provides a base model for data retrieved from districtr. Allows us to use
dot notation when accessing properties rather than dict notation.</p>
</div>


                            <div id="Submission.link" class="classattr">
                                <div class="attr variable">
            <span class="name">link</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#Submission.link"></a>
    
            <div class="docstring"><p>A districtr URL.</p>
</div>


                            </div>
                            <div id="Submission.plan" class="classattr">
                                <div class="attr variable">
            <span class="name">plan</span><span class="annotation">: dict</span>

        
    </div>
    <a class="headerlink" href="#Submission.plan"></a>
    
            <div class="docstring"><p>districtr plan object.</p>
</div>


                            </div>
                            <div id="Submission.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#Submission.id"></a>
    
            <div class="docstring"><p>districtr identifier.</p>
</div>


                            </div>
                            <div id="Submission.units" class="classattr">
                                <div class="attr variable">
            <span class="name">units</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#Submission.units"></a>
    
            <div class="docstring"><p>Unit identifier (e.g. <code>GEOID</code>).</p>
</div>


                            </div>
                            <div id="Submission.unitsType" class="classattr">
                                <div class="attr variable">
            <span class="name">unitsType</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#Submission.unitsType"></a>
    
            <div class="docstring"><p>Unit type (e.g. <code>blocks20</code>, <code>blockgroup</code>, etc.)</p>
</div>


                            </div>
                            <div id="Submission.tileset" class="classattr">
                                <div class="attr variable">
            <span class="name">tileset</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#Submission.tileset"></a>
    
            <div class="docstring"><p>Mapbox tileset URL.</p>
</div>


                            </div>
                            <div id="Submission.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#Submission.type"></a>
    
            <div class="docstring"><p>Not sure.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>pydantic.main.BaseModel</dt>
                                <dd id="Submission.__init__" class="function">BaseModel</dd>
                <dd id="Submission.dict" class="function">dict</dd>
                <dd id="Submission.json" class="function">json</dd>
                <dd id="Submission.parse_obj" class="function">parse_obj</dd>
                <dd id="Submission.parse_raw" class="function">parse_raw</dd>
                <dd id="Submission.parse_file" class="function">parse_file</dd>
                <dd id="Submission.from_orm" class="function">from_orm</dd>
                <dd id="Submission.construct" class="function">construct</dd>
                <dd id="Submission.copy" class="function">copy</dd>
                <dd id="Submission.schema" class="function">schema</dd>
                <dd id="Submission.schema_json" class="function">schema_json</dd>
                <dd id="Submission.validate" class="function">validate</dd>
                <dd id="Submission.update_forward_refs" class="function">update_forward_refs</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="cvap">
                            <input id="cvap-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cvap</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">state</span>, </span><span class="param"><span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;tract&#39;</span>, </span><span class="param"><span class="n">year</span><span class="o">=</span><span class="mi">2020</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="cvap-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#cvap"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="cvap-10"><a href="#cvap-10"><span class="linenos">10</span></a><span class="k">def</span> <span class="nf">cvap</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;tract&quot;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="mi">2020</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="cvap-11"><a href="#cvap-11"><span class="linenos">11</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="cvap-12"><a href="#cvap-12"><span class="linenos">12</span></a><span class="sd">    Retrieves and CSV-formats 5-year CVAP data for the provided state at</span>
</span><span id="cvap-13"><a href="#cvap-13"><span class="linenos">13</span></a><span class="sd">    the specified geometry level. Geometries from the **2010 Census**.</span>
</span><span id="cvap-14"><a href="#cvap-14"><span class="linenos">14</span></a><span class="sd">    Variables and descriptions are [listed here](https://tinyurl.com/3mnrm56s).</span>
</span><span id="cvap-15"><a href="#cvap-15"><span class="linenos">15</span></a>
</span><span id="cvap-16"><a href="#cvap-16"><span class="linenos">16</span></a><span class="sd">    Args:</span>
</span><span id="cvap-17"><a href="#cvap-17"><span class="linenos">17</span></a><span class="sd">        state (us.State): The `State` object for which we&#39;re retrieving 2019</span>
</span><span id="cvap-18"><a href="#cvap-18"><span class="linenos">18</span></a><span class="sd">            ACS CVAP Special Tab.</span>
</span><span id="cvap-19"><a href="#cvap-19"><span class="linenos">19</span></a><span class="sd">        geometry (str, optional): Level of geometry for which we&#39;re getting</span>
</span><span id="cvap-20"><a href="#cvap-20"><span class="linenos">20</span></a><span class="sd">            data. Accepted values are `&quot;block group&quot;` for 2010 Census Block</span>
</span><span id="cvap-21"><a href="#cvap-21"><span class="linenos">21</span></a><span class="sd">            Groups, and `&quot;tract&quot;` for 2010 Census Tracts. Defaults to `&quot;tract&quot;`.</span>
</span><span id="cvap-22"><a href="#cvap-22"><span class="linenos">22</span></a><span class="sd">        year (int, optional): Year for which data is retrieved. Defaults to</span>
</span><span id="cvap-23"><a href="#cvap-23"><span class="linenos">23</span></a><span class="sd">            2020.</span>
</span><span id="cvap-24"><a href="#cvap-24"><span class="linenos">24</span></a>
</span><span id="cvap-25"><a href="#cvap-25"><span class="linenos">25</span></a><span class="sd">    Returns</span>
</span><span id="cvap-26"><a href="#cvap-26"><span class="linenos">26</span></a><span class="sd">        A `DataFrame` with a `GEOID` column and corresponding CVAP columns from</span>
</span><span id="cvap-27"><a href="#cvap-27"><span class="linenos">27</span></a><span class="sd">        the ACS CVAP Special Tab for the specified year.</span>
</span><span id="cvap-28"><a href="#cvap-28"><span class="linenos">28</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="cvap-29"><a href="#cvap-29"><span class="linenos">29</span></a>    <span class="c1"># Maps line numbers to descriptors.</span>
</span><span id="cvap-30"><a href="#cvap-30"><span class="linenos">30</span></a>    <span class="n">descriptions</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="cvap-31"><a href="#cvap-31"><span class="linenos">31</span></a>        <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;CVAP&quot;</span><span class="p">,</span>
</span><span id="cvap-32"><a href="#cvap-32"><span class="linenos">32</span></a>        <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;NHCVAP&quot;</span><span class="p">,</span>
</span><span id="cvap-33"><a href="#cvap-33"><span class="linenos">33</span></a>        <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;NHAMINCVAP&quot;</span><span class="p">,</span>
</span><span id="cvap-34"><a href="#cvap-34"><span class="linenos">34</span></a>        <span class="mi">4</span><span class="p">:</span> <span class="s2">&quot;NHASIANCVAP&quot;</span><span class="p">,</span>
</span><span id="cvap-35"><a href="#cvap-35"><span class="linenos">35</span></a>        <span class="mi">5</span><span class="p">:</span> <span class="s2">&quot;NHBLACKCVAP&quot;</span><span class="p">,</span>
</span><span id="cvap-36"><a href="#cvap-36"><span class="linenos">36</span></a>        <span class="mi">6</span><span class="p">:</span> <span class="s2">&quot;NHNHPICVAP&quot;</span><span class="p">,</span>
</span><span id="cvap-37"><a href="#cvap-37"><span class="linenos">37</span></a>        <span class="mi">7</span><span class="p">:</span> <span class="s2">&quot;NHWHITECVAP&quot;</span><span class="p">,</span>
</span><span id="cvap-38"><a href="#cvap-38"><span class="linenos">38</span></a>        <span class="mi">8</span><span class="p">:</span> <span class="s2">&quot;NHWHITEAMINCVAP&quot;</span><span class="p">,</span>
</span><span id="cvap-39"><a href="#cvap-39"><span class="linenos">39</span></a>        <span class="mi">9</span><span class="p">:</span> <span class="s2">&quot;NHWHITEASIANCVAP&quot;</span><span class="p">,</span>
</span><span id="cvap-40"><a href="#cvap-40"><span class="linenos">40</span></a>        <span class="mi">10</span><span class="p">:</span> <span class="s2">&quot;NHWHITEBLACKCVAP&quot;</span><span class="p">,</span>
</span><span id="cvap-41"><a href="#cvap-41"><span class="linenos">41</span></a>        <span class="mi">11</span><span class="p">:</span> <span class="s2">&quot;NHBLACKAMINCVAP&quot;</span><span class="p">,</span>
</span><span id="cvap-42"><a href="#cvap-42"><span class="linenos">42</span></a>        <span class="mi">12</span><span class="p">:</span> <span class="s2">&quot;NHOTHCVAP&quot;</span><span class="p">,</span>
</span><span id="cvap-43"><a href="#cvap-43"><span class="linenos">43</span></a>        <span class="mi">13</span><span class="p">:</span> <span class="s2">&quot;HCVAP&quot;</span><span class="p">,</span>
</span><span id="cvap-44"><a href="#cvap-44"><span class="linenos">44</span></a>    <span class="p">}</span>
</span><span id="cvap-45"><a href="#cvap-45"><span class="linenos">45</span></a>
</span><span id="cvap-46"><a href="#cvap-46"><span class="linenos">46</span></a>    <span class="c1"># First, load the raw data requested; allowed geometry values are</span>
</span><span id="cvap-47"><a href="#cvap-47"><span class="linenos">47</span></a>    <span class="c1"># &quot;block group&quot; and &quot;tract.&quot;</span>
</span><span id="cvap-48"><a href="#cvap-48"><span class="linenos">48</span></a>    <span class="k">if</span> <span class="n">geometry</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;block group&quot;</span><span class="p">,</span> <span class="s2">&quot;tract&quot;</span><span class="p">}:</span>
</span><span id="cvap-49"><a href="#cvap-49"><span class="linenos">49</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested geometry &quot;</span><span class="si">{</span><span class="n">geometry</span><span class="si">}</span><span class="s1">&quot; is not allowed; &#39;</span> <span class="s2">&quot;loading tracts.&quot;</span><span class="p">)</span>
</span><span id="cvap-50"><a href="#cvap-50"><span class="linenos">50</span></a>        <span class="n">geometry</span> <span class="o">=</span> <span class="s2">&quot;tract&quot;</span>
</span><span id="cvap-51"><a href="#cvap-51"><span class="linenos">51</span></a>
</span><span id="cvap-52"><a href="#cvap-52"><span class="linenos">52</span></a>    <span class="n">abbrv</span> <span class="o">=</span> <span class="n">geometry</span> <span class="k">if</span> <span class="n">geometry</span> <span class="o">==</span> <span class="s2">&quot;tract&quot;</span> <span class="k">else</span> <span class="s2">&quot;block group&quot;</span>
</span><span id="cvap-53"><a href="#cvap-53"><span class="linenos">53</span></a>
</span><span id="cvap-54"><a href="#cvap-54"><span class="linenos">54</span></a>    <span class="c1"># Load the raw data.</span>
</span><span id="cvap-55"><a href="#cvap-55"><span class="linenos">55</span></a>    <span class="n">raw</span> <span class="o">=</span> <span class="n">_raw</span><span class="p">(</span><span class="n">abbrv</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
</span><span id="cvap-56"><a href="#cvap-56"><span class="linenos">56</span></a>
</span><span id="cvap-57"><a href="#cvap-57"><span class="linenos">57</span></a>    <span class="c1"># Create a STATE column for filtering and remove all rows which don&#39;t match</span>
</span><span id="cvap-58"><a href="#cvap-58"><span class="linenos">58</span></a>    <span class="c1"># the state FIPS code.</span>
</span><span id="cvap-59"><a href="#cvap-59"><span class="linenos">59</span></a>    <span class="n">raw</span><span class="p">[</span><span class="s2">&quot;GEOID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw</span><span class="p">[</span><span class="s2">&quot;geoid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;US&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="cvap-60"><a href="#cvap-60"><span class="linenos">60</span></a>    <span class="n">raw</span><span class="p">[</span><span class="s2">&quot;STATE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw</span><span class="p">[</span><span class="s2">&quot;GEOID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</span><span id="cvap-61"><a href="#cvap-61"><span class="linenos">61</span></a>    <span class="n">instate</span> <span class="o">=</span> <span class="n">raw</span><span class="p">[</span><span class="n">raw</span><span class="p">[</span><span class="s2">&quot;STATE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">fips</span><span class="p">)]</span>
</span><span id="cvap-62"><a href="#cvap-62"><span class="linenos">62</span></a>
</span><span id="cvap-63"><a href="#cvap-63"><span class="linenos">63</span></a>    <span class="c1"># Now that we have the in-state data, we aim to pivot the table. Because</span>
</span><span id="cvap-64"><a href="#cvap-64"><span class="linenos">64</span></a>    <span class="c1"># the ACS data is in a line-numbered format (i.e. each chunk of 13 lines</span>
</span><span id="cvap-65"><a href="#cvap-65"><span class="linenos">65</span></a>    <span class="c1"># matches to an individual geometry, and each of the 13 lines describes</span>
</span><span id="cvap-66"><a href="#cvap-66"><span class="linenos">66</span></a>    <span class="c1"># an individual statistic) we need to first collapse each chunk of 13</span>
</span><span id="cvap-67"><a href="#cvap-67"><span class="linenos">67</span></a>    <span class="c1"># lines, then build a dataframe from the resulting collapsed lines.</span>
</span><span id="cvap-68"><a href="#cvap-68"><span class="linenos">68</span></a>    <span class="c1"># First we send the dataframe to a list of records.</span>
</span><span id="cvap-69"><a href="#cvap-69"><span class="linenos">69</span></a>    <span class="n">instate_records</span> <span class="o">=</span> <span class="n">instate</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
</span><span id="cvap-70"><a href="#cvap-70"><span class="linenos">70</span></a>    <span class="n">collapsed</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="cvap-71"><a href="#cvap-71"><span class="linenos">71</span></a>
</span><span id="cvap-72"><a href="#cvap-72"><span class="linenos">72</span></a>    <span class="c1"># Get year stuff.</span>
</span><span id="cvap-73"><a href="#cvap-73"><span class="linenos">73</span></a>    <span class="n">decade</span> <span class="o">=</span> <span class="s2">&quot;10&quot;</span> <span class="k">if</span> <span class="n">year</span> <span class="o">&lt;</span> <span class="mi">2020</span> <span class="k">else</span> <span class="s2">&quot;20&quot;</span>
</span><span id="cvap-74"><a href="#cvap-74"><span class="linenos">74</span></a>    <span class="n">yearsuffix</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
</span><span id="cvap-75"><a href="#cvap-75"><span class="linenos">75</span></a>
</span><span id="cvap-76"><a href="#cvap-76"><span class="linenos">76</span></a>    <span class="c1"># Next, we collapse these records to a single record.</span>
</span><span id="cvap-77"><a href="#cvap-77"><span class="linenos">77</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">instate_records</span><span class="p">),</span> <span class="mi">13</span><span class="p">):</span>
</span><span id="cvap-78"><a href="#cvap-78"><span class="linenos">78</span></a>        <span class="c1"># Create an empty records.</span>
</span><span id="cvap-79"><a href="#cvap-79"><span class="linenos">79</span></a>        <span class="n">record</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="cvap-80"><a href="#cvap-80"><span class="linenos">80</span></a>
</span><span id="cvap-81"><a href="#cvap-81"><span class="linenos">81</span></a>        <span class="c1"># For each of the records in the block, &quot;collapse&quot; them into a single</span>
</span><span id="cvap-82"><a href="#cvap-82"><span class="linenos">82</span></a>        <span class="c1"># record.</span>
</span><span id="cvap-83"><a href="#cvap-83"><span class="linenos">83</span></a>        <span class="n">block</span> <span class="o">=</span> <span class="n">instate_records</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">13</span><span class="p">]</span>
</span><span id="cvap-84"><a href="#cvap-84"><span class="linenos">84</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">block</span><span class="p">:</span>
</span><span id="cvap-85"><a href="#cvap-85"><span class="linenos">85</span></a>            <span class="n">record</span><span class="p">[</span><span class="n">geometry</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">decade</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="s2">&quot;GEOID&quot;</span><span class="p">]</span>
</span><span id="cvap-86"><a href="#cvap-86"><span class="linenos">86</span></a>            <span class="n">record</span><span class="p">[</span><span class="n">descriptions</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="s2">&quot;lnnumber&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="n">yearsuffix</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="s2">&quot;cvap_est&quot;</span><span class="p">]</span>
</span><span id="cvap-87"><a href="#cvap-87"><span class="linenos">87</span></a>            <span class="n">record</span><span class="p">[</span><span class="n">descriptions</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="s2">&quot;lnnumber&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">yearsuffix</span><span class="si">}</span><span class="s2">e&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="s2">&quot;cvap_moe&quot;</span><span class="p">]</span>
</span><span id="cvap-88"><a href="#cvap-88"><span class="linenos">88</span></a>
</span><span id="cvap-89"><a href="#cvap-89"><span class="linenos">89</span></a>        <span class="n">collapsed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="cvap-90"><a href="#cvap-90"><span class="linenos">90</span></a>
</span><span id="cvap-91"><a href="#cvap-91"><span class="linenos">91</span></a>    <span class="c1"># Create a dataframe and a POCCVAP column; all people minus non-Hispanic</span>
</span><span id="cvap-92"><a href="#cvap-92"><span class="linenos">92</span></a>    <span class="c1"># White.</span>
</span><span id="cvap-93"><a href="#cvap-93"><span class="linenos">93</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">collapsed</span><span class="p">)</span>
</span><span id="cvap-94"><a href="#cvap-94"><span class="linenos">94</span></a>    <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;POCCVAP</span><span class="si">{</span><span class="n">yearsuffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="cvap-95"><a href="#cvap-95"><span class="linenos">95</span></a>        <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CVAP</span><span class="si">{</span><span class="n">yearsuffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;NHWHITECVAP</span><span class="si">{</span><span class="n">yearsuffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
</span><span id="cvap-96"><a href="#cvap-96"><span class="linenos">96</span></a>    <span class="p">)</span>
</span><span id="cvap-97"><a href="#cvap-97"><span class="linenos">97</span></a>
</span><span id="cvap-98"><a href="#cvap-98"><span class="linenos">98</span></a>    <span class="k">return</span> <span class="n">data</span>
</span></pre></div>


            <div class="docstring"><p>Retrieves and CSV-formats 5-year CVAP data for the provided state at
the specified geometry level. Geometries from the <strong>2010 Census</strong>.
Variables and descriptions are <a href="https://tinyurl.com/3mnrm56s">listed here</a>.</p>

<p>Args:
    state (us.State): The <code>State</code> object for which we're retrieving 2019
        ACS CVAP Special Tab.
    geometry (str, optional): Level of geometry for which we're getting
        data. Accepted values are <code>"block group"</code> for 2010 Census Block
        Groups, and <code>"tract"</code> for 2010 Census Tracts. Defaults to <code>"tract"</code>.
    year (int, optional): Year for which data is retrieved. Defaults to
        2020.</p>

<p>Returns
    A <code>DataFrame</code> with a <code>GEOID</code> column and corresponding CVAP columns from
    the ACS CVAP Special Tab for the specified year.</p>
</div>


                </section>
                <section id="acs5">
                            <input id="acs5-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">acs5</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">state</span>,</span><span class="param">	<span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;tract&#39;</span>,</span><span class="param">	<span class="n">year</span><span class="o">=</span><span class="mi">2020</span>,</span><span class="param">	<span class="n">columns</span><span class="o">=</span><span class="p">[]</span>,</span><span class="param">	<span class="n">white</span><span class="o">=</span><span class="s1">&#39;NHWHITEVAP&#39;</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="acs5-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#acs5"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="acs5-101"><a href="#acs5-101"><span class="linenos">101</span></a><span class="k">def</span> <span class="nf">acs5</span><span class="p">(</span>
</span><span id="acs5-102"><a href="#acs5-102"><span class="linenos">102</span></a>    <span class="n">state</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;tract&quot;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="mi">2020</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[],</span> <span class="n">white</span><span class="o">=</span><span class="s2">&quot;NHWHITEVAP&quot;</span>
</span><span id="acs5-103"><a href="#acs5-103"><span class="linenos">103</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="acs5-104"><a href="#acs5-104"><span class="linenos">104</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="acs5-105"><a href="#acs5-105"><span class="linenos">105</span></a><span class="sd">    Retrieves ACS 5-year population estimates for the provided state, geometry</span>
</span><span id="acs5-106"><a href="#acs5-106"><span class="linenos">106</span></a><span class="sd">    level, and year. Also retrieves ACS-reported CVAP data, which closely</span>
</span><span id="acs5-107"><a href="#acs5-107"><span class="linenos">107</span></a><span class="sd">    matches that reported by the CVAP special tabulation; CVAP data are only</span>
</span><span id="acs5-108"><a href="#acs5-108"><span class="linenos">108</span></a><span class="sd">    returned at the tract level, and are otherwise reported as 0.</span>
</span><span id="acs5-109"><a href="#acs5-109"><span class="linenos">109</span></a>
</span><span id="acs5-110"><a href="#acs5-110"><span class="linenos">110</span></a><span class="sd">    Args:</span>
</span><span id="acs5-111"><a href="#acs5-111"><span class="linenos">111</span></a><span class="sd">        state (us.State): `State` object for the desired state.</span>
</span><span id="acs5-112"><a href="#acs5-112"><span class="linenos">112</span></a><span class="sd">        geometry (str, optional): Geometry level at which data is retrieved.</span>
</span><span id="acs5-113"><a href="#acs5-113"><span class="linenos">113</span></a><span class="sd">            Acceptable values are `&quot;tract&quot;` and `&quot;block group&quot;`. Defaults to</span>
</span><span id="acs5-114"><a href="#acs5-114"><span class="linenos">114</span></a><span class="sd">            `&quot;tract&quot;`, so data is retrieved at the 2020 Census tract level.</span>
</span><span id="acs5-115"><a href="#acs5-115"><span class="linenos">115</span></a><span class="sd">        year (int, optional): Year for which data is retrieved. Defaults to</span>
</span><span id="acs5-116"><a href="#acs5-116"><span class="linenos">116</span></a><span class="sd">            2020.</span>
</span><span id="acs5-117"><a href="#acs5-117"><span class="linenos">117</span></a><span class="sd">        columns (list, optional): Columns to retrieve. If `None`, a default set</span>
</span><span id="acs5-118"><a href="#acs5-118"><span class="linenos">118</span></a><span class="sd">            of columns including total populations by race and ethnicity and</span>
</span><span id="acs5-119"><a href="#acs5-119"><span class="linenos">119</span></a><span class="sd">            voting-age populations by race and ethnicity are returned, along</span>
</span><span id="acs5-120"><a href="#acs5-120"><span class="linenos">120</span></a><span class="sd">            with a GEOID column.</span>
</span><span id="acs5-121"><a href="#acs5-121"><span class="linenos">121</span></a><span class="sd">        white (str, optional): The column removed from totals when calculating</span>
</span><span id="acs5-122"><a href="#acs5-122"><span class="linenos">122</span></a><span class="sd">            POC populations.</span>
</span><span id="acs5-123"><a href="#acs5-123"><span class="linenos">123</span></a>
</span><span id="acs5-124"><a href="#acs5-124"><span class="linenos">124</span></a><span class="sd">    Returns:</span>
</span><span id="acs5-125"><a href="#acs5-125"><span class="linenos">125</span></a><span class="sd">        A DataFrame containing the formatted data.</span>
</span><span id="acs5-126"><a href="#acs5-126"><span class="linenos">126</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="acs5-127"><a href="#acs5-127"><span class="linenos">127</span></a>    <span class="c1"># Columns for total populations.</span>
</span><span id="acs5-128"><a href="#acs5-128"><span class="linenos">128</span></a>    <span class="n">yearsuffix</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
</span><span id="acs5-129"><a href="#acs5-129"><span class="linenos">129</span></a>    <span class="n">popcolumns</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="acs5-130"><a href="#acs5-130"><span class="linenos">130</span></a>        <span class="s2">&quot;B01001_001E&quot;</span><span class="p">:</span> <span class="s2">&quot;TOTPOP&quot;</span> <span class="o">+</span> <span class="n">yearsuffix</span><span class="p">,</span>
</span><span id="acs5-131"><a href="#acs5-131"><span class="linenos">131</span></a>        <span class="s2">&quot;B03002_003E&quot;</span><span class="p">:</span> <span class="s2">&quot;WHITE&quot;</span> <span class="o">+</span> <span class="n">yearsuffix</span><span class="p">,</span>
</span><span id="acs5-132"><a href="#acs5-132"><span class="linenos">132</span></a>        <span class="s2">&quot;B03002_004E&quot;</span><span class="p">:</span> <span class="s2">&quot;BLACK&quot;</span> <span class="o">+</span> <span class="n">yearsuffix</span><span class="p">,</span>
</span><span id="acs5-133"><a href="#acs5-133"><span class="linenos">133</span></a>        <span class="s2">&quot;B03002_005E&quot;</span><span class="p">:</span> <span class="s2">&quot;AMIN&quot;</span> <span class="o">+</span> <span class="n">yearsuffix</span><span class="p">,</span>
</span><span id="acs5-134"><a href="#acs5-134"><span class="linenos">134</span></a>        <span class="s2">&quot;B03002_006E&quot;</span><span class="p">:</span> <span class="s2">&quot;ASIAN&quot;</span> <span class="o">+</span> <span class="n">yearsuffix</span><span class="p">,</span>
</span><span id="acs5-135"><a href="#acs5-135"><span class="linenos">135</span></a>        <span class="s2">&quot;B03002_007E&quot;</span><span class="p">:</span> <span class="s2">&quot;NHPI&quot;</span> <span class="o">+</span> <span class="n">yearsuffix</span><span class="p">,</span>
</span><span id="acs5-136"><a href="#acs5-136"><span class="linenos">136</span></a>        <span class="s2">&quot;B03002_008E&quot;</span><span class="p">:</span> <span class="s2">&quot;OTH&quot;</span> <span class="o">+</span> <span class="n">yearsuffix</span><span class="p">,</span>
</span><span id="acs5-137"><a href="#acs5-137"><span class="linenos">137</span></a>        <span class="s2">&quot;B03002_009E&quot;</span><span class="p">:</span> <span class="s2">&quot;2MORE&quot;</span> <span class="o">+</span> <span class="n">yearsuffix</span><span class="p">,</span>
</span><span id="acs5-138"><a href="#acs5-138"><span class="linenos">138</span></a>        <span class="s2">&quot;B03002_002E&quot;</span><span class="p">:</span> <span class="s2">&quot;NHISP&quot;</span> <span class="o">+</span> <span class="n">yearsuffix</span><span class="p">,</span>
</span><span id="acs5-139"><a href="#acs5-139"><span class="linenos">139</span></a>    <span class="p">}</span>
</span><span id="acs5-140"><a href="#acs5-140"><span class="linenos">140</span></a>
</span><span id="acs5-141"><a href="#acs5-141"><span class="linenos">141</span></a>    <span class="c1"># Create a dictionary of column groups.</span>
</span><span id="acs5-142"><a href="#acs5-142"><span class="linenos">142</span></a>    <span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="acs5-143"><a href="#acs5-143"><span class="linenos">143</span></a>
</span><span id="acs5-144"><a href="#acs5-144"><span class="linenos">144</span></a>    <span class="c1"># Get VAP columns. The columns listed here are by race, irrespective of</span>
</span><span id="acs5-145"><a href="#acs5-145"><span class="linenos">145</span></a>    <span class="c1"># ethnicity; for example, WVAP19 is the group of people who identified</span>
</span><span id="acs5-146"><a href="#acs5-146"><span class="linenos">146</span></a>    <span class="c1"># White as their *only* race, including people who identified as</span>
</span><span id="acs5-147"><a href="#acs5-147"><span class="linenos">147</span></a>    <span class="c1"># Hispanic and White.</span>
</span><span id="acs5-148"><a href="#acs5-148"><span class="linenos">148</span></a>    <span class="n">vapnames</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="acs5-149"><a href="#acs5-149"><span class="linenos">149</span></a>        <span class="s2">&quot;WHITEVAP&quot;</span><span class="p">,</span>
</span><span id="acs5-150"><a href="#acs5-150"><span class="linenos">150</span></a>        <span class="s2">&quot;BLACKVAP&quot;</span><span class="p">,</span>
</span><span id="acs5-151"><a href="#acs5-151"><span class="linenos">151</span></a>        <span class="s2">&quot;AMINVAP&quot;</span><span class="p">,</span>
</span><span id="acs5-152"><a href="#acs5-152"><span class="linenos">152</span></a>        <span class="s2">&quot;ASIANVAP&quot;</span><span class="p">,</span>
</span><span id="acs5-153"><a href="#acs5-153"><span class="linenos">153</span></a>        <span class="s2">&quot;NHPIVAP&quot;</span><span class="p">,</span>
</span><span id="acs5-154"><a href="#acs5-154"><span class="linenos">154</span></a>        <span class="s2">&quot;OTHVAP&quot;</span><span class="p">,</span>
</span><span id="acs5-155"><a href="#acs5-155"><span class="linenos">155</span></a>        <span class="s2">&quot;2MOREVAP&quot;</span><span class="p">,</span>
</span><span id="acs5-156"><a href="#acs5-156"><span class="linenos">156</span></a>        <span class="s2">&quot;NHWHITEVAP&quot;</span><span class="p">,</span>
</span><span id="acs5-157"><a href="#acs5-157"><span class="linenos">157</span></a>        <span class="s2">&quot;HVAP&quot;</span><span class="p">,</span>
</span><span id="acs5-158"><a href="#acs5-158"><span class="linenos">158</span></a>    <span class="p">]</span>
</span><span id="acs5-159"><a href="#acs5-159"><span class="linenos">159</span></a>    <span class="n">vaptables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="acs5-160"><a href="#acs5-160"><span class="linenos">160</span></a>        <span class="nb">zip</span><span class="p">(</span>
</span><span id="acs5-161"><a href="#acs5-161"><span class="linenos">161</span></a>            <span class="p">[</span><span class="n">column</span> <span class="o">+</span> <span class="n">yearsuffix</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">vapnames</span><span class="p">],</span>
</span><span id="acs5-162"><a href="#acs5-162"><span class="linenos">162</span></a>            <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;G&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">],</span>
</span><span id="acs5-163"><a href="#acs5-163"><span class="linenos">163</span></a>        <span class="p">)</span>
</span><span id="acs5-164"><a href="#acs5-164"><span class="linenos">164</span></a>    <span class="p">)</span>
</span><span id="acs5-165"><a href="#acs5-165"><span class="linenos">165</span></a>    <span class="n">groups</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="acs5-166"><a href="#acs5-166"><span class="linenos">166</span></a>        <span class="p">{</span>
</span><span id="acs5-167"><a href="#acs5-167"><span class="linenos">167</span></a>            <span class="n">column</span><span class="p">:</span> <span class="n">_variables</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;B01001</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
</span><span id="acs5-168"><a href="#acs5-168"><span class="linenos">168</span></a>            <span class="o">+</span> <span class="n">_variables</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;B01001</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
</span><span id="acs5-169"><a href="#acs5-169"><span class="linenos">169</span></a>            <span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">vaptables</span>
</span><span id="acs5-170"><a href="#acs5-170"><span class="linenos">170</span></a>        <span class="p">}</span>
</span><span id="acs5-171"><a href="#acs5-171"><span class="linenos">171</span></a>    <span class="p">)</span>
</span><span id="acs5-172"><a href="#acs5-172"><span class="linenos">172</span></a>
</span><span id="acs5-173"><a href="#acs5-173"><span class="linenos">173</span></a>    <span class="c1"># Get CVAP columns; the same goes for these columns as does the above,</span>
</span><span id="acs5-174"><a href="#acs5-174"><span class="linenos">174</span></a>    <span class="c1"># except these columns are 18 years and older *and* citizens.</span>
</span><span id="acs5-175"><a href="#acs5-175"><span class="linenos">175</span></a>    <span class="n">cvapnames</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="acs5-176"><a href="#acs5-176"><span class="linenos">176</span></a>        <span class="s2">&quot;WHITECVAP&quot;</span><span class="p">,</span>
</span><span id="acs5-177"><a href="#acs5-177"><span class="linenos">177</span></a>        <span class="s2">&quot;BLACKCVAP&quot;</span><span class="p">,</span>
</span><span id="acs5-178"><a href="#acs5-178"><span class="linenos">178</span></a>        <span class="s2">&quot;AMINCVAP&quot;</span><span class="p">,</span>
</span><span id="acs5-179"><a href="#acs5-179"><span class="linenos">179</span></a>        <span class="s2">&quot;ASIANCVAP&quot;</span><span class="p">,</span>
</span><span id="acs5-180"><a href="#acs5-180"><span class="linenos">180</span></a>        <span class="s2">&quot;NHPICVAP&quot;</span><span class="p">,</span>
</span><span id="acs5-181"><a href="#acs5-181"><span class="linenos">181</span></a>        <span class="s2">&quot;OTHCVAP&quot;</span><span class="p">,</span>
</span><span id="acs5-182"><a href="#acs5-182"><span class="linenos">182</span></a>        <span class="s2">&quot;2MORECVAP&quot;</span><span class="p">,</span>
</span><span id="acs5-183"><a href="#acs5-183"><span class="linenos">183</span></a>        <span class="s2">&quot;NHWHITECVAP&quot;</span><span class="p">,</span>
</span><span id="acs5-184"><a href="#acs5-184"><span class="linenos">184</span></a>        <span class="s2">&quot;HCVAP&quot;</span><span class="p">,</span>
</span><span id="acs5-185"><a href="#acs5-185"><span class="linenos">185</span></a>    <span class="p">]</span>
</span><span id="acs5-186"><a href="#acs5-186"><span class="linenos">186</span></a>    <span class="n">cvaptables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="acs5-187"><a href="#acs5-187"><span class="linenos">187</span></a>        <span class="nb">zip</span><span class="p">(</span>
</span><span id="acs5-188"><a href="#acs5-188"><span class="linenos">188</span></a>            <span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="n">yearsuffix</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cvapnames</span><span class="p">],</span>
</span><span id="acs5-189"><a href="#acs5-189"><span class="linenos">189</span></a>            <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;G&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">],</span>
</span><span id="acs5-190"><a href="#acs5-190"><span class="linenos">190</span></a>        <span class="p">)</span>
</span><span id="acs5-191"><a href="#acs5-191"><span class="linenos">191</span></a>    <span class="p">)</span>
</span><span id="acs5-192"><a href="#acs5-192"><span class="linenos">192</span></a>    <span class="n">groups</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="acs5-193"><a href="#acs5-193"><span class="linenos">193</span></a>        <span class="p">{</span>
</span><span id="acs5-194"><a href="#acs5-194"><span class="linenos">194</span></a>            <span class="n">column</span><span class="p">:</span> <span class="n">_variables</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;B05003</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</span><span id="acs5-195"><a href="#acs5-195"><span class="linenos">195</span></a>            <span class="o">+</span> <span class="n">_variables</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;B05003</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
</span><span id="acs5-196"><a href="#acs5-196"><span class="linenos">196</span></a>            <span class="o">+</span> <span class="n">_variables</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;B05003</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>  <span class="c1"># men</span>
</span><span id="acs5-197"><a href="#acs5-197"><span class="linenos">197</span></a>            <span class="o">+</span> <span class="n">_variables</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;B05003</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>  <span class="c1"># women</span>
</span><span id="acs5-198"><a href="#acs5-198"><span class="linenos">198</span></a>            <span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">cvaptables</span>
</span><span id="acs5-199"><a href="#acs5-199"><span class="linenos">199</span></a>        <span class="p">}</span>
</span><span id="acs5-200"><a href="#acs5-200"><span class="linenos">200</span></a>    <span class="p">)</span>
</span><span id="acs5-201"><a href="#acs5-201"><span class="linenos">201</span></a>
</span><span id="acs5-202"><a href="#acs5-202"><span class="linenos">202</span></a>    <span class="c1"># Get all voting-age people and citizen voting-age people.</span>
</span><span id="acs5-203"><a href="#acs5-203"><span class="linenos">203</span></a>    <span class="n">groups</span><span class="p">[</span><span class="s2">&quot;VAP&quot;</span> <span class="o">+</span> <span class="n">yearsuffix</span><span class="p">]</span> <span class="o">=</span> <span class="n">_variables</span><span class="p">(</span><span class="s2">&quot;B01001&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span> <span class="o">+</span> <span class="n">_variables</span><span class="p">(</span>
</span><span id="acs5-204"><a href="#acs5-204"><span class="linenos">204</span></a>        <span class="s2">&quot;B01001&quot;</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">49</span>
</span><span id="acs5-205"><a href="#acs5-205"><span class="linenos">205</span></a>    <span class="p">)</span>
</span><span id="acs5-206"><a href="#acs5-206"><span class="linenos">206</span></a>    <span class="n">groups</span><span class="p">[</span><span class="s2">&quot;CVAP&quot;</span> <span class="o">+</span> <span class="n">yearsuffix</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="acs5-207"><a href="#acs5-207"><span class="linenos">207</span></a>        <span class="n">_variables</span><span class="p">(</span><span class="s2">&quot;B05003&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</span><span id="acs5-208"><a href="#acs5-208"><span class="linenos">208</span></a>        <span class="o">+</span> <span class="n">_variables</span><span class="p">(</span><span class="s2">&quot;B05003&quot;</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
</span><span id="acs5-209"><a href="#acs5-209"><span class="linenos">209</span></a>        <span class="o">+</span> <span class="n">_variables</span><span class="p">(</span><span class="s2">&quot;B05003&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</span><span id="acs5-210"><a href="#acs5-210"><span class="linenos">210</span></a>        <span class="o">+</span> <span class="n">_variables</span><span class="p">(</span><span class="s2">&quot;B05003&quot;</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
</span><span id="acs5-211"><a href="#acs5-211"><span class="linenos">211</span></a>    <span class="p">)</span>
</span><span id="acs5-212"><a href="#acs5-212"><span class="linenos">212</span></a>
</span><span id="acs5-213"><a href="#acs5-213"><span class="linenos">213</span></a>    <span class="c1"># TODO: all variables used across the data submodule should be packaged up</span>
</span><span id="acs5-214"><a href="#acs5-214"><span class="linenos">214</span></a>    <span class="c1"># as a class, so we can access individual dictionaries of variables to add.</span>
</span><span id="acs5-215"><a href="#acs5-215"><span class="linenos">215</span></a>    <span class="c1"># For example, we should have a `Variables.acs5.vap` property which gives</span>
</span><span id="acs5-216"><a href="#acs5-216"><span class="linenos">216</span></a>    <span class="c1"># us the voting-age population variables for the ACS 5-year estimates.</span>
</span><span id="acs5-217"><a href="#acs5-217"><span class="linenos">217</span></a>
</span><span id="acs5-218"><a href="#acs5-218"><span class="linenos">218</span></a>    <span class="c1"># Get the list of all columns.</span>
</span><span id="acs5-219"><a href="#acs5-219"><span class="linenos">219</span></a>    <span class="n">allcols</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="acs5-220"><a href="#acs5-220"><span class="linenos">220</span></a>        <span class="nb">list</span><span class="p">(</span><span class="n">popcolumns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">columns</span>
</span><span id="acs5-221"><a href="#acs5-221"><span class="linenos">221</span></a>    <span class="p">)</span>
</span><span id="acs5-222"><a href="#acs5-222"><span class="linenos">222</span></a>
</span><span id="acs5-223"><a href="#acs5-223"><span class="linenos">223</span></a>    <span class="c1"># Retrieve the data from the Census API.</span>
</span><span id="acs5-224"><a href="#acs5-224"><span class="linenos">224</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">censusdata</span><span class="o">.</span><span class="n">download</span><span class="p">(</span>
</span><span id="acs5-225"><a href="#acs5-225"><span class="linenos">225</span></a>        <span class="s2">&quot;acs5&quot;</span><span class="p">,</span>
</span><span id="acs5-226"><a href="#acs5-226"><span class="linenos">226</span></a>        <span class="n">year</span><span class="p">,</span>
</span><span id="acs5-227"><a href="#acs5-227"><span class="linenos">227</span></a>        <span class="n">censusdata</span><span class="o">.</span><span class="n">censusgeo</span><span class="p">(</span>
</span><span id="acs5-228"><a href="#acs5-228"><span class="linenos">228</span></a>            <span class="p">[(</span><span class="s2">&quot;state&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">fips</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="p">(</span><span class="s2">&quot;county&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)]</span>
</span><span id="acs5-229"><a href="#acs5-229"><span class="linenos">229</span></a>        <span class="p">),</span>
</span><span id="acs5-230"><a href="#acs5-230"><span class="linenos">230</span></a>        <span class="p">[</span><span class="s2">&quot;GEO_ID&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">allcols</span><span class="p">,</span>
</span><span id="acs5-231"><a href="#acs5-231"><span class="linenos">231</span></a>    <span class="p">)</span>
</span><span id="acs5-232"><a href="#acs5-232"><span class="linenos">232</span></a>
</span><span id="acs5-233"><a href="#acs5-233"><span class="linenos">233</span></a>    <span class="c1"># Rework columns.</span>
</span><span id="acs5-234"><a href="#acs5-234"><span class="linenos">234</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="acs5-235"><a href="#acs5-235"><span class="linenos">235</span></a>    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;GEO_ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;GEO_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;US&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="acs5-236"><a href="#acs5-236"><span class="linenos">236</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="acs5-237"><a href="#acs5-237"><span class="linenos">237</span></a>        <span class="p">{</span><span class="s2">&quot;GEO_ID&quot;</span><span class="p">:</span> <span class="n">geometry</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;10&quot;</span> <span class="k">if</span> <span class="n">year</span> <span class="o">&lt;</span> <span class="mi">2020</span> <span class="k">else</span> <span class="s2">&quot;20&quot;</span><span class="p">)},</span>
</span><span id="acs5-238"><a href="#acs5-238"><span class="linenos">238</span></a>        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="acs5-239"><a href="#acs5-239"><span class="linenos">239</span></a>    <span class="p">)</span>
</span><span id="acs5-240"><a href="#acs5-240"><span class="linenos">240</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">popcolumns</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="acs5-241"><a href="#acs5-241"><span class="linenos">241</span></a>
</span><span id="acs5-242"><a href="#acs5-242"><span class="linenos">242</span></a>    <span class="c1"># Collapse column groups.</span>
</span><span id="acs5-243"><a href="#acs5-243"><span class="linenos">243</span></a>    <span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="acs5-244"><a href="#acs5-244"><span class="linenos">244</span></a>        <span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="acs5-245"><a href="#acs5-245"><span class="linenos">245</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="acs5-246"><a href="#acs5-246"><span class="linenos">246</span></a>
</span><span id="acs5-247"><a href="#acs5-247"><span class="linenos">247</span></a>    <span class="c1"># Create a POCVAP column.</span>
</span><span id="acs5-248"><a href="#acs5-248"><span class="linenos">248</span></a>    <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;POCVAP</span><span class="si">{</span><span class="n">yearsuffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="acs5-249"><a href="#acs5-249"><span class="linenos">249</span></a>        <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;VAP</span><span class="si">{</span><span class="n">yearsuffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">white</span><span class="si">}{</span><span class="n">yearsuffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
</span><span id="acs5-250"><a href="#acs5-250"><span class="linenos">250</span></a>    <span class="p">)</span>
</span><span id="acs5-251"><a href="#acs5-251"><span class="linenos">251</span></a>    <span class="k">return</span> <span class="n">data</span>
</span></pre></div>


            <div class="docstring"><p>Retrieves ACS 5-year population estimates for the provided state, geometry
level, and year. Also retrieves ACS-reported CVAP data, which closely
matches that reported by the CVAP special tabulation; CVAP data are only
returned at the tract level, and are otherwise reported as 0.</p>

<p>Args:
    state (us.State): <code>State</code> object for the desired state.
    geometry (str, optional): Geometry level at which data is retrieved.
        Acceptable values are <code>"tract"</code> and <code>"block group"</code>. Defaults to
        <code>"tract"</code>, so data is retrieved at the 2020 Census tract level.
    year (int, optional): Year for which data is retrieved. Defaults to
        2020.
    columns (list, optional): Columns to retrieve. If <code>None</code>, a default set
        of columns including total populations by race and ethnicity and
        voting-age populations by race and ethnicity are returned, along
        with a GEOID column.
    white (str, optional): The column removed from totals when calculating
        POC populations.</p>

<p>Returns:
    A DataFrame containing the formatted data.</p>
</div>


                </section>
                <section id="census20">
                            <input id="census20-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">census20</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">state</span>,</span><span class="param">	<span class="n">table</span><span class="o">=</span><span class="s1">&#39;P1&#39;</span>,</span><span class="param">	<span class="n">columns</span><span class="o">=</span><span class="p">{}</span>,</span><span class="param">	<span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;block&#39;</span>,</span><span class="param">	<span class="n">key</span><span class="o">=</span><span class="s1">&#39;75c0c07e6f0ab7b0a9a1c14c3d8af9d9f13b3d65&#39;</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="census20-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#census20"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="census20-86"><a href="#census20-86"><span class="linenos"> 86</span></a><span class="k">def</span> <span class="nf">census20</span><span class="p">(</span>
</span><span id="census20-87"><a href="#census20-87"><span class="linenos"> 87</span></a>    <span class="n">state</span><span class="p">,</span>
</span><span id="census20-88"><a href="#census20-88"><span class="linenos"> 88</span></a>    <span class="n">table</span><span class="o">=</span><span class="s2">&quot;P1&quot;</span><span class="p">,</span>
</span><span id="census20-89"><a href="#census20-89"><span class="linenos"> 89</span></a>    <span class="n">columns</span><span class="o">=</span><span class="p">{},</span>
</span><span id="census20-90"><a href="#census20-90"><span class="linenos"> 90</span></a>    <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;block&quot;</span><span class="p">,</span>
</span><span id="census20-91"><a href="#census20-91"><span class="linenos"> 91</span></a>    <span class="n">key</span><span class="o">=</span><span class="s2">&quot;75c0c07e6f0ab7b0a9a1c14c3d8af9d9f13b3d65&quot;</span><span class="p">,</span>
</span><span id="census20-92"><a href="#census20-92"><span class="linenos"> 92</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="census20-93"><a href="#census20-93"><span class="linenos"> 93</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="census20-94"><a href="#census20-94"><span class="linenos"> 94</span></a><span class="sd">    Retrieves `geometry`-level 2020 Decennial Census PL94-171 data via the</span>
</span><span id="census20-95"><a href="#census20-95"><span class="linenos"> 95</span></a><span class="sd">    Census API.</span>
</span><span id="census20-96"><a href="#census20-96"><span class="linenos"> 96</span></a>
</span><span id="census20-97"><a href="#census20-97"><span class="linenos"> 97</span></a><span class="sd">    Args:</span>
</span><span id="census20-98"><a href="#census20-98"><span class="linenos"> 98</span></a><span class="sd">        state (State): `us.State` object (e.g. `us.states.WI`).</span>
</span><span id="census20-99"><a href="#census20-99"><span class="linenos"> 99</span></a><span class="sd">        table (string, optional): Table from which we retrieve data.</span>
</span><span id="census20-100"><a href="#census20-100"><span class="linenos">100</span></a><span class="sd">            Defaults to the P1 table, which gets populations by race</span>
</span><span id="census20-101"><a href="#census20-101"><span class="linenos">101</span></a><span class="sd">            regardless of ethnicity.</span>
</span><span id="census20-102"><a href="#census20-102"><span class="linenos">102</span></a><span class="sd">        columns (dict, optional): Dictionary which maps Census column names</span>
</span><span id="census20-103"><a href="#census20-103"><span class="linenos">103</span></a><span class="sd">            (from the correct table) to human-readable names. We require this</span>
</span><span id="census20-104"><a href="#census20-104"><span class="linenos">104</span></a><span class="sd">            to be a dictionary, _not_ a list, as specifying human-readable</span>
</span><span id="census20-105"><a href="#census20-105"><span class="linenos">105</span></a><span class="sd">            names will implicitly protect against incorrect column names and</span>
</span><span id="census20-106"><a href="#census20-106"><span class="linenos">106</span></a><span class="sd">            excessive API calls.</span>
</span><span id="census20-107"><a href="#census20-107"><span class="linenos">107</span></a><span class="sd">        geometry (string, optional): Geometry level at which we retrieve data.</span>
</span><span id="census20-108"><a href="#census20-108"><span class="linenos">108</span></a><span class="sd">            Defaults to `&quot;block&quot;` to retrieve block-level data for the state</span>
</span><span id="census20-109"><a href="#census20-109"><span class="linenos">109</span></a><span class="sd">            provided. Accepted values are `&quot;block&quot;`, `&quot;block group`&quot;,</span>
</span><span id="census20-110"><a href="#census20-110"><span class="linenos">110</span></a><span class="sd">            and `&quot;tract&quot;`.</span>
</span><span id="census20-111"><a href="#census20-111"><span class="linenos">111</span></a><span class="sd">        key (string, optional): Census API key.</span>
</span><span id="census20-112"><a href="#census20-112"><span class="linenos">112</span></a>
</span><span id="census20-113"><a href="#census20-113"><span class="linenos">113</span></a><span class="sd">    Returns:</span>
</span><span id="census20-114"><a href="#census20-114"><span class="linenos">114</span></a><span class="sd">        A DataFrame with columns renamed according to their Census description</span>
</span><span id="census20-115"><a href="#census20-115"><span class="linenos">115</span></a><span class="sd">        designation and a `GEOID20` column for joining to geometries.</span>
</span><span id="census20-116"><a href="#census20-116"><span class="linenos">116</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="census20-117"><a href="#census20-117"><span class="linenos">117</span></a>    <span class="c1"># Check whether the geometry is right. If not, warn the user and set it</span>
</span><span id="census20-118"><a href="#census20-118"><span class="linenos">118</span></a>    <span class="c1"># properly.</span>
</span><span id="census20-119"><a href="#census20-119"><span class="linenos">119</span></a>    <span class="k">if</span> <span class="n">geometry</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;block&quot;</span><span class="p">,</span> <span class="s2">&quot;tract&quot;</span><span class="p">,</span> <span class="s2">&quot;block group&quot;</span><span class="p">}:</span>
</span><span id="census20-120"><a href="#census20-120"><span class="linenos">120</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Geometry &quot;</span><span class="si">{</span><span class="n">geometry</span><span class="si">}</span><span class="s1">&quot; not accepted; defaulting&#39;</span> <span class="s1">&#39;to &quot;block&quot;.&#39;</span><span class="p">)</span>
</span><span id="census20-121"><a href="#census20-121"><span class="linenos">121</span></a>        <span class="n">geometry</span> <span class="o">=</span> <span class="s2">&quot;block&quot;</span>
</span><span id="census20-122"><a href="#census20-122"><span class="linenos">122</span></a>
</span><span id="census20-123"><a href="#census20-123"><span class="linenos">123</span></a>    <span class="c1"># Check whether we&#39;re providing an appropriate table name.</span>
</span><span id="census20-124"><a href="#census20-124"><span class="linenos">124</span></a>    <span class="k">if</span> <span class="n">table</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;P1&quot;</span><span class="p">,</span> <span class="s2">&quot;P2&quot;</span><span class="p">,</span> <span class="s2">&quot;P3&quot;</span><span class="p">,</span> <span class="s2">&quot;P4&quot;</span><span class="p">}:</span>
</span><span id="census20-125"><a href="#census20-125"><span class="linenos">125</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Table &quot;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s1">&quot; not accepted; defaulting to &quot;P1.&quot;&#39;</span><span class="p">)</span>
</span><span id="census20-126"><a href="#census20-126"><span class="linenos">126</span></a>        <span class="n">table</span> <span class="o">=</span> <span class="s2">&quot;P1&quot;</span>
</span><span id="census20-127"><a href="#census20-127"><span class="linenos">127</span></a>
</span><span id="census20-128"><a href="#census20-128"><span class="linenos">128</span></a>    <span class="c1"># Set the base Census API URL and get the keys for the provided table.</span>
</span><span id="census20-129"><a href="#census20-129"><span class="linenos">129</span></a>    <span class="n">base</span> <span class="o">=</span> <span class="s2">&quot;https://api.census.gov/data/2020/dec/pl&quot;</span>
</span><span id="census20-130"><a href="#census20-130"><span class="linenos">130</span></a>    <span class="n">varmap</span> <span class="o">=</span> <span class="n">columns</span> <span class="k">if</span> <span class="n">columns</span> <span class="k">else</span> <span class="n">variables</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="census20-131"><a href="#census20-131"><span class="linenos">131</span></a>    <span class="nb">vars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">varmap</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="census20-132"><a href="#census20-132"><span class="linenos">132</span></a>
</span><span id="census20-133"><a href="#census20-133"><span class="linenos">133</span></a>    <span class="c1"># Create the end part of the query string.</span>
</span><span id="census20-134"><a href="#census20-134"><span class="linenos">134</span></a>    <span class="n">q</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="census20-135"><a href="#census20-135"><span class="linenos">135</span></a>        <span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">),</span>
</span><span id="census20-136"><a href="#census20-136"><span class="linenos">136</span></a>        <span class="p">(</span><span class="s2">&quot;for&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">geometry</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="sa">r</span><span class="s1">&#39;%20&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:*&quot;</span><span class="p">),</span>
</span><span id="census20-137"><a href="#census20-137"><span class="linenos">137</span></a>        <span class="p">(</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;state:</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">fips</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="census20-138"><a href="#census20-138"><span class="linenos">138</span></a>        <span class="p">(</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="s2">&quot;county:*&quot;</span><span class="p">),</span>
</span><span id="census20-139"><a href="#census20-139"><span class="linenos">139</span></a>    <span class="p">]</span>
</span><span id="census20-140"><a href="#census20-140"><span class="linenos">140</span></a>
</span><span id="census20-141"><a href="#census20-141"><span class="linenos">141</span></a>    <span class="c1"># Based on the geometry type, add an additional entry; this is required to</span>
</span><span id="census20-142"><a href="#census20-142"><span class="linenos">142</span></a>    <span class="c1"># match the Census geographic hierarchy.</span>
</span><span id="census20-143"><a href="#census20-143"><span class="linenos">143</span></a>    <span class="k">if</span> <span class="n">geometry</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;block&quot;</span><span class="p">,</span> <span class="s2">&quot;block group&quot;</span><span class="p">}:</span>
</span><span id="census20-144"><a href="#census20-144"><span class="linenos">144</span></a>        <span class="n">q</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="s2">&quot;tract:*&quot;</span><span class="p">))</span>
</span><span id="census20-145"><a href="#census20-145"><span class="linenos">145</span></a>
</span><span id="census20-146"><a href="#census20-146"><span class="linenos">146</span></a>    <span class="c1"># Now, since the Census doesn&#39;t allow us to request more than 50 variables</span>
</span><span id="census20-147"><a href="#census20-147"><span class="linenos">147</span></a>    <span class="c1"># at once, we request things in two parts and then merge them together.</span>
</span><span id="census20-148"><a href="#census20-148"><span class="linenos">148</span></a>    <span class="n">mergeable</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="census20-149"><a href="#census20-149"><span class="linenos">149</span></a>
</span><span id="census20-150"><a href="#census20-150"><span class="linenos">150</span></a>    <span class="c1"># Split up start and stop positions based on the number of variables.</span>
</span><span id="census20-151"><a href="#census20-151"><span class="linenos">151</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">vars</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">45</span><span class="p">:</span>
</span><span id="census20-152"><a href="#census20-152"><span class="linenos">152</span></a>        <span class="n">positions</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">vars</span><span class="p">))]</span>
</span><span id="census20-153"><a href="#census20-153"><span class="linenos">153</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="census20-154"><a href="#census20-154"><span class="linenos">154</span></a>        <span class="n">positions</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">45</span><span class="p">),</span> <span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">vars</span><span class="p">))]</span>
</span><span id="census20-155"><a href="#census20-155"><span class="linenos">155</span></a>
</span><span id="census20-156"><a href="#census20-156"><span class="linenos">156</span></a>    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
</span><span id="census20-157"><a href="#census20-157"><span class="linenos">157</span></a>        <span class="c1"># Get the chunk of variables and create a tail of columns (geographic</span>
</span><span id="census20-158"><a href="#census20-158"><span class="linenos">158</span></a>        <span class="c1"># identifiers).</span>
</span><span id="census20-159"><a href="#census20-159"><span class="linenos">159</span></a>        <span class="n">varchunk</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
</span><span id="census20-160"><a href="#census20-160"><span class="linenos">160</span></a>        <span class="n">last</span> <span class="o">=</span> <span class="p">[</span><span class="n">geometry</span><span class="p">]</span> <span class="k">if</span> <span class="n">geometry</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;block group&quot;</span><span class="p">,</span> <span class="s2">&quot;block&quot;</span><span class="p">}</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="census20-161"><a href="#census20-161"><span class="linenos">161</span></a>        <span class="n">tail</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">,</span> <span class="s2">&quot;county&quot;</span><span class="p">,</span> <span class="s2">&quot;tract&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">last</span>
</span><span id="census20-162"><a href="#census20-162"><span class="linenos">162</span></a>
</span><span id="census20-163"><a href="#census20-163"><span class="linenos">163</span></a>        <span class="c1"># Create an unescaped query string.</span>
</span><span id="census20-164"><a href="#census20-164"><span class="linenos">164</span></a>        <span class="n">unescaped</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="census20-165"><a href="#census20-165"><span class="linenos">165</span></a>        <span class="n">unescaped</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">varchunk</span><span class="p">)))</span>
</span><span id="census20-166"><a href="#census20-166"><span class="linenos">166</span></a>
</span><span id="census20-167"><a href="#census20-167"><span class="linenos">167</span></a>        <span class="c1"># Create an escaped query string from the previous.</span>
</span><span id="census20-168"><a href="#census20-168"><span class="linenos">168</span></a>        <span class="n">escaped</span> <span class="o">=</span> <span class="s2">&quot;?&quot;</span> <span class="o">+</span> <span class="s2">&quot;&amp;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">unescaped</span><span class="p">)</span>
</span><span id="census20-169"><a href="#census20-169"><span class="linenos">169</span></a>
</span><span id="census20-170"><a href="#census20-170"><span class="linenos">170</span></a>        <span class="c1"># Send the request and create a dataframe.</span>
</span><span id="census20-171"><a href="#census20-171"><span class="linenos">171</span></a>        <span class="n">req</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">escaped</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="census20-172"><a href="#census20-172"><span class="linenos">172</span></a>        <span class="n">header</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">req</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="census20-173"><a href="#census20-173"><span class="linenos">173</span></a>        <span class="n">chunk</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
</span><span id="census20-174"><a href="#census20-174"><span class="linenos">174</span></a>
</span><span id="census20-175"><a href="#census20-175"><span class="linenos">175</span></a>        <span class="c1"># Get a GEOID column and drop old columns.</span>
</span><span id="census20-176"><a href="#census20-176"><span class="linenos">176</span></a>        <span class="n">chunk</span><span class="p">[</span><span class="s2">&quot;GEOID20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_rjoin</span><span class="p">(</span><span class="n">chunk</span><span class="p">[</span><span class="n">tail</span><span class="p">],</span> <span class="n">tail</span><span class="p">)</span>
</span><span id="census20-177"><a href="#census20-177"><span class="linenos">177</span></a>        <span class="n">chunk</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">tail</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="census20-178"><a href="#census20-178"><span class="linenos">178</span></a>        <span class="n">mergeable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="census20-179"><a href="#census20-179"><span class="linenos">179</span></a>
</span><span id="census20-180"><a href="#census20-180"><span class="linenos">180</span></a>    <span class="c1"># Merge the dataframes, rename everything, make the columns</span>
</span><span id="census20-181"><a href="#census20-181"><span class="linenos">181</span></a>    <span class="c1"># ints, and return.</span>
</span><span id="census20-182"><a href="#census20-182"><span class="linenos">182</span></a>    <span class="n">merged</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;GEOID20&quot;</span><span class="p">),</span> <span class="n">mergeable</span><span class="p">)</span>
</span><span id="census20-183"><a href="#census20-183"><span class="linenos">183</span></a>    <span class="n">merged</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">varmap</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="census20-184"><a href="#census20-184"><span class="linenos">184</span></a>    <span class="n">merged</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">var</span><span class="p">:</span> <span class="nb">int</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">varmap</span><span class="o">.</span><span class="n">values</span><span class="p">()})</span>
</span><span id="census20-185"><a href="#census20-185"><span class="linenos">185</span></a>
</span><span id="census20-186"><a href="#census20-186"><span class="linenos">186</span></a>    <span class="c1"># Make the GEOID20 column the first column.</span>
</span><span id="census20-187"><a href="#census20-187"><span class="linenos">187</span></a>    <span class="n">merged</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[[</span><span class="s2">&quot;GEOID20&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">varmap</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
</span><span id="census20-188"><a href="#census20-188"><span class="linenos">188</span></a>
</span><span id="census20-189"><a href="#census20-189"><span class="linenos">189</span></a>    <span class="k">return</span> <span class="n">merged</span>
</span></pre></div>


            <div class="docstring"><p>Retrieves <code>geometry</code>-level 2020 Decennial Census PL94-171 data via the
Census API.</p>

<p>Args:
    state (State): <code>us.State</code> object (e.g. <code>us.states.WI</code>).
    table (string, optional): Table from which we retrieve data.
        Defaults to the P1 table, which gets populations by race
        regardless of ethnicity.
    columns (dict, optional): Dictionary which maps Census column names
        (from the correct table) to human-readable names. We require this
        to be a dictionary, _not_ a list, as specifying human-readable
        names will implicitly protect against incorrect column names and
        excessive API calls.
    geometry (string, optional): Geometry level at which we retrieve data.
        Defaults to <code>"block"</code> to retrieve block-level data for the state
        provided. Accepted values are <code>"block"</code>, <code>"block group</code>",
        and <code>"tract"</code>.
    key (string, optional): Census API key.</p>

<p>Returns:
    A DataFrame with columns renamed according to their Census description
    designation and a <code>GEOID20</code> column for joining to geometries.</p>
</div>


                </section>
                <section id="variables">
                            <input id="variables-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">variables</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">table</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="variables-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#variables"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="variables-192"><a href="#variables-192"><span class="linenos">192</span></a><span class="k">def</span> <span class="nf">variables</span><span class="p">(</span><span class="n">table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="variables-193"><a href="#variables-193"><span class="linenos">193</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="variables-194"><a href="#variables-194"><span class="linenos">194</span></a><span class="sd">    Produces variable names for the 2020 Census PL94-171 tables. Variables are</span>
</span><span id="variables-195"><a href="#variables-195"><span class="linenos">195</span></a><span class="sd">    determined from patterns apparent in PL94 variable</span>
</span><span id="variables-196"><a href="#variables-196"><span class="linenos">196</span></a><span class="sd">    [lists for tables P1 through P4](https://tinyurl.com/2s3btptn).</span>
</span><span id="variables-197"><a href="#variables-197"><span class="linenos">197</span></a>
</span><span id="variables-198"><a href="#variables-198"><span class="linenos">198</span></a><span class="sd">    Args:</span>
</span><span id="variables-199"><a href="#variables-199"><span class="linenos">199</span></a><span class="sd">        table (string): The table for which we&#39;re generating variables.</span>
</span><span id="variables-200"><a href="#variables-200"><span class="linenos">200</span></a>
</span><span id="variables-201"><a href="#variables-201"><span class="linenos">201</span></a><span class="sd">    Returns:</span>
</span><span id="variables-202"><a href="#variables-202"><span class="linenos">202</span></a><span class="sd">        A dictionary mapping Census variable codes to human-readable ones.</span>
</span><span id="variables-203"><a href="#variables-203"><span class="linenos">203</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="variables-204"><a href="#variables-204"><span class="linenos">204</span></a>    <span class="c1"># List the categories of Census variables and find the combinations in the</span>
</span><span id="variables-205"><a href="#variables-205"><span class="linenos">205</span></a>    <span class="c1"># correct order. This *should* be the original order in which they&#39;re</span>
</span><span id="variables-206"><a href="#variables-206"><span class="linenos">206</span></a>    <span class="c1"># listed, but these have been spot-checked to verify their correctness.</span>
</span><span id="variables-207"><a href="#variables-207"><span class="linenos">207</span></a>    <span class="c1"># These names are also modified based on the table passed; for example,</span>
</span><span id="variables-208"><a href="#variables-208"><span class="linenos">208</span></a>    <span class="c1"># if the table passed is P2 or P4, we prepend an &quot;NH&quot; to the beginning,</span>
</span><span id="variables-209"><a href="#variables-209"><span class="linenos">209</span></a>    <span class="c1"># as these columns are explicitly non-hispanic people. If the table</span>
</span><span id="variables-210"><a href="#variables-210"><span class="linenos">210</span></a>    <span class="c1"># passed is P3 or P4, we append a &quot;VAP&quot; to the end to signify these</span>
</span><span id="variables-211"><a href="#variables-211"><span class="linenos">211</span></a>    <span class="c1"># are people of voting age; otherwise, we add &quot;POP.&quot;</span>
</span><span id="variables-212"><a href="#variables-212"><span class="linenos">212</span></a>    <span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;WHITE&quot;</span><span class="p">,</span> <span class="s2">&quot;BLACK&quot;</span><span class="p">,</span> <span class="s2">&quot;AMIN&quot;</span><span class="p">,</span> <span class="s2">&quot;ASIAN&quot;</span><span class="p">,</span> <span class="s2">&quot;NHPI&quot;</span><span class="p">,</span> <span class="s2">&quot;OTH&quot;</span><span class="p">]</span>
</span><span id="variables-213"><a href="#variables-213"><span class="linenos">213</span></a>    <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;NH&quot;</span> <span class="k">if</span> <span class="n">table</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;P2&quot;</span><span class="p">,</span> <span class="s2">&quot;P4&quot;</span><span class="p">,</span> <span class="s2">&quot;P9&quot;</span><span class="p">,</span> <span class="s2">&quot;P11&quot;</span><span class="p">}</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="variables-214"><a href="#variables-214"><span class="linenos">214</span></a>    <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;VAP&quot;</span> <span class="k">if</span> <span class="n">table</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;P3&quot;</span><span class="p">,</span> <span class="s2">&quot;P4&quot;</span><span class="p">,</span> <span class="s2">&quot;P10&quot;</span><span class="p">,</span> <span class="s2">&quot;P11&quot;</span><span class="p">}</span> <span class="k">else</span> <span class="s2">&quot;POP&quot;</span>
</span><span id="variables-215"><a href="#variables-215"><span class="linenos">215</span></a>    <span class="n">year_suff</span> <span class="o">=</span> <span class="s2">&quot;20&quot;</span> <span class="k">if</span> <span class="n">table</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;P1&quot;</span><span class="p">,</span> <span class="s2">&quot;P2&quot;</span><span class="p">,</span> <span class="s2">&quot;P3&quot;</span><span class="p">,</span> <span class="s2">&quot;P4&quot;</span><span class="p">}</span> <span class="k">else</span> <span class="s2">&quot;10&quot;</span>
</span><span id="variables-216"><a href="#variables-216"><span class="linenos">216</span></a>    <span class="n">combos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="variables-217"><a href="#variables-217"><span class="linenos">217</span></a>        <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span>
</span><span id="variables-218"><a href="#variables-218"><span class="linenos">218</span></a>            <span class="p">[</span>
</span><span id="variables-219"><a href="#variables-219"><span class="linenos">219</span></a>                <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">combo</span><span class="p">))</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="n">year_suff</span>
</span><span id="variables-220"><a href="#variables-220"><span class="linenos">220</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="variables-221"><a href="#variables-221"><span class="linenos">221</span></a>                <span class="k">for</span> <span class="n">combo</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
</span><span id="variables-222"><a href="#variables-222"><span class="linenos">222</span></a>            <span class="p">]</span>
</span><span id="variables-223"><a href="#variables-223"><span class="linenos">223</span></a>        <span class="p">)</span>
</span><span id="variables-224"><a href="#variables-224"><span class="linenos">224</span></a>    <span class="p">)</span>
</span><span id="variables-225"><a href="#variables-225"><span class="linenos">225</span></a>
</span><span id="variables-226"><a href="#variables-226"><span class="linenos">226</span></a>    <span class="c1"># Now, for each of the combinations, we map the appropriate variable</span>
</span><span id="variables-227"><a href="#variables-227"><span class="linenos">227</span></a>    <span class="c1"># name to the descriptor. Each of these tranches should have a width</span>
</span><span id="variables-228"><a href="#variables-228"><span class="linenos">228</span></a>    <span class="c1"># of 6 choose i, where i is the number of categories in the</span>
</span><span id="variables-229"><a href="#variables-229"><span class="linenos">229</span></a>    <span class="c1"># combination. For example, the second tranch (from 13 to 27) has</span>
</span><span id="variables-230"><a href="#variables-230"><span class="linenos">230</span></a>    <span class="c1"># width 15, as 6C2=15.</span>
</span><span id="variables-231"><a href="#variables-231"><span class="linenos">231</span></a>    <span class="k">if</span> <span class="n">table</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;P1&quot;</span><span class="p">,</span> <span class="s2">&quot;P3&quot;</span><span class="p">,</span> <span class="s2">&quot;P8&quot;</span><span class="p">,</span> <span class="s2">&quot;P10&quot;</span><span class="p">}:</span>
</span><span id="variables-232"><a href="#variables-232"><span class="linenos">232</span></a>        <span class="n">tranches</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span> <span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="mi">46</span><span class="p">),</span> <span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="mi">62</span><span class="p">),</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">69</span><span class="p">),</span> <span class="p">(</span><span class="mi">71</span><span class="p">,</span> <span class="mi">71</span><span class="p">)]</span>
</span><span id="variables-233"><a href="#variables-233"><span class="linenos">233</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="variables-234"><a href="#variables-234"><span class="linenos">234</span></a>        <span class="n">tranches</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">27</span><span class="p">),</span> <span class="p">(</span><span class="mi">29</span><span class="p">,</span> <span class="mi">48</span><span class="p">),</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span> <span class="p">(</span><span class="mi">66</span><span class="p">,</span> <span class="mi">71</span><span class="p">),</span> <span class="p">(</span><span class="mi">73</span><span class="p">,</span> <span class="mi">73</span><span class="p">)]</span>
</span><span id="variables-235"><a href="#variables-235"><span class="linenos">235</span></a>
</span><span id="variables-236"><a href="#variables-236"><span class="linenos">236</span></a>    <span class="c1"># Create variable numbers.</span>
</span><span id="variables-237"><a href="#variables-237"><span class="linenos">237</span></a>    <span class="n">numbers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">flatten</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">tranches</span><span class="p">]))</span>
</span><span id="variables-238"><a href="#variables-238"><span class="linenos">238</span></a>
</span><span id="variables-239"><a href="#variables-239"><span class="linenos">239</span></a>    <span class="c1"># Edit these for specific tables. For example, in tables P2 and P3, we want</span>
</span><span id="variables-240"><a href="#variables-240"><span class="linenos">240</span></a>    <span class="c1"># to get the total Hispanic population and the total population.</span>
</span><span id="variables-241"><a href="#variables-241"><span class="linenos">241</span></a>    <span class="k">if</span> <span class="n">table</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;P2&quot;</span><span class="p">,</span> <span class="s2">&quot;P4&quot;</span><span class="p">,</span> <span class="s2">&quot;P9&quot;</span><span class="p">,</span> <span class="s2">&quot;P11&quot;</span><span class="p">}:</span>
</span><span id="variables-242"><a href="#variables-242"><span class="linenos">242</span></a>        <span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">numbers</span>
</span><span id="variables-243"><a href="#variables-243"><span class="linenos">243</span></a>        <span class="k">if</span> <span class="n">table</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;P4&quot;</span><span class="p">,</span> <span class="s2">&quot;P11&quot;</span><span class="p">}:</span>
</span><span id="variables-244"><a href="#variables-244"><span class="linenos">244</span></a>            <span class="n">hcol</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;HVAP</span><span class="si">{</span><span class="n">year_suff</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="variables-245"><a href="#variables-245"><span class="linenos">245</span></a>            <span class="n">tcol</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;VAP</span><span class="si">{</span><span class="n">year_suff</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="variables-246"><a href="#variables-246"><span class="linenos">246</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="variables-247"><a href="#variables-247"><span class="linenos">247</span></a>            <span class="n">hcol</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;HPOP</span><span class="si">{</span><span class="n">year_suff</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="variables-248"><a href="#variables-248"><span class="linenos">248</span></a>            <span class="n">tcol</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;TOTPOP</span><span class="si">{</span><span class="n">year_suff</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="variables-249"><a href="#variables-249"><span class="linenos">249</span></a>        <span class="n">combos</span> <span class="o">=</span> <span class="p">[</span><span class="n">tcol</span><span class="p">,</span> <span class="n">hcol</span><span class="p">]</span> <span class="o">+</span> <span class="n">combos</span>
</span><span id="variables-250"><a href="#variables-250"><span class="linenos">250</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="variables-251"><a href="#variables-251"><span class="linenos">251</span></a>        <span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">numbers</span>
</span><span id="variables-252"><a href="#variables-252"><span class="linenos">252</span></a>        <span class="k">if</span> <span class="n">table</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;P3&quot;</span><span class="p">,</span> <span class="s2">&quot;P4&quot;</span><span class="p">,</span> <span class="s2">&quot;P10&quot;</span><span class="p">,</span> <span class="s2">&quot;P11&quot;</span><span class="p">}:</span>
</span><span id="variables-253"><a href="#variables-253"><span class="linenos">253</span></a>            <span class="n">tcol</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;VAP</span><span class="si">{</span><span class="n">year_suff</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="variables-254"><a href="#variables-254"><span class="linenos">254</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="variables-255"><a href="#variables-255"><span class="linenos">255</span></a>            <span class="n">tcol</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;TOTPOP</span><span class="si">{</span><span class="n">year_suff</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="variables-256"><a href="#variables-256"><span class="linenos">256</span></a>        <span class="n">combos</span> <span class="o">=</span> <span class="p">[</span><span class="n">tcol</span><span class="p">]</span> <span class="o">+</span> <span class="n">combos</span>
</span><span id="variables-257"><a href="#variables-257"><span class="linenos">257</span></a>
</span><span id="variables-258"><a href="#variables-258"><span class="linenos">258</span></a>    <span class="c1"># Create the variable names and zip the names together</span>
</span><span id="variables-259"><a href="#variables-259"><span class="linenos">259</span></a>    <span class="c1"># with the combinations.</span>
</span><span id="variables-260"><a href="#variables-260"><span class="linenos">260</span></a>    <span class="k">if</span> <span class="n">year_suff</span> <span class="o">==</span> <span class="s2">&quot;20&quot;</span><span class="p">:</span>
</span><span id="variables-261"><a href="#variables-261"><span class="linenos">261</span></a>        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">N&quot;</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">]</span>
</span><span id="variables-262"><a href="#variables-262"><span class="linenos">262</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="variables-263"><a href="#variables-263"><span class="linenos">263</span></a>        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="variables-264"><a href="#variables-264"><span class="linenos">264</span></a>            <span class="sa">f</span><span class="s2">&quot;P</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}{</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">numbers</span>
</span><span id="variables-265"><a href="#variables-265"><span class="linenos">265</span></a>        <span class="p">]</span>
</span><span id="variables-266"><a href="#variables-266"><span class="linenos">266</span></a>    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">combos</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Produces variable names for the 2020 Census PL94-171 tables. Variables are
determined from patterns apparent in PL94 variable
<a href="https://tinyurl.com/2s3btptn">lists for tables P1 through P4</a>.</p>

<p>Args:
    table (string): The table for which we're generating variables.</p>

<p>Returns:
    A dictionary mapping Census variable codes to human-readable ones.</p>
</div>


                </section>
                <section id="estimatecvap2010">
                            <input id="estimatecvap2010-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">estimatecvap2010</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">base</span>,</span><span class="param">	<span class="n">state</span>,</span><span class="param">	<span class="n">groups</span>,</span><span class="param">	<span class="n">ceiling</span>,</span><span class="param">	<span class="n">zfill</span>,</span><span class="param">	<span class="n">geometry10</span><span class="o">=</span><span class="s1">&#39;tract&#39;</span>,</span><span class="param">	<span class="n">year</span><span class="o">=</span><span class="mi">2019</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="estimatecvap2010-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#estimatecvap2010"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="estimatecvap2010-183"><a href="#estimatecvap2010-183"><span class="linenos">183</span></a><span class="k">def</span> <span class="nf">estimatecvap2010</span><span class="p">(</span>
</span><span id="estimatecvap2010-184"><a href="#estimatecvap2010-184"><span class="linenos">184</span></a>    <span class="n">base</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">ceiling</span><span class="p">,</span> <span class="n">zfill</span><span class="p">,</span> <span class="n">geometry10</span><span class="o">=</span><span class="s2">&quot;tract&quot;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="mi">2019</span>
</span><span id="estimatecvap2010-185"><a href="#estimatecvap2010-185"><span class="linenos">185</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="estimatecvap2010-186"><a href="#estimatecvap2010-186"><span class="linenos">186</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="estimatecvap2010-187"><a href="#estimatecvap2010-187"><span class="linenos">187</span></a><span class="sd">    Function for turning old (2019) CVAP data on 2010 geometries into</span>
</span><span id="estimatecvap2010-188"><a href="#estimatecvap2010-188"><span class="linenos">188</span></a><span class="sd">    estimates for current CVAP data on 2020 geometries. **This method</span>
</span><span id="estimatecvap2010-189"><a href="#estimatecvap2010-189"><span class="linenos">189</span></a><span class="sd">    serves a different purpose than `gerrytools.data.estimatecvap.</span>
</span><span id="estimatecvap2010-190"><a href="#estimatecvap2010-190"><span class="linenos">190</span></a><span class="sd">    estimatecvap2020()`:** this method is intended to put 2010-era CVAP</span>
</span><span id="estimatecvap2010-191"><a href="#estimatecvap2010-191"><span class="linenos">191</span></a><span class="sd">    data on 2020-era geometries, and uses geometric properties to do so.</span>
</span><span id="estimatecvap2010-192"><a href="#estimatecvap2010-192"><span class="linenos">192</span></a>
</span><span id="estimatecvap2010-193"><a href="#estimatecvap2010-193"><span class="linenos">193</span></a><span class="sd">    Users must supply a base `GeoDataFrame`</span>
</span><span id="estimatecvap2010-194"><a href="#estimatecvap2010-194"><span class="linenos">194</span></a><span class="sd">    representing their chosen U.S. state. Additionally, users must specify the</span>
</span><span id="estimatecvap2010-195"><a href="#estimatecvap2010-195"><span class="linenos">195</span></a><span class="sd">    demographic groups whose CVAP statistics are to be estimated. For each</span>
</span><span id="estimatecvap2010-196"><a href="#estimatecvap2010-196"><span class="linenos">196</span></a><span class="sd">    group, users specify a triple \((X, Y, Z)\) where \(X\) is the old CVAP</span>
</span><span id="estimatecvap2010-197"><a href="#estimatecvap2010-197"><span class="linenos">197</span></a><span class="sd">    column for that group, \(Y\) is the old VAP column for that group, and</span>
</span><span id="estimatecvap2010-198"><a href="#estimatecvap2010-198"><span class="linenos">198</span></a><span class="sd">    \(Z\) is the new VAP column for that group, which must be an existing</span>
</span><span id="estimatecvap2010-199"><a href="#estimatecvap2010-199"><span class="linenos">199</span></a><span class="sd">    column on `base`. Then, the estimated new CVAP for that group will be</span>
</span><span id="estimatecvap2010-200"><a href="#estimatecvap2010-200"><span class="linenos">200</span></a><span class="sd">    constructed by multiplying \((X / Y) \cdot Z\) for each new geometry.</span>
</span><span id="estimatecvap2010-201"><a href="#estimatecvap2010-201"><span class="linenos">201</span></a>
</span><span id="estimatecvap2010-202"><a href="#estimatecvap2010-202"><span class="linenos">202</span></a><span class="sd">    &lt;div style=&quot;text-align: center;&quot;&gt;</span>
</span><span id="estimatecvap2010-203"><a href="#estimatecvap2010-203"><span class="linenos">203</span></a><span class="sd">        &lt;/br&gt;</span>
</span><span id="estimatecvap2010-204"><a href="#estimatecvap2010-204"><span class="linenos">204</span></a><span class="sd">        &lt;img width=&quot;75%&quot; src=&quot;../images/cvap-estimation.png&quot;/&gt;</span>
</span><span id="estimatecvap2010-205"><a href="#estimatecvap2010-205"><span class="linenos">205</span></a><span class="sd">    &lt;/div&gt;</span>
</span><span id="estimatecvap2010-206"><a href="#estimatecvap2010-206"><span class="linenos">206</span></a>
</span><span id="estimatecvap2010-207"><a href="#estimatecvap2010-207"><span class="linenos">207</span></a><span class="sd">    Args:</span>
</span><span id="estimatecvap2010-208"><a href="#estimatecvap2010-208"><span class="linenos">208</span></a><span class="sd">        base (GeoDataFrame): A `GeoDataFrame` with the appropriate columns for</span>
</span><span id="estimatecvap2010-209"><a href="#estimatecvap2010-209"><span class="linenos">209</span></a><span class="sd">            estimating CVAP.</span>
</span><span id="estimatecvap2010-210"><a href="#estimatecvap2010-210"><span class="linenos">210</span></a><span class="sd">        state (State): The `us.State` object for which CVAP data is retrieved.</span>
</span><span id="estimatecvap2010-211"><a href="#estimatecvap2010-211"><span class="linenos">211</span></a><span class="sd">        groups (list): `(X, Y, Z)` triples for each desired CVAP group to be</span>
</span><span id="estimatecvap2010-212"><a href="#estimatecvap2010-212"><span class="linenos">212</span></a><span class="sd">            estimated, where each of the parameters are column names: `X` is</span>
</span><span id="estimatecvap2010-213"><a href="#estimatecvap2010-213"><span class="linenos">213</span></a><span class="sd">            the column on the 2010 geometries which contains the relevant CVAP</span>
</span><span id="estimatecvap2010-214"><a href="#estimatecvap2010-214"><span class="linenos">214</span></a><span class="sd">            data; `Y` is the column on the 2010 geometries which contains the</span>
</span><span id="estimatecvap2010-215"><a href="#estimatecvap2010-215"><span class="linenos">215</span></a><span class="sd">            relevant VAP data; `Z` is the column on the 2020 geometries to be</span>
</span><span id="estimatecvap2010-216"><a href="#estimatecvap2010-216"><span class="linenos">216</span></a><span class="sd">            weighted by the ratio of the per-unit ratios in `X` and `Y`. For</span>
</span><span id="estimatecvap2010-217"><a href="#estimatecvap2010-217"><span class="linenos">217</span></a><span class="sd">            example, if we wish to estimate Black CVAP, this triple would be</span>
</span><span id="estimatecvap2010-218"><a href="#estimatecvap2010-218"><span class="linenos">218</span></a><span class="sd">            `(NHBCVAP19, BVAP19, BVAP20)`, which takes the ratios of the</span>
</span><span id="estimatecvap2010-219"><a href="#estimatecvap2010-219"><span class="linenos">219</span></a><span class="sd">            `NHBCVAP19` and `BVAP19` columns on the 2010 geometries, and</span>
</span><span id="estimatecvap2010-220"><a href="#estimatecvap2010-220"><span class="linenos">220</span></a><span class="sd">            multplies the 2020 geometries&#39; respective `BVAP20` values</span>
</span><span id="estimatecvap2010-221"><a href="#estimatecvap2010-221"><span class="linenos">221</span></a><span class="sd">            by these ratios.</span>
</span><span id="estimatecvap2010-222"><a href="#estimatecvap2010-222"><span class="linenos">222</span></a><span class="sd">        ceiling (float): Number representing where to cap the weighting</span>
</span><span id="estimatecvap2010-223"><a href="#estimatecvap2010-223"><span class="linenos">223</span></a><span class="sd">            ratio of CVAP to VAP20. After this percentage ceiling is</span>
</span><span id="estimatecvap2010-224"><a href="#estimatecvap2010-224"><span class="linenos">224</span></a><span class="sd">            passed, the percentage will be set to 1. We recommend</span>
</span><span id="estimatecvap2010-225"><a href="#estimatecvap2010-225"><span class="linenos">225</span></a><span class="sd">            setting this to 1.</span>
</span><span id="estimatecvap2010-226"><a href="#estimatecvap2010-226"><span class="linenos">226</span></a><span class="sd">        zfill (float): Fill in ratio for CVAP to VAP20 when there is 0 CVAP</span>
</span><span id="estimatecvap2010-227"><a href="#estimatecvap2010-227"><span class="linenos">227</span></a><span class="sd">            in the area. We recommend setting this parameter to `0.1`.</span>
</span><span id="estimatecvap2010-228"><a href="#estimatecvap2010-228"><span class="linenos">228</span></a><span class="sd">        geometry10 (str, optional): The 2010 geometry on which cvap will</span>
</span><span id="estimatecvap2010-229"><a href="#estimatecvap2010-229"><span class="linenos">229</span></a><span class="sd">            be pulled. Acceptable values are `&quot;tract&quot;` or `&quot;block group&quot;`.</span>
</span><span id="estimatecvap2010-230"><a href="#estimatecvap2010-230"><span class="linenos">230</span></a><span class="sd">            As tracts are less susceptible to change across Census vintages,</span>
</span><span id="estimatecvap2010-231"><a href="#estimatecvap2010-231"><span class="linenos">231</span></a><span class="sd">            setting this parameter to `&quot;tract&quot;` is recommended, as it is</span>
</span><span id="estimatecvap2010-232"><a href="#estimatecvap2010-232"><span class="linenos">232</span></a><span class="sd">            more likely that the 2020 Census blocks fit neatly into the</span>
</span><span id="estimatecvap2010-233"><a href="#estimatecvap2010-233"><span class="linenos">233</span></a><span class="sd">            2010 Census tracts.</span>
</span><span id="estimatecvap2010-234"><a href="#estimatecvap2010-234"><span class="linenos">234</span></a>
</span><span id="estimatecvap2010-235"><a href="#estimatecvap2010-235"><span class="linenos">235</span></a><span class="sd">    Returns:</span>
</span><span id="estimatecvap2010-236"><a href="#estimatecvap2010-236"><span class="linenos">236</span></a><span class="sd">       `base` geometries with 2019 CVAP-weighted 2020 CVAP estimates attached.</span>
</span><span id="estimatecvap2010-237"><a href="#estimatecvap2010-237"><span class="linenos">237</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="estimatecvap2010-238"><a href="#estimatecvap2010-238"><span class="linenos">238</span></a>    <span class="k">if</span> <span class="n">geometry10</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;block group&quot;</span><span class="p">,</span> <span class="s2">&quot;tract&quot;</span><span class="p">}:</span>
</span><span id="estimatecvap2010-239"><a href="#estimatecvap2010-239"><span class="linenos">239</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested geometry &quot;</span><span class="si">{</span><span class="n">geometry10</span><span class="si">}</span><span class="s1">&quot; is not allowed; &#39;</span> <span class="s2">&quot;loading tracts.&quot;</span><span class="p">)</span>
</span><span id="estimatecvap2010-240"><a href="#estimatecvap2010-240"><span class="linenos">240</span></a>        <span class="n">geometry10</span> <span class="o">=</span> <span class="s2">&quot;tract&quot;</span>
</span><span id="estimatecvap2010-241"><a href="#estimatecvap2010-241"><span class="linenos">241</span></a>
</span><span id="estimatecvap2010-242"><a href="#estimatecvap2010-242"><span class="linenos">242</span></a>    <span class="c1"># Grab ACS and CVAP special-tab data, and make sure our triples are correct</span>
</span><span id="estimatecvap2010-243"><a href="#estimatecvap2010-243"><span class="linenos">243</span></a>    <span class="n">cvap_geoid</span> <span class="o">=</span> <span class="s2">&quot;TRACT10&quot;</span> <span class="k">if</span> <span class="n">geometry10</span> <span class="o">==</span> <span class="s2">&quot;tract&quot;</span> <span class="k">else</span> <span class="s2">&quot;BLOCKGROUP10&quot;</span>
</span><span id="estimatecvap2010-244"><a href="#estimatecvap2010-244"><span class="linenos">244</span></a>    <span class="n">acs_source</span> <span class="o">=</span> <span class="n">acs5</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">geometry10</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">)</span>
</span><span id="estimatecvap2010-245"><a href="#estimatecvap2010-245"><span class="linenos">245</span></a>    <span class="n">cvap_source</span> <span class="o">=</span> <span class="n">cvap</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">geometry10</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">)</span>
</span><span id="estimatecvap2010-246"><a href="#estimatecvap2010-246"><span class="linenos">246</span></a>
</span><span id="estimatecvap2010-247"><a href="#estimatecvap2010-247"><span class="linenos">247</span></a>    <span class="c1"># Validate the columns passed, issuing user warnings when it&#39;s inadvisable</span>
</span><span id="estimatecvap2010-248"><a href="#estimatecvap2010-248"><span class="linenos">248</span></a>    <span class="c1"># to estimate CVAP given the passed columns.</span>
</span><span id="estimatecvap2010-249"><a href="#estimatecvap2010-249"><span class="linenos">249</span></a>    <span class="k">for</span> <span class="n">cvap10</span><span class="p">,</span> <span class="n">vap10</span><span class="p">,</span> <span class="n">vap20</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
</span><span id="estimatecvap2010-250"><a href="#estimatecvap2010-250"><span class="linenos">250</span></a>        <span class="c1"># If any of the CVAP columns passed correspond to columns which</span>
</span><span id="estimatecvap2010-251"><a href="#estimatecvap2010-251"><span class="linenos">251</span></a>        <span class="c1"># tabulate people of multiple races, notify the user that there</span>
</span><span id="estimatecvap2010-252"><a href="#estimatecvap2010-252"><span class="linenos">252</span></a>        <span class="c1"># isn&#39;t an appropriate 2019 VAP column to match them against.</span>
</span><span id="estimatecvap2010-253"><a href="#estimatecvap2010-253"><span class="linenos">253</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">substring</span> <span class="ow">in</span> <span class="n">cvap10</span> <span class="k">for</span> <span class="n">substring</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;AIW&quot;</span><span class="p">,</span> <span class="s2">&quot;AW&quot;</span><span class="p">,</span> <span class="s2">&quot;BW&quot;</span><span class="p">,</span> <span class="s2">&quot;AIB&quot;</span><span class="p">}):</span>
</span><span id="estimatecvap2010-254"><a href="#estimatecvap2010-254"><span class="linenos">254</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="estimatecvap2010-255"><a href="#estimatecvap2010-255"><span class="linenos">255</span></a>                <span class="sa">f</span><span class="s2">&quot;Warning: Estimating CVAP among </span><span class="si">{</span><span class="n">cvap10</span><span class="si">}</span><span class="s2"> is not advisable, &quot;</span>
</span><span id="estimatecvap2010-256"><a href="#estimatecvap2010-256"><span class="linenos">256</span></a>                <span class="s2">&quot;since there isn&#39;t a reasonable VAP column from which to &quot;</span>
</span><span id="estimatecvap2010-257"><a href="#estimatecvap2010-257"><span class="linenos">257</span></a>                <span class="s2">&quot;construct _CVAP / _VAP rates (because you seem to be &quot;</span>
</span><span id="estimatecvap2010-258"><a href="#estimatecvap2010-258"><span class="linenos">258</span></a>                <span class="s2">&quot;combining two racial groups).&quot;</span>
</span><span id="estimatecvap2010-259"><a href="#estimatecvap2010-259"><span class="linenos">259</span></a>            <span class="p">)</span>
</span><span id="estimatecvap2010-260"><a href="#estimatecvap2010-260"><span class="linenos">260</span></a>
</span><span id="estimatecvap2010-261"><a href="#estimatecvap2010-261"><span class="linenos">261</span></a>        <span class="c1"># If the CVAP or ACS5 columns passed aren&#39;t present in the</span>
</span><span id="estimatecvap2010-262"><a href="#estimatecvap2010-262"><span class="linenos">262</span></a>        <span class="c1"># set of possible columns, raise an error.</span>
</span><span id="estimatecvap2010-263"><a href="#estimatecvap2010-263"><span class="linenos">263</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">cvap10</span> <span class="ow">in</span> <span class="n">acs_source</span> <span class="ow">or</span> <span class="n">cvap10</span> <span class="ow">in</span> <span class="n">cvap_source</span><span class="p">):</span>
</span><span id="estimatecvap2010-264"><a href="#estimatecvap2010-264"><span class="linenos">264</span></a>            <span class="n">possible_columns</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">acs_source</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">cvap_source</span><span class="p">))</span>
</span><span id="estimatecvap2010-265"><a href="#estimatecvap2010-265"><span class="linenos">265</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="estimatecvap2010-266"><a href="#estimatecvap2010-266"><span class="linenos">266</span></a>                <span class="sa">f</span><span class="s2">&quot;Your CVAP column &#39;</span><span class="si">{</span><span class="n">cvap10</span><span class="si">}</span><span class="s2">&#39; must be contained in either &quot;</span>
</span><span id="estimatecvap2010-267"><a href="#estimatecvap2010-267"><span class="linenos">267</span></a>                <span class="sa">f</span><span class="s2">&quot;the ACS or Special Tab columns: </span><span class="si">{</span><span class="n">possible_columns</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="estimatecvap2010-268"><a href="#estimatecvap2010-268"><span class="linenos">268</span></a>            <span class="p">)</span>
</span><span id="estimatecvap2010-269"><a href="#estimatecvap2010-269"><span class="linenos">269</span></a>
</span><span id="estimatecvap2010-270"><a href="#estimatecvap2010-270"><span class="linenos">270</span></a>        <span class="k">if</span> <span class="n">vap10</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">acs_source</span><span class="p">:</span>
</span><span id="estimatecvap2010-271"><a href="#estimatecvap2010-271"><span class="linenos">271</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="estimatecvap2010-272"><a href="#estimatecvap2010-272"><span class="linenos">272</span></a>                <span class="sa">f</span><span class="s2">&quot;Your old VAP column &#39;</span><span class="si">{</span><span class="n">vap10</span><span class="si">}</span><span class="s2">&#39; must be contained in the ACS &quot;</span>
</span><span id="estimatecvap2010-273"><a href="#estimatecvap2010-273"><span class="linenos">273</span></a>                <span class="s2">&quot;columns: {set(acs_source)}&quot;</span>
</span><span id="estimatecvap2010-274"><a href="#estimatecvap2010-274"><span class="linenos">274</span></a>            <span class="p">)</span>
</span><span id="estimatecvap2010-275"><a href="#estimatecvap2010-275"><span class="linenos">275</span></a>
</span><span id="estimatecvap2010-276"><a href="#estimatecvap2010-276"><span class="linenos">276</span></a>        <span class="c1"># If the VAP20 column passed doesn&#39;t exist on the user-provided</span>
</span><span id="estimatecvap2010-277"><a href="#estimatecvap2010-277"><span class="linenos">277</span></a>        <span class="c1"># geometries, raise an error.</span>
</span><span id="estimatecvap2010-278"><a href="#estimatecvap2010-278"><span class="linenos">278</span></a>        <span class="k">if</span> <span class="n">vap20</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base</span><span class="p">:</span>
</span><span id="estimatecvap2010-279"><a href="#estimatecvap2010-279"><span class="linenos">279</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="estimatecvap2010-280"><a href="#estimatecvap2010-280"><span class="linenos">280</span></a>                <span class="sa">f</span><span class="s2">&quot;Your new VAP column &#39;</span><span class="si">{</span><span class="n">vap20</span><span class="si">}</span><span class="s2">&#39; must be contained in your &quot;</span>
</span><span id="estimatecvap2010-281"><a href="#estimatecvap2010-281"><span class="linenos">281</span></a>                <span class="sa">f</span><span class="s2">&quot;base dataframe: </span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">base</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="estimatecvap2010-282"><a href="#estimatecvap2010-282"><span class="linenos">282</span></a>            <span class="p">)</span>
</span><span id="estimatecvap2010-283"><a href="#estimatecvap2010-283"><span class="linenos">283</span></a>
</span><span id="estimatecvap2010-284"><a href="#estimatecvap2010-284"><span class="linenos">284</span></a>    <span class="c1"># Remove ACS 5 columns that overlap with special-tab ones.</span>
</span><span id="estimatecvap2010-285"><a href="#estimatecvap2010-285"><span class="linenos">285</span></a>    <span class="n">non_overlaps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">acs_source</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">cvap_source</span><span class="p">)))</span>
</span><span id="estimatecvap2010-286"><a href="#estimatecvap2010-286"><span class="linenos">286</span></a>    <span class="n">acs_source</span> <span class="o">=</span> <span class="n">acs_source</span><span class="p">[[</span><span class="n">cvap_geoid</span><span class="p">]</span> <span class="o">+</span> <span class="n">non_overlaps</span><span class="p">]</span>
</span><span id="estimatecvap2010-287"><a href="#estimatecvap2010-287"><span class="linenos">287</span></a>    <span class="n">source</span> <span class="o">=</span> <span class="n">cvap_source</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">acs_source</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">cvap_geoid</span><span class="p">)</span>
</span><span id="estimatecvap2010-288"><a href="#estimatecvap2010-288"><span class="linenos">288</span></a>
</span><span id="estimatecvap2010-289"><a href="#estimatecvap2010-289"><span class="linenos">289</span></a>    <span class="c1"># Get the right columns from the base geometry, and map the base</span>
</span><span id="estimatecvap2010-290"><a href="#estimatecvap2010-290"><span class="linenos">290</span></a>    <span class="c1"># geometries to the units with CVAP data. Apparently dropping bad</span>
</span><span id="estimatecvap2010-291"><a href="#estimatecvap2010-291"><span class="linenos">291</span></a>    <span class="c1"># columns by using slicing incudes a SettingWithCopy warning, so</span>
</span><span id="estimatecvap2010-292"><a href="#estimatecvap2010-292"><span class="linenos">292</span></a>    <span class="c1"># we&#39;re just dropping using .drop() instead.</span>
</span><span id="estimatecvap2010-293"><a href="#estimatecvap2010-293"><span class="linenos">293</span></a>    <span class="n">correct</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
</span><span id="estimatecvap2010-294"><a href="#estimatecvap2010-294"><span class="linenos">294</span></a>        <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">base</span><span class="p">)</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">sub</span> <span class="ow">in</span> <span class="n">col</span> <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;POP&quot;</span><span class="p">,</span> <span class="s2">&quot;VAP&quot;</span><span class="p">,</span> <span class="s2">&quot;GEOID&quot;</span><span class="p">])</span>
</span><span id="estimatecvap2010-295"><a href="#estimatecvap2010-295"><span class="linenos">295</span></a>    <span class="p">]</span>
</span><span id="estimatecvap2010-296"><a href="#estimatecvap2010-296"><span class="linenos">296</span></a>    <span class="n">bads</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">base</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">correct</span><span class="p">))</span>
</span><span id="estimatecvap2010-297"><a href="#estimatecvap2010-297"><span class="linenos">297</span></a>
</span><span id="estimatecvap2010-298"><a href="#estimatecvap2010-298"><span class="linenos">298</span></a>    <span class="c1"># Warn the user of column removal:</span>
</span><span id="estimatecvap2010-299"><a href="#estimatecvap2010-299"><span class="linenos">299</span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removing the following columns: &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bads</span><span class="p">))</span>
</span><span id="estimatecvap2010-300"><a href="#estimatecvap2010-300"><span class="linenos">300</span></a>
</span><span id="estimatecvap2010-301"><a href="#estimatecvap2010-301"><span class="linenos">301</span></a>    <span class="n">pared</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">bads</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="estimatecvap2010-302"><a href="#estimatecvap2010-302"><span class="linenos">302</span></a>    <span class="n">pared</span> <span class="o">=</span> <span class="n">mapbase</span><span class="p">(</span><span class="n">pared</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">geometry10</span><span class="p">)</span>
</span><span id="estimatecvap2010-303"><a href="#estimatecvap2010-303"><span class="linenos">303</span></a>
</span><span id="estimatecvap2010-304"><a href="#estimatecvap2010-304"><span class="linenos">304</span></a>    <span class="c1"># Compute weights.</span>
</span><span id="estimatecvap2010-305"><a href="#estimatecvap2010-305"><span class="linenos">305</span></a>    <span class="k">for</span> <span class="n">cvap10</span><span class="p">,</span> <span class="n">vap10</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
</span><span id="estimatecvap2010-306"><a href="#estimatecvap2010-306"><span class="linenos">306</span></a>        <span class="n">source</span><span class="p">[</span><span class="n">cvap10</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="n">cvap10</span><span class="p">]</span> <span class="o">/</span> <span class="n">source</span><span class="p">[</span><span class="n">vap10</span><span class="p">]</span>
</span><span id="estimatecvap2010-307"><a href="#estimatecvap2010-307"><span class="linenos">307</span></a>
</span><span id="estimatecvap2010-308"><a href="#estimatecvap2010-308"><span class="linenos">308</span></a>    <span class="c1"># Fill in values according to the following rules:</span>
</span><span id="estimatecvap2010-309"><a href="#estimatecvap2010-309"><span class="linenos">309</span></a>    <span class="c1">#</span>
</span><span id="estimatecvap2010-310"><a href="#estimatecvap2010-310"><span class="linenos">310</span></a>    <span class="c1">#   1.  if there are 0 *CVAP reported and 0 *VAP reported, we set the</span>
</span><span id="estimatecvap2010-311"><a href="#estimatecvap2010-311"><span class="linenos">311</span></a>    <span class="c1">#        weight to the average *CVAP/*VAP ratio within the county;</span>
</span><span id="estimatecvap2010-312"><a href="#estimatecvap2010-312"><span class="linenos">312</span></a>    <span class="c1">#   2.  if there are 0 *CVAP reported and *VAP &gt; 0, we set the weight to</span>
</span><span id="estimatecvap2010-313"><a href="#estimatecvap2010-313"><span class="linenos">313</span></a>    <span class="c1">#        zero_fill;</span>
</span><span id="estimatecvap2010-314"><a href="#estimatecvap2010-314"><span class="linenos">314</span></a>    <span class="c1">#   3.  if *CVAP &gt; 0 but *VAP = 0 or *CVAP/*VAP &gt; percentage_cap, we set</span>
</span><span id="estimatecvap2010-315"><a href="#estimatecvap2010-315"><span class="linenos">315</span></a>    <span class="c1">#       the weight to 1.</span>
</span><span id="estimatecvap2010-316"><a href="#estimatecvap2010-316"><span class="linenos">316</span></a>    <span class="n">statewide</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="estimatecvap2010-317"><a href="#estimatecvap2010-317"><span class="linenos">317</span></a>        <span class="n">cvap</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span><span class="p">:</span> <span class="n">source</span><span class="p">[</span><span class="n">cvap</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">source</span><span class="p">[</span><span class="n">vap</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="estimatecvap2010-318"><a href="#estimatecvap2010-318"><span class="linenos">318</span></a>        <span class="k">if</span> <span class="n">source</span><span class="p">[</span><span class="n">vap</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="estimatecvap2010-319"><a href="#estimatecvap2010-319"><span class="linenos">319</span></a>        <span class="k">else</span> <span class="mi">0</span>
</span><span id="estimatecvap2010-320"><a href="#estimatecvap2010-320"><span class="linenos">320</span></a>        <span class="k">for</span> <span class="p">(</span><span class="n">cvap</span><span class="p">,</span> <span class="n">vap</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">groups</span>
</span><span id="estimatecvap2010-321"><a href="#estimatecvap2010-321"><span class="linenos">321</span></a>    <span class="p">}</span>
</span><span id="estimatecvap2010-322"><a href="#estimatecvap2010-322"><span class="linenos">322</span></a>
</span><span id="estimatecvap2010-323"><a href="#estimatecvap2010-323"><span class="linenos">323</span></a>    <span class="c1"># Rename colunms with percentages.</span>
</span><span id="estimatecvap2010-324"><a href="#estimatecvap2010-324"><span class="linenos">324</span></a>    <span class="n">cvappcts</span> <span class="o">=</span> <span class="p">[</span><span class="n">cvap</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span> <span class="k">for</span> <span class="p">(</span><span class="n">cvap</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>
</span><span id="estimatecvap2010-325"><a href="#estimatecvap2010-325"><span class="linenos">325</span></a>
</span><span id="estimatecvap2010-326"><a href="#estimatecvap2010-326"><span class="linenos">326</span></a>    <span class="c1"># Get the county names and compute population-weighted CVAP averages. This</span>
</span><span id="estimatecvap2010-327"><a href="#estimatecvap2010-327"><span class="linenos">327</span></a>    <span class="c1"># serves as a replacement for the statewide average.</span>
</span><span id="estimatecvap2010-328"><a href="#estimatecvap2010-328"><span class="linenos">328</span></a>    <span class="n">source</span><span class="p">[</span><span class="s2">&quot;_county&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="n">cvap_geoid</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</span><span id="estimatecvap2010-329"><a href="#estimatecvap2010-329"><span class="linenos">329</span></a>    <span class="n">counties</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;_county&quot;</span><span class="p">]))</span>
</span><span id="estimatecvap2010-330"><a href="#estimatecvap2010-330"><span class="linenos">330</span></a>    <span class="n">countyaverages</span> <span class="o">=</span> <span class="p">{</span><span class="n">pct</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">pct</span> <span class="ow">in</span> <span class="n">cvappcts</span><span class="p">}</span>
</span><span id="estimatecvap2010-331"><a href="#estimatecvap2010-331"><span class="linenos">331</span></a>
</span><span id="estimatecvap2010-332"><a href="#estimatecvap2010-332"><span class="linenos">332</span></a>    <span class="k">for</span> <span class="n">county</span> <span class="ow">in</span> <span class="n">counties</span><span class="p">:</span>
</span><span id="estimatecvap2010-333"><a href="#estimatecvap2010-333"><span class="linenos">333</span></a>        <span class="n">chunk</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;_county&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">county</span><span class="p">]</span>
</span><span id="estimatecvap2010-334"><a href="#estimatecvap2010-334"><span class="linenos">334</span></a>
</span><span id="estimatecvap2010-335"><a href="#estimatecvap2010-335"><span class="linenos">335</span></a>        <span class="k">for</span> <span class="n">cvap19</span><span class="p">,</span> <span class="n">vap19</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
</span><span id="estimatecvap2010-336"><a href="#estimatecvap2010-336"><span class="linenos">336</span></a>            <span class="c1"># Calculate the CVAP19-to-VAP19 ratio. Set numpy to ignore</span>
</span><span id="estimatecvap2010-337"><a href="#estimatecvap2010-337"><span class="linenos">337</span></a>            <span class="c1"># runtimewarnings, but warn the user if one is encountered.</span>
</span><span id="estimatecvap2010-338"><a href="#estimatecvap2010-338"><span class="linenos">338</span></a>            <span class="c1"># We do this so that the user doesn&#39;t get spooked by a numpy</span>
</span><span id="estimatecvap2010-339"><a href="#estimatecvap2010-339"><span class="linenos">339</span></a>            <span class="c1"># warning, but we&#39;re still noisy about the weird value</span>
</span><span id="estimatecvap2010-340"><a href="#estimatecvap2010-340"><span class="linenos">340</span></a>            <span class="c1"># encountered.</span>
</span><span id="estimatecvap2010-341"><a href="#estimatecvap2010-341"><span class="linenos">341</span></a>            <span class="n">cvap19total</span> <span class="o">=</span> <span class="n">chunk</span><span class="p">[</span><span class="n">cvap19</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="estimatecvap2010-342"><a href="#estimatecvap2010-342"><span class="linenos">342</span></a>            <span class="n">vap19total</span> <span class="o">=</span> <span class="n">chunk</span><span class="p">[</span><span class="n">vap19</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="estimatecvap2010-343"><a href="#estimatecvap2010-343"><span class="linenos">343</span></a>
</span><span id="estimatecvap2010-344"><a href="#estimatecvap2010-344"><span class="linenos">344</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</span><span id="estimatecvap2010-345"><a href="#estimatecvap2010-345"><span class="linenos">345</span></a>            <span class="n">ratio</span> <span class="o">=</span> <span class="n">cvap19total</span> <span class="o">/</span> <span class="n">vap19total</span>
</span><span id="estimatecvap2010-346"><a href="#estimatecvap2010-346"><span class="linenos">346</span></a>
</span><span id="estimatecvap2010-347"><a href="#estimatecvap2010-347"><span class="linenos">347</span></a>            <span class="c1"># Check whether the ratio of the above is less than the ceiling.</span>
</span><span id="estimatecvap2010-348"><a href="#estimatecvap2010-348"><span class="linenos">348</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">ratio</span><span class="p">):</span>
</span><span id="estimatecvap2010-349"><a href="#estimatecvap2010-349"><span class="linenos">349</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="estimatecvap2010-350"><a href="#estimatecvap2010-350"><span class="linenos">350</span></a>                    <span class="n">county</span><span class="p">,</span>
</span><span id="estimatecvap2010-351"><a href="#estimatecvap2010-351"><span class="linenos">351</span></a>                    <span class="sa">f</span><span class="s2">&quot;Encountered an invalid ratio: there are &quot;</span>
</span><span id="estimatecvap2010-352"><a href="#estimatecvap2010-352"><span class="linenos">352</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cvap19total</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">cvap19</span><span class="si">}</span><span class="s2"> persons and </span><span class="si">{</span><span class="n">vap19total</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="estimatecvap2010-353"><a href="#estimatecvap2010-353"><span class="linenos">353</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">vap19</span><span class="si">}</span><span class="s2"> persons, for a ratio of </span><span class="si">{</span><span class="n">cvap19total</span><span class="si">}</span><span class="s2">/&quot;</span>
</span><span id="estimatecvap2010-354"><a href="#estimatecvap2010-354"><span class="linenos">354</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">vap19total</span><span class="si">}</span><span class="s2">. @e have substituted it for the &quot;</span>
</span><span id="estimatecvap2010-355"><a href="#estimatecvap2010-355"><span class="linenos">355</span></a>                    <span class="sa">f</span><span class="s2">&quot;statewide </span><span class="si">{</span><span class="n">cvap19</span><span class="si">}</span><span class="s2">-to-</span><span class="si">{</span><span class="n">vap19</span><span class="si">}</span><span class="s2"> share of &quot;</span>
</span><span id="estimatecvap2010-356"><a href="#estimatecvap2010-356"><span class="linenos">356</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">statewide</span><span class="p">[</span><span class="n">cvap19</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="estimatecvap2010-357"><a href="#estimatecvap2010-357"><span class="linenos">357</span></a>                <span class="p">)</span>
</span><span id="estimatecvap2010-358"><a href="#estimatecvap2010-358"><span class="linenos">358</span></a>                <span class="n">ratio</span> <span class="o">=</span> <span class="n">statewide</span><span class="p">[</span><span class="n">cvap19</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span><span class="p">]</span>
</span><span id="estimatecvap2010-359"><a href="#estimatecvap2010-359"><span class="linenos">359</span></a>
</span><span id="estimatecvap2010-360"><a href="#estimatecvap2010-360"><span class="linenos">360</span></a>            <span class="c1"># Set the county-average ratio.</span>
</span><span id="estimatecvap2010-361"><a href="#estimatecvap2010-361"><span class="linenos">361</span></a>            <span class="n">countyaverages</span><span class="p">[</span><span class="n">cvap19</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span><span class="p">][</span><span class="n">county</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratio</span>
</span><span id="estimatecvap2010-362"><a href="#estimatecvap2010-362"><span class="linenos">362</span></a>
</span><span id="estimatecvap2010-363"><a href="#estimatecvap2010-363"><span class="linenos">363</span></a>    <span class="c1"># Reset the numpy error catching thing.</span>
</span><span id="estimatecvap2010-364"><a href="#estimatecvap2010-364"><span class="linenos">364</span></a>    <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="s2">&quot;warn&quot;</span><span class="p">)</span>
</span><span id="estimatecvap2010-365"><a href="#estimatecvap2010-365"><span class="linenos">365</span></a>
</span><span id="estimatecvap2010-366"><a href="#estimatecvap2010-366"><span class="linenos">366</span></a>    <span class="c1"># For each of the percentage columns, we want to apply the rules specified</span>
</span><span id="estimatecvap2010-367"><a href="#estimatecvap2010-367"><span class="linenos">367</span></a>    <span class="c1"># by the user.</span>
</span><span id="estimatecvap2010-368"><a href="#estimatecvap2010-368"><span class="linenos">368</span></a>    <span class="k">for</span> <span class="n">pct</span> <span class="ow">in</span> <span class="n">cvappcts</span><span class="p">:</span>
</span><span id="estimatecvap2010-369"><a href="#estimatecvap2010-369"><span class="linenos">369</span></a>        <span class="c1"># Fill NaNs with the *county-wide* average.</span>
</span><span id="estimatecvap2010-370"><a href="#estimatecvap2010-370"><span class="linenos">370</span></a>        <span class="n">countywidepcts</span> <span class="o">=</span> <span class="n">countyaverages</span><span class="p">[</span><span class="n">pct</span><span class="p">]</span>
</span><span id="estimatecvap2010-371"><a href="#estimatecvap2010-371"><span class="linenos">371</span></a>
</span><span id="estimatecvap2010-372"><a href="#estimatecvap2010-372"><span class="linenos">372</span></a>        <span class="n">source</span><span class="p">[</span><span class="n">pct</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="n">pct</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
</span><span id="estimatecvap2010-373"><a href="#estimatecvap2010-373"><span class="linenos">373</span></a>        <span class="n">nanindices</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="n">source</span><span class="p">[</span><span class="n">pct</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">index</span>
</span><span id="estimatecvap2010-374"><a href="#estimatecvap2010-374"><span class="linenos">374</span></a>        <span class="n">source</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nanindices</span><span class="p">,</span> <span class="n">pct</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nanindices</span><span class="p">,</span> <span class="s2">&quot;_county&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
</span><span id="estimatecvap2010-375"><a href="#estimatecvap2010-375"><span class="linenos">375</span></a>            <span class="n">countywidepcts</span>
</span><span id="estimatecvap2010-376"><a href="#estimatecvap2010-376"><span class="linenos">376</span></a>        <span class="p">)</span>
</span><span id="estimatecvap2010-377"><a href="#estimatecvap2010-377"><span class="linenos">377</span></a>
</span><span id="estimatecvap2010-378"><a href="#estimatecvap2010-378"><span class="linenos">378</span></a>        <span class="c1"># Fill zeroes with the `zfill` value, and cap all the percentages.</span>
</span><span id="estimatecvap2010-379"><a href="#estimatecvap2010-379"><span class="linenos">379</span></a>        <span class="n">source</span><span class="p">[</span><span class="n">pct</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="estimatecvap2010-380"><a href="#estimatecvap2010-380"><span class="linenos">380</span></a>            <span class="n">source</span><span class="p">[</span><span class="n">pct</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">zfill</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="n">ceiling</span> <span class="k">else</span> <span class="n">c</span><span class="p">)</span>
</span><span id="estimatecvap2010-381"><a href="#estimatecvap2010-381"><span class="linenos">381</span></a>        <span class="p">)</span>
</span><span id="estimatecvap2010-382"><a href="#estimatecvap2010-382"><span class="linenos">382</span></a>
</span><span id="estimatecvap2010-383"><a href="#estimatecvap2010-383"><span class="linenos">383</span></a>    <span class="c1"># Assert we don&#39;t have any percentages over percentage_cap.</span>
</span><span id="estimatecvap2010-384"><a href="#estimatecvap2010-384"><span class="linenos">384</span></a>    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="n">p</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">ceiling</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">)</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">)</span>
</span><span id="estimatecvap2010-385"><a href="#estimatecvap2010-385"><span class="linenos">385</span></a>
</span><span id="estimatecvap2010-386"><a href="#estimatecvap2010-386"><span class="linenos">386</span></a>    <span class="c1"># Assert we don&#39;t have any zeros.</span>
</span><span id="estimatecvap2010-387"><a href="#estimatecvap2010-387"><span class="linenos">387</span></a>    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="n">p</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">)</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">)</span>
</span><span id="estimatecvap2010-388"><a href="#estimatecvap2010-388"><span class="linenos">388</span></a>
</span><span id="estimatecvap2010-389"><a href="#estimatecvap2010-389"><span class="linenos">389</span></a>    <span class="c1"># Set indices and create a mapping from IDs to weights.</span>
</span><span id="estimatecvap2010-390"><a href="#estimatecvap2010-390"><span class="linenos">390</span></a>    <span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">cvap_geoid</span><span class="p">)</span>
</span><span id="estimatecvap2010-391"><a href="#estimatecvap2010-391"><span class="linenos">391</span></a>    <span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="n">cvappcts</span><span class="p">]</span>
</span><span id="estimatecvap2010-392"><a href="#estimatecvap2010-392"><span class="linenos">392</span></a>    <span class="n">weights</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
</span><span id="estimatecvap2010-393"><a href="#estimatecvap2010-393"><span class="linenos">393</span></a>
</span><span id="estimatecvap2010-394"><a href="#estimatecvap2010-394"><span class="linenos">394</span></a>    <span class="c1"># Group by the CVAP GEOID.</span>
</span><span id="estimatecvap2010-395"><a href="#estimatecvap2010-395"><span class="linenos">395</span></a>    <span class="n">groupedtogeometry</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pared</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">cvap_geoid</span><span class="p">))</span>
</span><span id="estimatecvap2010-396"><a href="#estimatecvap2010-396"><span class="linenos">396</span></a>
</span><span id="estimatecvap2010-397"><a href="#estimatecvap2010-397"><span class="linenos">397</span></a>    <span class="c1"># Get the year suffix so we can replace columns.</span>
</span><span id="estimatecvap2010-398"><a href="#estimatecvap2010-398"><span class="linenos">398</span></a>    <span class="n">yearsuffix</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
</span><span id="estimatecvap2010-399"><a href="#estimatecvap2010-399"><span class="linenos">399</span></a>
</span><span id="estimatecvap2010-400"><a href="#estimatecvap2010-400"><span class="linenos">400</span></a>    <span class="c1"># For each of the geometry groups (e.g. a set of rows of blocks</span>
</span><span id="estimatecvap2010-401"><a href="#estimatecvap2010-401"><span class="linenos">401</span></a>    <span class="c1"># corresponding to a single tract), and for each of the CVAP groups,</span>
</span><span id="estimatecvap2010-402"><a href="#estimatecvap2010-402"><span class="linenos">402</span></a>    <span class="c1"># apply the appropriate weight to the blocks&#39; 2020 VAP populations.</span>
</span><span id="estimatecvap2010-403"><a href="#estimatecvap2010-403"><span class="linenos">403</span></a>    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groupedtogeometry</span><span class="p">:</span>
</span><span id="estimatecvap2010-404"><a href="#estimatecvap2010-404"><span class="linenos">404</span></a>        <span class="k">for</span> <span class="n">cvap10</span><span class="p">,</span> <span class="n">vap10</span><span class="p">,</span> <span class="n">vap20</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
</span><span id="estimatecvap2010-405"><a href="#estimatecvap2010-405"><span class="linenos">405</span></a>            <span class="n">weight</span> <span class="o">=</span> <span class="n">cvap10</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span>
</span><span id="estimatecvap2010-406"><a href="#estimatecvap2010-406"><span class="linenos">406</span></a>            <span class="n">cvap20</span> <span class="o">=</span> <span class="n">cvap10</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">yearsuffix</span><span class="p">,</span> <span class="s2">&quot;20_EST&quot;</span><span class="p">)</span>
</span><span id="estimatecvap2010-407"><a href="#estimatecvap2010-407"><span class="linenos">407</span></a>            <span class="n">group</span><span class="p">[</span><span class="n">weight</span><span class="p">]</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">ix</span><span class="p">][</span><span class="n">weight</span><span class="p">]</span>
</span><span id="estimatecvap2010-408"><a href="#estimatecvap2010-408"><span class="linenos">408</span></a>            <span class="n">group</span><span class="p">[</span><span class="n">cvap20</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">weight</span><span class="p">]</span> <span class="o">*</span> <span class="n">group</span><span class="p">[</span><span class="n">vap20</span><span class="p">]</span>
</span><span id="estimatecvap2010-409"><a href="#estimatecvap2010-409"><span class="linenos">409</span></a>
</span><span id="estimatecvap2010-410"><a href="#estimatecvap2010-410"><span class="linenos">410</span></a>    <span class="c1"># Re-create a dataframe and strip out % columns, leaving only the estimate</span>
</span><span id="estimatecvap2010-411"><a href="#estimatecvap2010-411"><span class="linenos">411</span></a>    <span class="c1"># columns.</span>
</span><span id="estimatecvap2010-412"><a href="#estimatecvap2010-412"><span class="linenos">412</span></a>    <span class="n">weightedbase</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">frame</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">groupedtogeometry</span><span class="p">)</span>
</span><span id="estimatecvap2010-413"><a href="#estimatecvap2010-413"><span class="linenos">413</span></a>    <span class="n">weightedbase</span> <span class="o">=</span> <span class="n">weightedbase</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">p</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span> <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">])</span>
</span><span id="estimatecvap2010-414"><a href="#estimatecvap2010-414"><span class="linenos">414</span></a>    <span class="k">return</span> <span class="n">weightedbase</span>
</span></pre></div>


            <div class="docstring"><p>Function for turning old (2019) CVAP data on 2010 geometries into
estimates for current CVAP data on 2020 geometries. <strong>This method
serves a different purpose than <code>gerrytools.data.estimatecvap.
estimatecvap2020()</code>:</strong> this method is intended to put 2010-era CVAP
data on 2020-era geometries, and uses geometric properties to do so.</p>

<p>Users must supply a base <code>GeoDataFrame</code>
representing their chosen U.S. state. Additionally, users must specify the
demographic groups whose CVAP statistics are to be estimated. For each
group, users specify a triple ((X, Y, Z)) where (X) is the old CVAP
column for that group, (Y) is the old VAP column for that group, and
(Z) is the new VAP column for that group, which must be an existing
column on <code>base</code>. Then, the estimated new CVAP for that group will be
constructed by multiplying ((X / Y) \cdot Z) for each new geometry.</p>

<div style="text-align: center;">
    </br>
    <img width="75%" src="../images/cvap-estimation.png"/>
</div>

<p>Args:
    base (GeoDataFrame): A <code>GeoDataFrame</code> with the appropriate columns for
        estimating CVAP.
    state (State): The <code>us.State</code> object for which CVAP data is retrieved.
    groups (list): <code>(X, Y, Z)</code> triples for each desired CVAP group to be
        estimated, where each of the parameters are column names: <code>X</code> is
        the column on the 2010 geometries which contains the relevant CVAP
        data; <code>Y</code> is the column on the 2010 geometries which contains the
        relevant VAP data; <code>Z</code> is the column on the 2020 geometries to be
        weighted by the ratio of the per-unit ratios in <code>X</code> and <code>Y</code>. For
        example, if we wish to estimate Black CVAP, this triple would be
        <code>(NHBCVAP19, BVAP19, BVAP20)</code>, which takes the ratios of the
        <code>NHBCVAP19</code> and <code>BVAP19</code> columns on the 2010 geometries, and
        multplies the 2020 geometries' respective <code>BVAP20</code> values
        by these ratios.
    ceiling (float): Number representing where to cap the weighting
        ratio of CVAP to VAP20. After this percentage ceiling is
        passed, the percentage will be set to 1. We recommend
        setting this to 1.
    zfill (float): Fill in ratio for CVAP to VAP20 when there is 0 CVAP
        in the area. We recommend setting this parameter to <code>0.1</code>.
    geometry10 (str, optional): The 2010 geometry on which cvap will
        be pulled. Acceptable values are <code>"tract"</code> or <code>"block group"</code>.
        As tracts are less susceptible to change across Census vintages,
        setting this parameter to <code>"tract"</code> is recommended, as it is
        more likely that the 2020 Census blocks fit neatly into the
        2010 Census tracts.</p>

<p>Returns:
   <code>base</code> geometries with 2019 CVAP-weighted 2020 CVAP estimates attached.</p>
</div>


                </section>
                <section id="estimatecvap2020">
                            <input id="estimatecvap2020-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">estimatecvap2020</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">state</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="estimatecvap2020-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#estimatecvap2020"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="estimatecvap2020-12"><a href="#estimatecvap2020-12"><span class="linenos"> 12</span></a><span class="k">def</span> <span class="nf">estimatecvap2020</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="estimatecvap2020-13"><a href="#estimatecvap2020-13"><span class="linenos"> 13</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="estimatecvap2020-14"><a href="#estimatecvap2020-14"><span class="linenos"> 14</span></a><span class="sd">    Estimates 2020 CVAP on 2020 blocks using 2020 PL94 data. **This method</span>
</span><span id="estimatecvap2020-15"><a href="#estimatecvap2020-15"><span class="linenos"> 15</span></a><span class="sd">    serves a different purpose than `gerrytools.data.estimatecvap.</span>
</span><span id="estimatecvap2020-16"><a href="#estimatecvap2020-16"><span class="linenos"> 16</span></a><span class="sd">    estimatecvap2010()`:** rather than using geometric procedures to</span>
</span><span id="estimatecvap2020-17"><a href="#estimatecvap2020-17"><span class="linenos"> 17</span></a><span class="sd">    put CVAP data on old geometries, this method takes advantage of the</span>
</span><span id="estimatecvap2020-18"><a href="#estimatecvap2020-18"><span class="linenos"> 18</span></a><span class="sd">    Census&#39;s geographic hierarchy, and associates finer-grained 2020 CVAP</span>
</span><span id="estimatecvap2020-19"><a href="#estimatecvap2020-19"><span class="linenos"> 19</span></a><span class="sd">    data with 2020 blocks. _No geometric data or procedures are used here_.</span>
</span><span id="estimatecvap2020-20"><a href="#estimatecvap2020-20"><span class="linenos"> 20</span></a><span class="sd">    The resulting data can then be adjoined to 2020 block geometries (or</span>
</span><span id="estimatecvap2020-21"><a href="#estimatecvap2020-21"><span class="linenos"> 21</span></a><span class="sd">    assigned to VTDs, assigned to districts, etc.) and be used to build</span>
</span><span id="estimatecvap2020-22"><a href="#estimatecvap2020-22"><span class="linenos"> 22</span></a><span class="sd">    other units of varying size.</span>
</span><span id="estimatecvap2020-23"><a href="#estimatecvap2020-23"><span class="linenos"> 23</span></a>
</span><span id="estimatecvap2020-24"><a href="#estimatecvap2020-24"><span class="linenos"> 24</span></a><span class="sd">    Args:</span>
</span><span id="estimatecvap2020-25"><a href="#estimatecvap2020-25"><span class="linenos"> 25</span></a><span class="sd">        state (State): The `us.State` for which CVAP will be estimated.</span>
</span><span id="estimatecvap2020-26"><a href="#estimatecvap2020-26"><span class="linenos"> 26</span></a>
</span><span id="estimatecvap2020-27"><a href="#estimatecvap2020-27"><span class="linenos"> 27</span></a><span class="sd">    Returns:</span>
</span><span id="estimatecvap2020-28"><a href="#estimatecvap2020-28"><span class="linenos"> 28</span></a><span class="sd">        A `DataFrame` of combined Census and ACS data at the Census</span>
</span><span id="estimatecvap2020-29"><a href="#estimatecvap2020-29"><span class="linenos"> 29</span></a><span class="sd">        block level.</span>
</span><span id="estimatecvap2020-30"><a href="#estimatecvap2020-30"><span class="linenos"> 30</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="estimatecvap2020-31"><a href="#estimatecvap2020-31"><span class="linenos"> 31</span></a>
</span><span id="estimatecvap2020-32"><a href="#estimatecvap2020-32"><span class="linenos"> 32</span></a>    <span class="c1"># First, get the Census data for blocks and block groups.</span>
</span><span id="estimatecvap2020-33"><a href="#estimatecvap2020-33"><span class="linenos"> 33</span></a>    <span class="n">bg</span> <span class="o">=</span> <span class="n">census20</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="s2">&quot;P4&quot;</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;block group&quot;</span><span class="p">)</span>
</span><span id="estimatecvap2020-34"><a href="#estimatecvap2020-34"><span class="linenos"> 34</span></a>    <span class="n">block</span> <span class="o">=</span> <span class="n">census20</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="s2">&quot;P4&quot;</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;block&quot;</span><span class="p">)</span>
</span><span id="estimatecvap2020-35"><a href="#estimatecvap2020-35"><span class="linenos"> 35</span></a>
</span><span id="estimatecvap2020-36"><a href="#estimatecvap2020-36"><span class="linenos"> 36</span></a>    <span class="c1"># Now, get 2020 Census data at the block group level and merging it</span>
</span><span id="estimatecvap2020-37"><a href="#estimatecvap2020-37"><span class="linenos"> 37</span></a>    <span class="c1"># with the block group-level Census data.</span>
</span><span id="estimatecvap2020-38"><a href="#estimatecvap2020-38"><span class="linenos"> 38</span></a>    <span class="n">cvap20</span> <span class="o">=</span> <span class="n">cvap</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;block group&quot;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="mi">2020</span><span class="p">)</span>
</span><span id="estimatecvap2020-39"><a href="#estimatecvap2020-39"><span class="linenos"> 39</span></a>    <span class="n">bg</span> <span class="o">=</span> <span class="n">bg</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">cvap20</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;GEOID20&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;BLOCKGROUP20&quot;</span><span class="p">)</span>
</span><span id="estimatecvap2020-40"><a href="#estimatecvap2020-40"><span class="linenos"> 40</span></a>
</span><span id="estimatecvap2020-41"><a href="#estimatecvap2020-41"><span class="linenos"> 41</span></a>    <span class="c1"># Name the VAP columns.</span>
</span><span id="estimatecvap2020-42"><a href="#estimatecvap2020-42"><span class="linenos"> 42</span></a>    <span class="n">vapcolumns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="estimatecvap2020-43"><a href="#estimatecvap2020-43"><span class="linenos"> 43</span></a>        <span class="s2">&quot;NHWHITEVAP20&quot;</span><span class="p">,</span>
</span><span id="estimatecvap2020-44"><a href="#estimatecvap2020-44"><span class="linenos"> 44</span></a>        <span class="s2">&quot;NHASIANVAP20&quot;</span><span class="p">,</span>
</span><span id="estimatecvap2020-45"><a href="#estimatecvap2020-45"><span class="linenos"> 45</span></a>        <span class="s2">&quot;NHBLACKVAP20&quot;</span><span class="p">,</span>
</span><span id="estimatecvap2020-46"><a href="#estimatecvap2020-46"><span class="linenos"> 46</span></a>        <span class="s2">&quot;NHNHPIVAP20&quot;</span><span class="p">,</span>
</span><span id="estimatecvap2020-47"><a href="#estimatecvap2020-47"><span class="linenos"> 47</span></a>        <span class="s2">&quot;NHAMINVAP20&quot;</span><span class="p">,</span>
</span><span id="estimatecvap2020-48"><a href="#estimatecvap2020-48"><span class="linenos"> 48</span></a>        <span class="s2">&quot;NHWHITEASIANVAP20&quot;</span><span class="p">,</span>
</span><span id="estimatecvap2020-49"><a href="#estimatecvap2020-49"><span class="linenos"> 49</span></a>        <span class="s2">&quot;NHWHITEAMINVAP20&quot;</span><span class="p">,</span>
</span><span id="estimatecvap2020-50"><a href="#estimatecvap2020-50"><span class="linenos"> 50</span></a>        <span class="s2">&quot;NHWHITEBLACKVAP20&quot;</span><span class="p">,</span>
</span><span id="estimatecvap2020-51"><a href="#estimatecvap2020-51"><span class="linenos"> 51</span></a>        <span class="s2">&quot;NHBLACKAMINVAP20&quot;</span><span class="p">,</span>
</span><span id="estimatecvap2020-52"><a href="#estimatecvap2020-52"><span class="linenos"> 52</span></a>    <span class="p">]</span>
</span><span id="estimatecvap2020-53"><a href="#estimatecvap2020-53"><span class="linenos"> 53</span></a>
</span><span id="estimatecvap2020-54"><a href="#estimatecvap2020-54"><span class="linenos"> 54</span></a>    <span class="c1"># Create &quot;remainder&quot; column.</span>
</span><span id="estimatecvap2020-55"><a href="#estimatecvap2020-55"><span class="linenos"> 55</span></a>    <span class="k">for</span> <span class="n">universe</span> <span class="ow">in</span> <span class="p">[</span><span class="n">block</span><span class="p">,</span> <span class="n">bg</span><span class="p">]:</span>
</span><span id="estimatecvap2020-56"><a href="#estimatecvap2020-56"><span class="linenos"> 56</span></a>        <span class="n">universe</span><span class="p">[</span><span class="s2">&quot;NHVAP20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">universe</span><span class="p">[</span><span class="s2">&quot;VAP20&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">universe</span><span class="p">[</span><span class="s2">&quot;HVAP20&quot;</span><span class="p">]</span>
</span><span id="estimatecvap2020-57"><a href="#estimatecvap2020-57"><span class="linenos"> 57</span></a>        <span class="n">universe</span><span class="p">[</span><span class="s2">&quot;OTHVAP20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">universe</span><span class="p">[</span><span class="s2">&quot;NHVAP20&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">universe</span><span class="p">[</span><span class="n">vapcolumns</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="estimatecvap2020-58"><a href="#estimatecvap2020-58"><span class="linenos"> 58</span></a>
</span><span id="estimatecvap2020-59"><a href="#estimatecvap2020-59"><span class="linenos"> 59</span></a>    <span class="c1"># Get the block group ID for blocks.</span>
</span><span id="estimatecvap2020-60"><a href="#estimatecvap2020-60"><span class="linenos"> 60</span></a>    <span class="n">block</span><span class="p">[</span><span class="s2">&quot;BLOCKGROUP20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="s2">&quot;GEOID20&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
</span><span id="estimatecvap2020-61"><a href="#estimatecvap2020-61"><span class="linenos"> 61</span></a>
</span><span id="estimatecvap2020-62"><a href="#estimatecvap2020-62"><span class="linenos"> 62</span></a>    <span class="c1"># Mapping from block group IDs to block group total populations.</span>
</span><span id="estimatecvap2020-63"><a href="#estimatecvap2020-63"><span class="linenos"> 63</span></a>    <span class="n">bgtotalvapmap</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">bg</span><span class="p">[</span><span class="s2">&quot;BLOCKGROUP20&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">bg</span><span class="p">[</span><span class="s2">&quot;VAP20&quot;</span><span class="p">]))</span>
</span><span id="estimatecvap2020-64"><a href="#estimatecvap2020-64"><span class="linenos"> 64</span></a>
</span><span id="estimatecvap2020-65"><a href="#estimatecvap2020-65"><span class="linenos"> 65</span></a>    <span class="c1"># Add all columns.</span>
</span><span id="estimatecvap2020-66"><a href="#estimatecvap2020-66"><span class="linenos"> 66</span></a>    <span class="n">allvapcols</span> <span class="o">=</span> <span class="n">vapcolumns</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;VAP20&quot;</span><span class="p">,</span> <span class="s2">&quot;NHVAP20&quot;</span><span class="p">,</span> <span class="s2">&quot;HVAP20&quot;</span><span class="p">,</span> <span class="s2">&quot;NHOTHVAP20&quot;</span><span class="p">]</span>
</span><span id="estimatecvap2020-67"><a href="#estimatecvap2020-67"><span class="linenos"> 67</span></a>
</span><span id="estimatecvap2020-68"><a href="#estimatecvap2020-68"><span class="linenos"> 68</span></a>    <span class="c1"># Estimate CVAP data for all VAP columns.</span>
</span><span id="estimatecvap2020-69"><a href="#estimatecvap2020-69"><span class="linenos"> 69</span></a>    <span class="k">for</span> <span class="n">vapcolumn</span> <span class="ow">in</span> <span class="n">allvapcols</span><span class="p">:</span>
</span><span id="estimatecvap2020-70"><a href="#estimatecvap2020-70"><span class="linenos"> 70</span></a>        <span class="c1"># Crete a mapping from block group names to totals for the VAP column.</span>
</span><span id="estimatecvap2020-71"><a href="#estimatecvap2020-71"><span class="linenos"> 71</span></a>        <span class="n">popmap</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">bg</span><span class="p">[</span><span class="s2">&quot;GEOID20&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">bg</span><span class="p">[</span><span class="n">vapcolumn</span><span class="p">]))</span>
</span><span id="estimatecvap2020-72"><a href="#estimatecvap2020-72"><span class="linenos"> 72</span></a>
</span><span id="estimatecvap2020-73"><a href="#estimatecvap2020-73"><span class="linenos"> 73</span></a>        <span class="c1"># Create column names.</span>
</span><span id="estimatecvap2020-74"><a href="#estimatecvap2020-74"><span class="linenos"> 74</span></a>        <span class="n">colpct</span> <span class="o">=</span> <span class="n">vapcolumn</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span>
</span><span id="estimatecvap2020-75"><a href="#estimatecvap2020-75"><span class="linenos"> 75</span></a>        <span class="n">cvapcolumn</span> <span class="o">=</span> <span class="n">vapcolumn</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;VAP&quot;</span><span class="p">,</span> <span class="s2">&quot;CVAP&quot;</span><span class="p">)</span>
</span><span id="estimatecvap2020-76"><a href="#estimatecvap2020-76"><span class="linenos"> 76</span></a>
</span><span id="estimatecvap2020-77"><a href="#estimatecvap2020-77"><span class="linenos"> 77</span></a>        <span class="c1"># Calculate ratios.</span>
</span><span id="estimatecvap2020-78"><a href="#estimatecvap2020-78"><span class="linenos"> 78</span></a>        <span class="n">block</span><span class="p">[</span><span class="n">colpct</span><span class="p">]</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="s2">&quot;BLOCKGROUP20&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">popmap</span><span class="p">)</span>
</span><span id="estimatecvap2020-79"><a href="#estimatecvap2020-79"><span class="linenos"> 79</span></a>        <span class="n">block</span><span class="p">[</span><span class="n">colpct</span><span class="p">]</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="n">vapcolumn</span><span class="p">]</span> <span class="o">/</span> <span class="n">block</span><span class="p">[</span><span class="n">colpct</span><span class="p">]</span>
</span><span id="estimatecvap2020-80"><a href="#estimatecvap2020-80"><span class="linenos"> 80</span></a>
</span><span id="estimatecvap2020-81"><a href="#estimatecvap2020-81"><span class="linenos"> 81</span></a>        <span class="c1"># Create a mapping from block group IDs to CVAP groups.</span>
</span><span id="estimatecvap2020-82"><a href="#estimatecvap2020-82"><span class="linenos"> 82</span></a>        <span class="n">cvapcolumn</span> <span class="o">=</span> <span class="n">vapcolumn</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;VAP&quot;</span><span class="p">,</span> <span class="s2">&quot;CVAP&quot;</span><span class="p">)</span>
</span><span id="estimatecvap2020-83"><a href="#estimatecvap2020-83"><span class="linenos"> 83</span></a>        <span class="n">cvapmap</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">bg</span><span class="p">[</span><span class="s2">&quot;BLOCKGROUP20&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">bg</span><span class="p">[</span><span class="n">cvapcolumn</span><span class="p">]))</span>
</span><span id="estimatecvap2020-84"><a href="#estimatecvap2020-84"><span class="linenos"> 84</span></a>
</span><span id="estimatecvap2020-85"><a href="#estimatecvap2020-85"><span class="linenos"> 85</span></a>        <span class="c1"># Create two temporary columns: the first sets the block&#39;s CVAP to the</span>
</span><span id="estimatecvap2020-86"><a href="#estimatecvap2020-86"><span class="linenos"> 86</span></a>        <span class="c1"># total CVAP for its block group; the second sets the block&#39;s VAP</span>
</span><span id="estimatecvap2020-87"><a href="#estimatecvap2020-87"><span class="linenos"> 87</span></a>        <span class="c1"># to the total VAP for its block group. (Note: each of these C/VAP</span>
</span><span id="estimatecvap2020-88"><a href="#estimatecvap2020-88"><span class="linenos"> 88</span></a>        <span class="c1"># columns are with respect to the current VAP column.)</span>
</span><span id="estimatecvap2020-89"><a href="#estimatecvap2020-89"><span class="linenos"> 89</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;tmp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="s2">&quot;BLOCKGROUP20&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">cvapmap</span><span class="p">)</span>
</span><span id="estimatecvap2020-90"><a href="#estimatecvap2020-90"><span class="linenos"> 90</span></a>        <span class="n">block</span><span class="p">[</span><span class="s2">&quot;BGVAP20&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="s2">&quot;BLOCKGROUP20&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">bgtotalvapmap</span><span class="p">)</span>
</span><span id="estimatecvap2020-91"><a href="#estimatecvap2020-91"><span class="linenos"> 91</span></a>
</span><span id="estimatecvap2020-92"><a href="#estimatecvap2020-92"><span class="linenos"> 92</span></a>        <span class="c1"># Next, compute the estimated CVAP by multiplying the VAP column</span>
</span><span id="estimatecvap2020-93"><a href="#estimatecvap2020-93"><span class="linenos"> 93</span></a>        <span class="c1"># percent for the block group by the total CVAP population of the</span>
</span><span id="estimatecvap2020-94"><a href="#estimatecvap2020-94"><span class="linenos"> 94</span></a>        <span class="c1"># block group.</span>
</span><span id="estimatecvap2020-95"><a href="#estimatecvap2020-95"><span class="linenos"> 95</span></a>        <span class="n">block</span><span class="p">[</span><span class="n">cvapcolumn</span><span class="p">]</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="n">colpct</span><span class="p">]</span> <span class="o">*</span> <span class="n">block</span><span class="p">[</span><span class="s2">&quot;tmp&quot;</span><span class="p">]</span>
</span><span id="estimatecvap2020-96"><a href="#estimatecvap2020-96"><span class="linenos"> 96</span></a>
</span><span id="estimatecvap2020-97"><a href="#estimatecvap2020-97"><span class="linenos"> 97</span></a>        <span class="c1"># If the above doesn&#39;t work which is the case if the VAP column</span>
</span><span id="estimatecvap2020-98"><a href="#estimatecvap2020-98"><span class="linenos"> 98</span></a>        <span class="c1"># percent is NaN (0/0) or inf (k/0), we estimate the CVAP of the</span>
</span><span id="estimatecvap2020-99"><a href="#estimatecvap2020-99"><span class="linenos"> 99</span></a>        <span class="c1"># block using the VAP ratio outright rather than the column-specific</span>
</span><span id="estimatecvap2020-100"><a href="#estimatecvap2020-100"><span class="linenos">100</span></a>        <span class="c1"># VAP ratio.</span>
</span><span id="estimatecvap2020-101"><a href="#estimatecvap2020-101"><span class="linenos">101</span></a>        <span class="n">ni</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="n">block</span><span class="p">[</span><span class="n">colpct</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">index</span>
</span><span id="estimatecvap2020-102"><a href="#estimatecvap2020-102"><span class="linenos">102</span></a>        <span class="n">block</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ni</span><span class="p">,</span> <span class="n">cvapcolumn</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="estimatecvap2020-103"><a href="#estimatecvap2020-103"><span class="linenos">103</span></a>            <span class="n">block</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ni</span><span class="p">,</span> <span class="s2">&quot;VAP20&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">block</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ni</span><span class="p">,</span> <span class="s2">&quot;BGVAP20&quot;</span><span class="p">]</span>
</span><span id="estimatecvap2020-104"><a href="#estimatecvap2020-104"><span class="linenos">104</span></a>        <span class="p">)</span> <span class="o">*</span> <span class="n">block</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ni</span><span class="p">,</span> <span class="s2">&quot;tmp&quot;</span><span class="p">]</span>
</span><span id="estimatecvap2020-105"><a href="#estimatecvap2020-105"><span class="linenos">105</span></a>
</span><span id="estimatecvap2020-106"><a href="#estimatecvap2020-106"><span class="linenos">106</span></a>        <span class="c1"># Assert that our summed disaggregated numbers and totals are close!</span>
</span><span id="estimatecvap2020-107"><a href="#estimatecvap2020-107"><span class="linenos">107</span></a>        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">bg</span><span class="p">[</span><span class="n">cvapcolumn</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="n">block</span><span class="p">[</span><span class="n">cvapcolumn</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="estimatecvap2020-108"><a href="#estimatecvap2020-108"><span class="linenos">108</span></a>
</span><span id="estimatecvap2020-109"><a href="#estimatecvap2020-109"><span class="linenos">109</span></a>    <span class="c1"># Fill NaNs with 0 and drop unnecessary columns.</span>
</span><span id="estimatecvap2020-110"><a href="#estimatecvap2020-110"><span class="linenos">110</span></a>    <span class="n">block</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="estimatecvap2020-111"><a href="#estimatecvap2020-111"><span class="linenos">111</span></a>    <span class="n">block</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;tmp&quot;</span><span class="p">,</span> <span class="s2">&quot;BGVAP20&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="estimatecvap2020-112"><a href="#estimatecvap2020-112"><span class="linenos">112</span></a>
</span><span id="estimatecvap2020-113"><a href="#estimatecvap2020-113"><span class="linenos">113</span></a>    <span class="c1"># Return!</span>
</span><span id="estimatecvap2020-114"><a href="#estimatecvap2020-114"><span class="linenos">114</span></a>    <span class="k">return</span> <span class="n">block</span>
</span></pre></div>


            <div class="docstring"><p>Estimates 2020 CVAP on 2020 blocks using 2020 PL94 data. <strong>This method
serves a different purpose than <code>gerrytools.data.estimatecvap.
estimatecvap2010()</code>:</strong> rather than using geometric procedures to
put CVAP data on old geometries, this method takes advantage of the
Census's geographic hierarchy, and associates finer-grained 2020 CVAP
data with 2020 blocks. _No geometric data or procedures are used here_.
The resulting data can then be adjoined to 2020 block geometries (or
assigned to VTDs, assigned to districts, etc.) and be used to build
other units of varying size.</p>

<p>Args:
    state (State): The <code>us.State</code> for which CVAP will be estimated.</p>

<p>Returns:
    A <code>DataFrame</code> of combined Census and ACS data at the Census
    block level.</p>
</div>


                </section>
                <section id="fetchgeometries">
                            <input id="fetchgeometries-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fetchgeometries</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">state</span>, </span><span class="param"><span class="n">geometry</span></span><span class="return-annotation">) -> <span class="n">geopandas</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span>:</span></span>

                <label class="view-source-button" for="fetchgeometries-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#fetchgeometries"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="fetchgeometries-117"><a href="#fetchgeometries-117"><span class="linenos">117</span></a><span class="k">def</span> <span class="nf">fetchgeometries</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">geometry</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
</span><span id="fetchgeometries-118"><a href="#fetchgeometries-118"><span class="linenos">118</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="fetchgeometries-119"><a href="#fetchgeometries-119"><span class="linenos">119</span></a><span class="sd">    Fetches the 2010 Census geometries on which ACS data are reported.</span>
</span><span id="fetchgeometries-120"><a href="#fetchgeometries-120"><span class="linenos">120</span></a>
</span><span id="fetchgeometries-121"><a href="#fetchgeometries-121"><span class="linenos">121</span></a><span class="sd">    Args:</span>
</span><span id="fetchgeometries-122"><a href="#fetchgeometries-122"><span class="linenos">122</span></a><span class="sd">        state (State): The `us.State` for which CVAP will be estimated.</span>
</span><span id="fetchgeometries-123"><a href="#fetchgeometries-123"><span class="linenos">123</span></a><span class="sd">        geometry10 (str): Level of geometry we&#39;re fetching. Accepted values are</span>
</span><span id="fetchgeometries-124"><a href="#fetchgeometries-124"><span class="linenos">124</span></a><span class="sd">            `&quot;tract&quot;` and `&quot;block group&quot;`.</span>
</span><span id="fetchgeometries-125"><a href="#fetchgeometries-125"><span class="linenos">125</span></a>
</span><span id="fetchgeometries-126"><a href="#fetchgeometries-126"><span class="linenos">126</span></a><span class="sd">    Returns:</span>
</span><span id="fetchgeometries-127"><a href="#fetchgeometries-127"><span class="linenos">127</span></a><span class="sd">        A `GeoDataFrame` of 2010 geometries.</span>
</span><span id="fetchgeometries-128"><a href="#fetchgeometries-128"><span class="linenos">128</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="fetchgeometries-129"><a href="#fetchgeometries-129"><span class="linenos">129</span></a>    <span class="c1"># Get a Census locator for the provided State by replacing spaces in its</span>
</span><span id="fetchgeometries-130"><a href="#fetchgeometries-130"><span class="linenos">130</span></a>    <span class="c1"># name with underscores (should they exist).</span>
</span><span id="fetchgeometries-131"><a href="#fetchgeometries-131"><span class="linenos">131</span></a>    <span class="n">clocator</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="fetchgeometries-132"><a href="#fetchgeometries-132"><span class="linenos">132</span></a>
</span><span id="fetchgeometries-133"><a href="#fetchgeometries-133"><span class="linenos">133</span></a>    <span class="c1"># Validate geometry level indicators.</span>
</span><span id="fetchgeometries-134"><a href="#fetchgeometries-134"><span class="linenos">134</span></a>    <span class="k">if</span> <span class="n">geometry</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;block group&quot;</span><span class="p">,</span> <span class="s2">&quot;tract&quot;</span><span class="p">,</span> <span class="s2">&quot;block&quot;</span><span class="p">}:</span>
</span><span id="fetchgeometries-135"><a href="#fetchgeometries-135"><span class="linenos">135</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Geometry level </span><span class="si">{</span><span class="n">geometry</span><span class="si">}</span><span class="s2"> not supported; aborting.&quot;</span><span class="p">)</span>
</span><span id="fetchgeometries-136"><a href="#fetchgeometries-136"><span class="linenos">136</span></a>
</span><span id="fetchgeometries-137"><a href="#fetchgeometries-137"><span class="linenos">137</span></a>    <span class="k">if</span> <span class="n">geometry</span> <span class="o">==</span> <span class="s2">&quot;block group&quot;</span><span class="p">:</span>
</span><span id="fetchgeometries-138"><a href="#fetchgeometries-138"><span class="linenos">138</span></a>        <span class="n">geometry</span> <span class="o">=</span> <span class="s2">&quot;bg&quot;</span>
</span><span id="fetchgeometries-139"><a href="#fetchgeometries-139"><span class="linenos">139</span></a>    <span class="k">if</span> <span class="n">geometry</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
</span><span id="fetchgeometries-140"><a href="#fetchgeometries-140"><span class="linenos">140</span></a>        <span class="n">geometry</span> <span class="o">=</span> <span class="s2">&quot;tabblock&quot;</span>
</span><span id="fetchgeometries-141"><a href="#fetchgeometries-141"><span class="linenos">141</span></a>
</span><span id="fetchgeometries-142"><a href="#fetchgeometries-142"><span class="linenos">142</span></a>    <span class="c1"># Construct the Census URL.</span>
</span><span id="fetchgeometries-143"><a href="#fetchgeometries-143"><span class="linenos">143</span></a>    <span class="n">fips</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">fips</span>
</span><span id="fetchgeometries-144"><a href="#fetchgeometries-144"><span class="linenos">144</span></a>    <span class="n">head</span> <span class="o">=</span> <span class="s2">&quot;https://www2.census.gov/geo/pvs/tiger2010st/&quot;</span>
</span><span id="fetchgeometries-145"><a href="#fetchgeometries-145"><span class="linenos">145</span></a>    <span class="n">tail</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fips</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">clocator</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">fips</span><span class="si">}</span><span class="s2">/tl_2010_</span><span class="si">{</span><span class="n">fips</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">geometry</span><span class="si">}</span><span class="s2">10.zip&quot;</span>
</span><span id="fetchgeometries-146"><a href="#fetchgeometries-146"><span class="linenos">146</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="n">head</span> <span class="o">+</span> <span class="n">tail</span>
</span><span id="fetchgeometries-147"><a href="#fetchgeometries-147"><span class="linenos">147</span></a>
</span><span id="fetchgeometries-148"><a href="#fetchgeometries-148"><span class="linenos">148</span></a>    <span class="c1"># Download, extract, and return the geometries from the URL.</span>
</span><span id="fetchgeometries-149"><a href="#fetchgeometries-149"><span class="linenos">149</span></a>    <span class="k">return</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Fetches the 2010 Census geometries on which ACS data are reported.</p>

<p>Args:
    state (State): The <code>us.State</code> for which CVAP will be estimated.
    geometry10 (str): Level of geometry we're fetching. Accepted values are
        <code>"tract"</code> and <code>"block group"</code>.</p>

<p>Returns:
    A <code>GeoDataFrame</code> of 2010 geometries.</p>
</div>


                </section>
                <section id="census10">
                            <input id="census10-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">census10</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">state</span>, </span><span class="param"><span class="n">table</span><span class="o">=</span><span class="s1">&#39;P8&#39;</span>, </span><span class="param"><span class="n">columns</span><span class="o">=</span><span class="p">{}</span>, </span><span class="param"><span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;block&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="census10-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#census10"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="census10-27"><a href="#census10-27"><span class="linenos">27</span></a><span class="k">def</span> <span class="nf">census10</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="s2">&quot;P8&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">{},</span> <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;block&quot;</span><span class="p">):</span>
</span><span id="census10-28"><a href="#census10-28"><span class="linenos">28</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="census10-29"><a href="#census10-29"><span class="linenos">29</span></a><span class="sd">    Retrieves `geometry`-level 2010 Summary File 1 data via the Census API.</span>
</span><span id="census10-30"><a href="#census10-30"><span class="linenos">30</span></a>
</span><span id="census10-31"><a href="#census10-31"><span class="linenos">31</span></a><span class="sd">    Args:</span>
</span><span id="census10-32"><a href="#census10-32"><span class="linenos">32</span></a><span class="sd">        state (State): `us.State` object (e.g. `us.states.WI`).</span>
</span><span id="census10-33"><a href="#census10-33"><span class="linenos">33</span></a><span class="sd">        table (string, optional): Table from which we retrieve data.</span>
</span><span id="census10-34"><a href="#census10-34"><span class="linenos">34</span></a><span class="sd">           Defaults to the P8 table, which contains population by race</span>
</span><span id="census10-35"><a href="#census10-35"><span class="linenos">35</span></a><span class="sd">           regardless of ethnicity.</span>
</span><span id="census10-36"><a href="#census10-36"><span class="linenos">36</span></a><span class="sd">        columns (dict, optional): Dictionary which maps Census column names</span>
</span><span id="census10-37"><a href="#census10-37"><span class="linenos">37</span></a><span class="sd">            (from the correct table) to human-readable names. We require this</span>
</span><span id="census10-38"><a href="#census10-38"><span class="linenos">38</span></a><span class="sd">            to be a dictionary, _not_ a list, as specifying human-readable</span>
</span><span id="census10-39"><a href="#census10-39"><span class="linenos">39</span></a><span class="sd">            names will implicitly protect against incorrect column names</span>
</span><span id="census10-40"><a href="#census10-40"><span class="linenos">40</span></a><span class="sd">            and excessive API calls.</span>
</span><span id="census10-41"><a href="#census10-41"><span class="linenos">41</span></a><span class="sd">        geometry (string, optional): Geometry level at which we retrieve data.</span>
</span><span id="census10-42"><a href="#census10-42"><span class="linenos">42</span></a><span class="sd">            Defaults to `&quot;block&quot;` to retrieve block-level data for the state</span>
</span><span id="census10-43"><a href="#census10-43"><span class="linenos">43</span></a><span class="sd">            provided. Accepted values are `&quot;block&quot;`, `&quot;block group`&quot;, and</span>
</span><span id="census10-44"><a href="#census10-44"><span class="linenos">44</span></a><span class="sd">            `&quot;tract&quot;`.</span>
</span><span id="census10-45"><a href="#census10-45"><span class="linenos">45</span></a>
</span><span id="census10-46"><a href="#census10-46"><span class="linenos">46</span></a><span class="sd">    Returns:</span>
</span><span id="census10-47"><a href="#census10-47"><span class="linenos">47</span></a><span class="sd">        A DataFrame with columns renamed according to their Census description</span>
</span><span id="census10-48"><a href="#census10-48"><span class="linenos">48</span></a><span class="sd">        designation and a unique identifier column for joining to geometries.</span>
</span><span id="census10-49"><a href="#census10-49"><span class="linenos">49</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="census10-50"><a href="#census10-50"><span class="linenos">50</span></a>    <span class="c1"># Check whether the geometry is right. If not, warn the user and set it</span>
</span><span id="census10-51"><a href="#census10-51"><span class="linenos">51</span></a>    <span class="c1"># properly.</span>
</span><span id="census10-52"><a href="#census10-52"><span class="linenos">52</span></a>    <span class="k">if</span> <span class="n">geometry</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;block&quot;</span><span class="p">,</span> <span class="s2">&quot;tract&quot;</span><span class="p">,</span> <span class="s2">&quot;block group&quot;</span><span class="p">}:</span>
</span><span id="census10-53"><a href="#census10-53"><span class="linenos">53</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Geometry &quot;</span><span class="si">{</span><span class="n">geometry</span><span class="si">}</span><span class="s1">&quot; not accepted.&#39;</span><span class="p">)</span>
</span><span id="census10-54"><a href="#census10-54"><span class="linenos">54</span></a>
</span><span id="census10-55"><a href="#census10-55"><span class="linenos">55</span></a>    <span class="c1"># Check whether we&#39;re providing an appropriate table name.</span>
</span><span id="census10-56"><a href="#census10-56"><span class="linenos">56</span></a>    <span class="k">if</span> <span class="n">table</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;P8&quot;</span><span class="p">,</span> <span class="s2">&quot;P9&quot;</span><span class="p">,</span> <span class="s2">&quot;P10&quot;</span><span class="p">,</span> <span class="s2">&quot;P11&quot;</span><span class="p">}:</span>
</span><span id="census10-57"><a href="#census10-57"><span class="linenos">57</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unknown table &quot;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s1">&quot;.&#39;</span><span class="p">)</span>
</span><span id="census10-58"><a href="#census10-58"><span class="linenos">58</span></a>
</span><span id="census10-59"><a href="#census10-59"><span class="linenos">59</span></a>    <span class="c1"># Create the right geometry identifiers.</span>
</span><span id="census10-60"><a href="#census10-60"><span class="linenos">60</span></a>    <span class="n">geometries</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;state&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">fips</span><span class="p">)),</span> <span class="p">(</span><span class="s2">&quot;county&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;tract&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)]</span>
</span><span id="census10-61"><a href="#census10-61"><span class="linenos">61</span></a>    <span class="k">if</span> <span class="n">geometry</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;block group&quot;</span><span class="p">,</span> <span class="s2">&quot;block&quot;</span><span class="p">}:</span>
</span><span id="census10-62"><a href="#census10-62"><span class="linenos">62</span></a>        <span class="n">geometries</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">geometry</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)]</span>
</span><span id="census10-63"><a href="#census10-63"><span class="linenos">63</span></a>
</span><span id="census10-64"><a href="#census10-64"><span class="linenos">64</span></a>    <span class="c1"># Create an identifier column.</span>
</span><span id="census10-65"><a href="#census10-65"><span class="linenos">65</span></a>    <span class="n">identifier</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;10&quot;</span>
</span><span id="census10-66"><a href="#census10-66"><span class="linenos">66</span></a>
</span><span id="census10-67"><a href="#census10-67"><span class="linenos">67</span></a>    <span class="n">varmap</span> <span class="o">=</span> <span class="n">columns</span> <span class="k">if</span> <span class="n">columns</span> <span class="k">else</span> <span class="n">variables</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="census10-68"><a href="#census10-68"><span class="linenos">68</span></a>    <span class="nb">vars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">varmap</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="census10-69"><a href="#census10-69"><span class="linenos">69</span></a>    <span class="c1"># Download data.</span>
</span><span id="census10-70"><a href="#census10-70"><span class="linenos">70</span></a>    <span class="n">raw</span> <span class="o">=</span> <span class="n">censusdata</span><span class="o">.</span><span class="n">download</span><span class="p">(</span>
</span><span id="census10-71"><a href="#census10-71"><span class="linenos">71</span></a>        <span class="s2">&quot;sf1&quot;</span><span class="p">,</span>
</span><span id="census10-72"><a href="#census10-72"><span class="linenos">72</span></a>        <span class="mi">2010</span><span class="p">,</span>
</span><span id="census10-73"><a href="#census10-73"><span class="linenos">73</span></a>        <span class="n">censusdata</span><span class="o">.</span><span class="n">censusgeo</span><span class="p">(</span><span class="n">geometries</span><span class="p">),</span>
</span><span id="census10-74"><a href="#census10-74"><span class="linenos">74</span></a>        <span class="p">[</span><span class="s2">&quot;GEO_ID&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">vars</span><span class="p">,</span>
</span><span id="census10-75"><a href="#census10-75"><span class="linenos">75</span></a>    <span class="p">)</span>
</span><span id="census10-76"><a href="#census10-76"><span class="linenos">76</span></a>
</span><span id="census10-77"><a href="#census10-77"><span class="linenos">77</span></a>    <span class="c1"># Rename columns and send back to the caller!</span>
</span><span id="census10-78"><a href="#census10-78"><span class="linenos">78</span></a>    <span class="n">raw</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;GEO_ID&quot;</span><span class="p">:</span> <span class="n">identifier</span><span class="p">,</span> <span class="o">**</span><span class="n">columns</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="census10-79"><a href="#census10-79"><span class="linenos">79</span></a>    <span class="n">raw</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">9</span><span class="p">:]</span>
</span><span id="census10-80"><a href="#census10-80"><span class="linenos">80</span></a>    <span class="n">clean</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="census10-81"><a href="#census10-81"><span class="linenos">81</span></a>
</span><span id="census10-82"><a href="#census10-82"><span class="linenos">82</span></a>    <span class="n">clean</span> <span class="o">=</span> <span class="n">clean</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">varmap</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="census10-83"><a href="#census10-83"><span class="linenos">83</span></a>    <span class="k">return</span> <span class="n">clean</span>
</span></pre></div>


            <div class="docstring"><p>Retrieves <code>geometry</code>-level 2010 Summary File 1 data via the Census API.</p>

<p>Args:
    state (State): <code>us.State</code> object (e.g. <code>us.states.WI</code>).
    table (string, optional): Table from which we retrieve data.
       Defaults to the P8 table, which contains population by race
       regardless of ethnicity.
    columns (dict, optional): Dictionary which maps Census column names
        (from the correct table) to human-readable names. We require this
        to be a dictionary, _not_ a list, as specifying human-readable
        names will implicitly protect against incorrect column names
        and excessive API calls.
    geometry (string, optional): Geometry level at which we retrieve data.
        Defaults to <code>"block"</code> to retrieve block-level data for the state
        provided. Accepted values are <code>"block"</code>, <code>"block group</code>", and
        <code>"tract"</code>.</p>

<p>Returns:
    A DataFrame with columns renamed according to their Census description
    designation and a unique identifier column for joining to geometries.</p>
</div>


                </section>
                <section id="geometries20">
                            <input id="geometries20-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">geometries20</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">state</span>, </span><span class="param"><span class="n">filepath</span>, </span><span class="param"><span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;tract&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="geometries20-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#geometries20"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="geometries20-5"><a href="#geometries20-5"><span class="linenos"> 5</span></a><span class="k">def</span> <span class="nf">geometries20</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;tract&quot;</span><span class="p">):</span>
</span><span id="geometries20-6"><a href="#geometries20-6"><span class="linenos"> 6</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="geometries20-7"><a href="#geometries20-7"><span class="linenos"> 7</span></a><span class="sd">    Retrieves Lab-processed geometric data for the provided state and geometry</span>
</span><span id="geometries20-8"><a href="#geometries20-8"><span class="linenos"> 8</span></a><span class="sd">    level and writes it to the provided filepath.</span>
</span><span id="geometries20-9"><a href="#geometries20-9"><span class="linenos"> 9</span></a>
</span><span id="geometries20-10"><a href="#geometries20-10"><span class="linenos">10</span></a><span class="sd">    Args:</span>
</span><span id="geometries20-11"><a href="#geometries20-11"><span class="linenos">11</span></a><span class="sd">        state (us.State): State for which we retrieve data.</span>
</span><span id="geometries20-12"><a href="#geometries20-12"><span class="linenos">12</span></a><span class="sd">        filepath (str): Location to which we write the compressed data.</span>
</span><span id="geometries20-13"><a href="#geometries20-13"><span class="linenos">13</span></a><span class="sd">        geometry (str, optional): Geometry level at which we retrieve data.</span>
</span><span id="geometries20-14"><a href="#geometries20-14"><span class="linenos">14</span></a><span class="sd">            Accepted values are `block group`, `block`, `congress`, `county`,</span>
</span><span id="geometries20-15"><a href="#geometries20-15"><span class="linenos">15</span></a><span class="sd">            `cousub`, `place`, `senate`, `house`, `tract`, and `vtd`. Defaults</span>
</span><span id="geometries20-16"><a href="#geometries20-16"><span class="linenos">16</span></a><span class="sd">            to `tract`.</span>
</span><span id="geometries20-17"><a href="#geometries20-17"><span class="linenos">17</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="geometries20-18"><a href="#geometries20-18"><span class="linenos">18</span></a>    <span class="c1"># Create a mapping from standard geometry names to data.mggg.org geometry</span>
</span><span id="geometries20-19"><a href="#geometries20-19"><span class="linenos">19</span></a>    <span class="c1"># identifiers.</span>
</span><span id="geometries20-20"><a href="#geometries20-20"><span class="linenos">20</span></a>    <span class="n">geometrymap</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="geometries20-21"><a href="#geometries20-21"><span class="linenos">21</span></a>        <span class="s2">&quot;block group&quot;</span><span class="p">:</span> <span class="s2">&quot;bg&quot;</span><span class="p">,</span>
</span><span id="geometries20-22"><a href="#geometries20-22"><span class="linenos">22</span></a>        <span class="s2">&quot;block&quot;</span><span class="p">:</span> <span class="s2">&quot;block&quot;</span><span class="p">,</span>
</span><span id="geometries20-23"><a href="#geometries20-23"><span class="linenos">23</span></a>        <span class="s2">&quot;congress&quot;</span><span class="p">:</span> <span class="s2">&quot;cd116&quot;</span><span class="p">,</span>
</span><span id="geometries20-24"><a href="#geometries20-24"><span class="linenos">24</span></a>        <span class="s2">&quot;county&quot;</span><span class="p">:</span> <span class="s2">&quot;county&quot;</span><span class="p">,</span>
</span><span id="geometries20-25"><a href="#geometries20-25"><span class="linenos">25</span></a>        <span class="s2">&quot;cousub&quot;</span><span class="p">:</span> <span class="s2">&quot;cousub&quot;</span><span class="p">,</span>
</span><span id="geometries20-26"><a href="#geometries20-26"><span class="linenos">26</span></a>        <span class="s2">&quot;place&quot;</span><span class="p">:</span> <span class="s2">&quot;place&quot;</span><span class="p">,</span>
</span><span id="geometries20-27"><a href="#geometries20-27"><span class="linenos">27</span></a>        <span class="s2">&quot;senate&quot;</span><span class="p">:</span> <span class="s2">&quot;sldu&quot;</span><span class="p">,</span>
</span><span id="geometries20-28"><a href="#geometries20-28"><span class="linenos">28</span></a>        <span class="s2">&quot;house&quot;</span><span class="p">:</span> <span class="s2">&quot;sldl&quot;</span><span class="p">,</span>
</span><span id="geometries20-29"><a href="#geometries20-29"><span class="linenos">29</span></a>        <span class="s2">&quot;tract&quot;</span><span class="p">:</span> <span class="s2">&quot;tract&quot;</span><span class="p">,</span>
</span><span id="geometries20-30"><a href="#geometries20-30"><span class="linenos">30</span></a>        <span class="s2">&quot;vtd&quot;</span><span class="p">:</span> <span class="s2">&quot;vtd&quot;</span><span class="p">,</span>
</span><span id="geometries20-31"><a href="#geometries20-31"><span class="linenos">31</span></a>    <span class="p">}</span>
</span><span id="geometries20-32"><a href="#geometries20-32"><span class="linenos">32</span></a>
</span><span id="geometries20-33"><a href="#geometries20-33"><span class="linenos">33</span></a>    <span class="c1"># Check that the passed geometry is allowable.</span>
</span><span id="geometries20-34"><a href="#geometries20-34"><span class="linenos">34</span></a>    <span class="k">if</span> <span class="n">geometry</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">geometrymap</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="geometries20-35"><a href="#geometries20-35"><span class="linenos">35</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested geometry &quot;</span><span class="si">{</span><span class="n">geometry</span><span class="si">}</span><span class="s1">&quot; is not allowed; &#39;</span> <span class="s2">&quot;loading tracts.&quot;</span><span class="p">)</span>
</span><span id="geometries20-36"><a href="#geometries20-36"><span class="linenos">36</span></a>        <span class="n">geometry</span> <span class="o">=</span> <span class="s2">&quot;tract&quot;</span>
</span><span id="geometries20-37"><a href="#geometries20-37"><span class="linenos">37</span></a>
</span><span id="geometries20-38"><a href="#geometries20-38"><span class="linenos">38</span></a>    <span class="c1"># Specify the base url.</span>
</span><span id="geometries20-39"><a href="#geometries20-39"><span class="linenos">39</span></a>    <span class="n">base</span> <span class="o">=</span> <span class="s2">&quot;https://s3.us-east-2.amazonaws.com/data.mggg.org/census-2020/&quot;</span>
</span><span id="geometries20-40"><a href="#geometries20-40"><span class="linenos">40</span></a>    <span class="n">suffix</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="geometries20-41"><a href="#geometries20-41"><span class="linenos">41</span></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">state</span><span class="o">.</span><span class="n">abbr</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">state</span><span class="o">.</span><span class="n">abbr</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">geometrymap</span><span class="p">[</span><span class="n">geometry</span><span class="p">]</span><span class="si">}</span><span class="s2">.zip&quot;</span>
</span><span id="geometries20-42"><a href="#geometries20-42"><span class="linenos">42</span></a>    <span class="p">)</span>
</span><span id="geometries20-43"><a href="#geometries20-43"><span class="linenos">43</span></a>
</span><span id="geometries20-44"><a href="#geometries20-44"><span class="linenos">44</span></a>    <span class="c1"># Send the request!</span>
</span><span id="geometries20-45"><a href="#geometries20-45"><span class="linenos">45</span></a>    <span class="n">request</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">)</span>
</span><span id="geometries20-46"><a href="#geometries20-46"><span class="linenos">46</span></a>
</span><span id="geometries20-47"><a href="#geometries20-47"><span class="linenos">47</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">w</span><span class="p">:</span>
</span><span id="geometries20-48"><a href="#geometries20-48"><span class="linenos">48</span></a>        <span class="n">w</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Retrieves Lab-processed geometric data for the provided state and geometry
level and writes it to the provided filepath.</p>

<p>Args:
    state (us.State): State for which we retrieve data.
    filepath (str): Location to which we write the compressed data.
    geometry (str, optional): Geometry level at which we retrieve data.
        Accepted values are <code>block group</code>, <code>block</code>, <code>congress</code>, <code>county</code>,
        <code>cousub</code>, <code>place</code>, <code>senate</code>, <code>house</code>, <code>tract</code>, and <code>vtd</code>. Defaults
        to <code>tract</code>.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>